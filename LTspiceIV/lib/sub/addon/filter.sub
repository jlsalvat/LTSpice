********************************************************************************
*
*	The following is an attempt at making a universal filter for the
* excellent SPICE software that is LTspice. A filter that has the possibility
* of being multiple types of filters, both analog and digital, while being
* able to have all the configurations a filter can: all-pass, low-pass, high-
* pass, band-pass and band-stop. A filter that can replace the cumbersome
* process of calculating, implementing and then using a multiple stage filter,
* when the purpose of the simulation is different, not to mention the need to
* repeat the steps whenever a change is needed. A filter that can be used
* anywhere a filtering function is needed, be it a quick example or a full-
* scale schematic, that provides simplicity in use and effectiveness in its
* performance. A filter that can have an educational value without the need to
* spend large sums of money on expensive software. A filter that works.
*	If the purpose is accomplished, or not, the users will decide, as it's
* made available publicly.
*
*								Â©Vlad, 2012
*
********************************************************************************
*
*	The introductory paragraphs are meant as a short, general description
* and usage guide. Details about them, however, will be given in each section.
* Updates are ennumerated at the end of the file.
*
*
* [GENERAL]
*
* - This is the subcircuit(s) file for the universal filter called 'Filter'.
* There will be certain notations used throughout this file:
*
* 'OUT'		= pin names, capitalized, single-quoted unless used for
*		  description;
* "Win"		= variables and names, quoted unless used for description or ->
* As=40,Asc>0	= variables have one value, or ->
* N=<0:32>	= variables have a ranges of values, or ->
* test=<0,1>	= variables have two possible values;
* AP/LP/HP/BP/BS= all-pass/low-pass/high-pass/band-pass/band-stop.
*
*
* - There are, in total, 43 filters, 38 of which are unique and they're all
* grouped into four large sections: analog, infinite impulse response (IIR),
* finite impulse response (FIR) and moving average filters (MAF), with IIR, FIR
* and MAF making the digital ones.
*  As of 22.12.2012, the available functions through the drop-down menu, grouped
* into sections and listed according to their names in the list, are:
*
*	[Analog]
* 1.  3dBoct		[LP]
* 2.  Bessel		[AP/LP/HP]
* 3.  Butterworth	[AP/LP/HP/BP/BS]
* 4.  Chebyshev		[AP/LP/HP/BP/BS]
* 5.  InvChebyshev	[LP/HP/BP/BS]
* 6.  Cauer		[LP/HP/BP/BS]
*
*	[IIR]
* 7.  Butterworth_IIR	[LP/HP/BP/BS]
* 8.  Chebyshev_IIR	[LP/HP/BP/BS]
* 9.  InvChebyshev_IIR	[LP/HP/BP/BS]
* 10. Cauer_IIR		[LP/HP/BP/BS]
*
*	[FIR]		[AP/LP/HP/BP/BS]
* 11. rectangular
* 12. triangular
* 13. Bartlett
* 14. Tukey
* 15. Lanczos
* 16. Bohman
* 17. Welch
* 18. Connes
* 19. Cauchy
* 20. Parzen
* 21. general cosine
* 22. von Hann
* 23. Bartlett-Hann
* 24. Poisson
* 25. Hann-Poisson
* 26. Hamming
* 27. power of cosine
* 28. Blackman
* 29. Exact Blackman
* 30. Blackman-Nuttall
* 31. Blackman-Harris, 3 terms
* 32. Blackman-Harris, 4 terms
* 33. flat top
* 34. Gaussian, generic
* 35. Kaiser
* 36. Kaiser-Bessel
* 37. Gaussian, pulse shaping
* 38. raised cosine
* 39. (square) root raised cosine
* 40. differentiator
* 41. Hilbert transformer
*
*	[MAF]		[LP]
* 42. MAF
* 43. MAFv
*
*  However, accessing the Filter's functions through the drop-down menu will
* list only 13 entries:
*
* I.	3dBoct
* II.	Bessel
* III.	Butterworth
* IV.	Chebyshev
* V.	InvChebyshev
* VI.	Cauer
* VII.	Butterworth_IIR
* VIII.	Chebyshev_IIR
* IX.	InvChebyshev_IIR
* X.	Cauer_IIR
* XI.	FIR
* XII.	MAF
* XIII.	MAFv
*
*  because the FIR can be anything from 11 to 41 (as described above). This
* shortens the list to 12, but the 4 IIR are analog counterparts and the last
* 2 of them are variants of MAF, leaving: 6 (analog) + 31 (FIR) + 1 (MAF) = 38.
*
*
* [SYMBOL]
*
*  The symbol has 5 pins: 'IN', 'OUT', '0.1', '0.2' and '0.3'. For *all*, 'IN'
* and 'OUT' pins are common and used. The other three are needed according to
* their particular needs, detailed in their sections. They are optional and are
* mostly for debugging. Unused pins can be safely ignored, no matter the case.
*
*		 _______________
*		|		|
*		|		|
*	  IN ---|		|--- OUT
*		|		|
*		|_______________|
*		   |    |    |
*		   |    |    |
*		  0.1  0.2  0.3
*
*
*
* [PARAMETERS]
*
* - The parameters are both shared and particular to their cases, dispersed in
* an intuitive manner on all the four rows of a typical LTspice symbol (without
* the "Model" line, it's used for the name). Starting from the upper row, they
* are arranged as follows:
*
* "Value"	optional parameters for FIR;
* "Value2"	FIR specific + FIR/IIR/MAF shared (optional);
* "SpiceLine"	shared and specific for all;
* "SpiceLine2"	analog/IIR specific and analog/FIR/MAF shared.
*
* - In particular, using the same line names a symbol has, each class of filters
* uses the following parameters (detailed explanations are in their section):
*
*	[Analog]
*
* "Value"	- "sigma"
* "Value2"	-
* "SpiceLine"	- "fp1", "fs1", "fp2", "fs2"
* "SpiceLine2"	- "G", "Asc", "Ap", "As", "N"
*		(hidden: "Rpar")
*
*	[IIR]
*
* "Value"	-
* "Value2"	- "quant"
* "SpiceLine"	- "f0", "fp1", "fs1", "fp2", "fs2"
* "SpiceLine2"	- "G", "Asc", "Ap", "As", "N"
*		(hidden: "Cpar", "tr", "td")
*
*	[FIR]
*
* "Value"	- "sigma", "nT", "a0", "a1", "a2", "a3", "a4", "a5"
* "Value2"	- "Win", "Choice", "sim", "test", "quant"
* "SpiceLine"	- "f0", "fp1", "fs1", "fp2", "fs2"
* "SpiceLine2"	- "G", "Asc", "Ap", "As", "N"
*		(hidden: "Cpar", "tr", "td")
*
*	[MAF]
*
* "Value"	-
* "Value2"	- "quant"
* "SpiceLine"	- "f0"
* "SpiceLine2"	- "N"
*		(hidden: "Rpar", "Cpar", "tr", "td")
*
* - Any parameter that is not listed when using a specific function is safe to
* ignore, for example using one of the analog filters means "f0" won't affect
* the results. Hidden parameters are not in the symbol's list because they are
* not important, but they can affect the results so they can be changed, if
* needed.
*
*
* [CHARACTERISTICS]
*
* - For each of the analog (except 3dBoct) and IIR filters there are various
* optimizations possible by setting one of the following parameters to zero:
*
*		|  N=0	| Ap=0	| As=0	| Asc=0	
* --------------+-------+-------+-------+-------
* Bessel	|   -	|   -	|   -	|   A
* --------------+-------+-------+-------+-------
* Buterworth	| B & C	|   -	|   -	|   D
* --------------+-------+-------+-------+-------
* Chebyshev	| B & C	| D (+F)|   -	|   F
* --------------+-------+-------+-------+-------
* InvChebyshev	| B & C	|   -	|   E	|   D
* --------------+-------+-------+-------+-------
* Cauer		| B & E	|   D	|   E	|   -
* --------------+-------+-------+-------+-------
*
* where:
* A = constant time delay function;
* B = minimum order to meet the requirements;
* C = transition-band optimization;
* D = pass-band opt.;
* E = stop-band opt.;
* F = frequency scaling.
*  Only one of them can be active (for example setting N=0 and As=0 will give an
* error) except Chebyshev, who can have "Ap" with either "Asc" or "N" at a time.
*
* - The output gain is normalized to DC=0dB, for each filter, so the pass-band
* ripple (Chebyshev, Cauer) will oscillate from 0dB to +/-Ap. This means that
* for even orders As=As+Ap and the corner frequency will be @Asc-Ap. The reason
* is simple: if you're going to do some normalizing for the frequencies during
* the designing process, that is, alter the mathematical formulas to fit your
* requirements, you may as well normalize the step response, too.
*
*
* [INTERNAL AFFAIRS]
*
* - The input is floating, i.e. there is a G-source as a buffer, and the output
* impedance is a current source with a 1 Ohm resistance, with the following
* exceptions:
*
* - IIR	: Ri = 1G (*)
* - FIR	: Ri = 1G (*)
*	  Ro=/=1  (*)
* - MAF	: Ri = 1G (*)
*	  Zo = f0/jw , capacitive (*)
* - MAFv: Ro = f0
*  (* only in certain cases, see their sections for details)
* - Internally, the main nodes are until up N/2 (for LP/HP -- analog, IIR) or N
* (for BP/BS -- analog, IIR -- or FIR). If errors like "Analysis Failed: Matrix
* is singular" show up, it may be because the calculated order is larger than it
* can handle. The error log can confirm this if it generates messages similar to
* "WARNING: Node U1:19 is floating". For example, this particular error means
* that the required order (for an analog LP) is 38. This is valid for all the
* filters.
* - On a more intimate note, due to the way the filters are built, they can
* handle very large values of signals in .TRAN, meaning they will simulate fast,
* if not faster. The analog filters are based on the state-space 1st canonical
* form using [6xG,2xC,1xR,4nodes] per each 2nd order stage, Bessel being a
* simplified form allowing for recursive Bessel terms. IIR section uses direct-
* form II: [6xG,2xT,1xR,3nodes]/2nd order stage, with an additional node and
* resistor at the beginning and end of the chain. Still, even if a 1GV input is
* possible and will simulate just as fast as a 1V input, the IIRs are slightly
* slower than the analog ones because of the sampling process.
*
*
* [TWEAKS]
*
* - Given the internal description, extending the capabilities of the filter to
* allow for a greater order than the current one means searching through the
* section of choice and either adding (or subtracting) various devices, or
* uncommenting them. In general, this means adding G-sources, capacitors or
* tlines (depending on the case) and resistors (look for neatly arranged blocks
* of increasing device IDs). If you like to tweak, you'll know what to do; if
* not, don't hesitate to ask in Yahoo's LTspice Group, I visit it from time to
* time.
* - The three pins below beared different incremental names, starting with '101'
* and ending up with '10001' due to the different changes each function went
* through and, since they started to get too large, the names were shortened to
* the current, fractional ID. This information was vital.
*
********************************************************************************
********************************************************************************
*
*				~~ ANALOG ~~
*
********************************************************************************
********************************************************************************
*
* [GENERAL]
*
* - The analog part is made up of five types of well-known filters, configurable
* as AP/LP/HP/BP/BS, up to the 32nd order: Bessel, Butterworth, Chebyshev types
* I & II and Cauer, plus a -3dB/octave filter (LP only).
* - It's accurate for Butterworth, Chebyshev I & II and Bessel (if used as a
* time delay); minor errors for frequency scaling for Bessel (due to a curve-
* fitting formula that approximates the response), minor errors in approximating
* the roll-off for 3dBoct, and Cauer has ~2~3 decimals precision for extreme
* settings; that's because it uses approximations for elliptic functions.
*
*
* [SYMBOL]
*
* - The 'IN' and 'OUT' pins are used by all, so their description and usage is
* self-implied. In addition, it also uses two of the lower pins:
*
*  0.1	= order of filter, active, works in .AC (except 3dBoct);
*  0.2	= can have any integer values from <0V:4V>, with 0 meaning AP, 1 = LP,
*	2 = HP, 3 = BP and 4 = BS; active, works in .AC (except 3dBoct);
*  0.3	= not used.
*
* - In .AC, they will display the values in dB and degrees for easier viewing
* anyway the y axis is set, for example N=13 means 13dB/13deg, or case=2 means
* 2dB/2deg. They are useful when the user doesn't readily know the order of the
* filter (when N=0) or in cases where the frequencies determining the "case" are
* calculated by formulas, instead of being specified "by hand".
*
*
* [PARAMETERS]
*
* N=<0:32>	= order of the filter, 32 for LP/HP and 16 for BP/BS, or the
*		maximum number (40) of RC cells/octave for 3dBoct;
* fp1	[Hz]	= lower pass-band (corner) frequency;
* fs1	[Hz]	= lower stop-band frequency;
* fp2	[Hz]	= upper pass-band (corner) frequency;
* fs2	[Hz]	= upper stop-band frequency;
* Ap	[dB]	= pass-band ripple, positive value (Chebyshev I and Cauer);
* As	[dB]	= stop-band attenuation, positive (all but Bessel);
* Asc	[dB]	= frequency-scaling attenuation, positive (all but 3dBoct and
*		Cauer);
* G	[linear]= gain.
* sigma=<0:1>	= a minor tweak to make 3dBoct's response smoother or sharper;
*
* - Hidden:
*
* Rpar	[Ohm]	= dummy resistance across capacitors, default 1G, can be null;
*
*
* [CHARACTERISTICS]
*
* - The four frequencies decide one of the five possible configurations. If N=0,
* fs1's value (for LP/HP) and fs2's (for BP/BS), together with "As" and "Ap" or
* "Asc" will be used to calculate the minimum order. If N>0, the values for the
* stop-bands will only have to be greater than, or less than their pass-band
* pairs, according to the following graphs (use fixed font, tab=8, for best
* results):
*
*	A
*	|________________________________________
*	|	.	.	.	.
*	|	.	.	.	.
*	|	.	.	.	.
*	|	.	.	.	.		All-pass
*	|	.	.	.	.
*	|	.	.	.	.
*	|	.	.	.	.
*	|	.	.	.	.
*      -+----------------------------------------->
*	0    <	fp1	fs1=x	fp2=0	fs2>0
*	|________	.	.	.
*	|	.\	.	.	.
*	|	. \	.	.	.
*	|	.  \	.	.	.
*	|	.   \	.	.	.		Low-pass
*	|	.    \	.	.	.
*	|	.     \	.	.	.
*	|	.      \.	.	.
*	|	.	\	.	.
*      -+----------------------------------------->
*	0  <	fp1  <	fs1	fp2=0	fs2=0
*	|	.	.	.	.
*	|	.	_________________________
*	|	.      /.	.	.
*	|	.     /	.	.	.
*	|	.    /	.	.	.
*	|	.   /	.	.	.		High-pass
*	|	.  /	.	.	.
*	|	. /	.	.	.
*	|	./	.	.	.
*	|	/	.	.	.
*      -+----------------------------------------->
*	0   <	fs1  <	fp1	fp2=0	fs2=0
*	|	.	.	.	.
*	|	.	.	.	.
*	|	.	_________	.
*	|	.      /.	.\	.
*	|	.     /	.	. \	.
*	|	.    /	.	.  \	.
*	|	.   /	.	.   \	.		Band-pass
*	|	.  /	.	.    \	.
*	|	. /	.	.     \	.
*	|	./	.	.      \.
*	|	/	.	.	\
*      -+----------------------------------------->
*	0    <	fs1 <	fp1  <	fp2  <	fs2
*	|	.	.	.	.
*	|________	.	.	__________
*	|	.\	.	.      /.
*	|	. \	.	.     /	.
*	|	.  \	.	.    /	.
*	|	.   \	.	.   /	.		Band-stop
*	|	.    \	.	.  /	.
*	|	.     \	.	. /	.
*	|	.      \.	./	.
*	|	.	\	/	.
*      -+----------------------------------------->
*	0   <	fp1  <	fs1  <	fs2  <	fp2
*
* - For all-pass, anything that doesn't fit in the other four cases will work,
* e.g. it's enough to make fp2=0, keeping "fs1" at any value but avoiding fs2=0
* (with both it and fp2=0, it will be considered an LP/HP case). Bessel behaves
* differently, see its section for details.
* - There are various optimizations possible, see the table in the introduction,
* [CHARACTERISTICS].
* - For BP/BS, N is half of the real value, e.g. N=10 actually means N=20.
* - "fs2", for BP/BS case, should be specified as: (fp1*fp2)/fs1, for a correct
* response (and calculations).
*
*
* [NOTES]
*
* - All-pass is only supported by all-pole filters: Bessel, Butterworth and
* Chebyshev, even orders only.
* - Cauer doesn't have frequency scaling because it involves sqrt(-1) and I
* couldn't go around it.
*
************************
*
*	-3dB/octave
*
************************
*
* Parameters used: fp1, G, sigma (, N)
* Supports: LP
* Pins used: IN, OUT
*
* Notes:
* - It's made up of half-octave spaced RC cells, so it's an approximation.
* - "sigma" smoothens or sharpens the phase response for a better match with the
* amplitude or the phase. The default value of 0.5 is a compromise.
* - For an integrator-like response with 0dB@fp, set fp1=fp/100 and G=100.
* - Here, "N" is optional, it sets the maximum number of RC cells (40).
*
***********************
.subckt 3dBoct IN OUT 0.1 0.2 0.3
.param fp1=1 N=41 G=1  sigma=0.5
.func cap(x)=res(x+11.25-sigma)/pi/fp1/2**(1.5*sigma-0.75)
.func res(x)=2**(-x/2+1.5+sigma)
.func nod(x)=x<N
Gin 0 1 in 0 1
Rout out 0 1
Gout 0 out 1 0 {G}
Cx1 {nod(1)} 0 {cap(1)} Rser={res(1)} Rpar=1 Cpar=0 Lser=0 RLshunt=0
Cx2 {nod(2)} 0 {cap(2)} Rser={res(2)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx3 {nod(3)} 0 {cap(3)} Rser={res(3)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx4 {nod(4)} 0 {cap(4)} Rser={res(4)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx5 {nod(5)} 0 {cap(5)} Rser={res(5)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx6 {nod(6)} 0 {cap(6)} Rser={res(6)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx7 {nod(7)} 0 {cap(7)} Rser={res(7)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx8 {nod(8)} 0 {cap(8)} Rser={res(8)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx9 {nod(9)} 0 {cap(9)} Rser={res(9)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx10 {nod(10)} 0 {cap(10)} Rser={res(10)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx11 {nod(11)} 0 {cap(11)} Rser={res(11)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx12 {nod(12)} 0 {cap(12)} Rser={res(12)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx13 {nod(13)} 0 {cap(13)} Rser={res(13)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx14 {nod(14)} 0 {cap(14)} Rser={res(14)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx15 {nod(15)} 0 {cap(15)} Rser={res(15)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx16 {nod(16)} 0 {cap(16)} Rser={res(16)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx17 {nod(17)} 0 {cap(17)} Rser={res(17)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx18 {nod(18)} 0 {cap(18)} Rser={res(18)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx19 {nod(19)} 0 {cap(19)} Rser={res(19)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx20 {nod(20)} 0 {cap(20)} Rser={res(20)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx21 {nod(21)} 0 {cap(21)} Rser={res(21)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx22 {nod(22)} 0 {cap(22)} Rser={res(22)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx23 {nod(23)} 0 {cap(23)} Rser={res(23)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx24 {nod(24)} 0 {cap(24)} Rser={res(24)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx25 {nod(25)} 0 {cap(25)} Rser={res(25)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx26 {nod(26)} 0 {cap(26)} Rser={res(26)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx27 {nod(27)} 0 {cap(27)} Rser={res(27)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx28 {nod(28)} 0 {cap(28)} Rser={res(28)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx29 {nod(29)} 0 {cap(29)} Rser={res(29)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx30 {nod(30)} 0 {cap(30)} Rser={res(30)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx31 {nod(31)} 0 {cap(31)} Rser={res(31)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx32 {nod(32)} 0 {cap(32)} Rser={res(32)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx33 {nod(33)} 0 {cap(33)} Rser={res(33)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx34 {nod(34)} 0 {cap(34)} Rser={res(34)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx35 {nod(35)} 0 {cap(35)} Rser={res(35)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx36 {nod(36)} 0 {cap(36)} Rser={res(36)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx37 {nod(37)} 0 {cap(37)} Rser={res(37)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx38 {nod(38)} 0 {cap(38)} Rser={res(38)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx39 {nod(39)} 0 {cap(39)} Rser={res(39)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
Cx40 {nod(40)} 0 {cap(40)} Rser={res(40)} Rpar=0 Cpar=0 Lser=0 RLshunt=0
.ends 3dBoct
************************
*
*	Bessel
*
************************
*
* Parameters used: N, fp1, fs1, Asc, G (, Rpar)
* Supports: AP/LP/HP
* Pins used: IN, OUT
*
* Notes:
* - No automatic order calculation, therefore keep N>0.
* - For all-pass, set fp1=fs1, else make fs1<>fp1, "fs1"'s value doesn't matter
* (follow the graphs above for LP/HP).
* - "Asc" can have any value, but it should be used within <0:3>dB.
* - For frequency scaling set Asc=0 and, even if it isn't accurate, it's close,
* thanks to zunzun.com. For example: sweeping N from 1 to 32 with Asc=3 will
* have a difference error of 309.33mdB between the lowest and the highest trace
* and ~12.5mdB between two adjacent traces, @Asc; the errors inverse proportional
* with Asc.
* - There may be strange things in .AC for large frequency sweeps and for high
* orders, that's LTspice's engine doing its best to display very high values
* from a very simple circuit, it doesn't behave that way in .TRAN. You may try
* to circumvent this by lowering "Rpar".
*
***********************
.subckt Bessel in out 0.1 0.2 0.3
.param N=32
.param fp1=1k
.param fs1=2k
.param Asc=3
.param G=1
.param Rpar=1G
.func b(x)=if( x>N, 1, ((2*N-(a_2*N+a_2-1+sgn(.5-a_2)*x))*((a_2*N+a_2-1+sgn(.5-a_2)*x)+1)/
+ 2/(N-(a_2*N+a_2-1+sgn(.5-a_2)*x)))**sgn(.5-a_2) )
.func a(x)=(b(1)*b(2)*b(3)*b(4)*b(5)*b(6)*b(7)*b(8)*b(9)*b(10)*
+ b(11)*b(12)*b(13)*b(14)*b(15)*b(16)*b(17)*b(18)*b(19)*b(20)*
+ b(21)*b(22)*b(23)*b(24)*b(25)*b(26)*b(27)*b(28)*b(29)*b(30)*
+ b(31)*b(32))**sgn(a_2-.5)
.param wsc=if( N==1,(10**(Asc/10)-u(Asc))**(-0.5/N),
+ (8091309.68544832*exp((-0.5)*(((ln(Asc**u(Asc))-54.61336204495193)/
+ 10.45931985911644)**2+((ln(N)-8.03901973218457)/
+ 3.262082976398164)**2))+.02602784079436049) )**(sgn(fs1-fp1)*u(Asc))
.param a_2=(fp1>fs1)  Cs=wsc**u(Asc)/2/pi/fp1
;.nodealias 666 in
;.nodealias 999 out
Gx 0 666 in 0 1
Rx 0 666 1
Gy 0 999 {N} 0 1
Ry 0 999 1
Gan 0 999 666 0 {a_2**inv(fp1==fs1)}
Ga0 0 1 666 0 {inv(a_2)*a(0)**a_2}
Ga1 0 {2*(2<=N)} 0 {666*(2<=N)} {b(2)*(fp1==fs1)}
Ga2 0 {3*(3<=N)} {666*(3<=N)} 0 {b(3)*(fp1==fs1)}
Ga3 0 {4*(4<=N)} 0 {666*(4<=N)} {b(4)*(fp1==fs1)}
Ga4 0 {5*(5<=N)} {666*(5<=N)} 0 {b(5)*(fp1==fs1)}
Ga5 0 {6*(6<=N)} 0 {666*(6<=N)} {b(6)*(fp1==fs1)}
Ga6 0 {7*(7<=N)} {666*(7<=N)} 0 {b(7)*(fp1==fs1)}
Ga7 0 {8*(8<=N)} 0 {666*(8<=N)} {b(8)*(fp1==fs1)}
Ga8 0 {9*(9<=N)} {666*(9<=N)} 0 {b(9)*(fp1==fs1)}
Ga9 0 {10*(10<=N)} 0 {666*(10<=N)} {b(10)*(fp1==fs1)}
Ga10 0 {11*(11<=N)} {666*(11<=N)} 0 {b(11)*(fp1==fs1)}
Ga11 0 {12*(12<=N)} 0 {666*(12<=N)} {b(12)*(fp1==fs1)}
Ga12 0 {13*(13<=N)} {666*(13<=N)} 0 {b(13)*(fp1==fs1)}
Ga13 0 {14*(14<=N)} 0 {666*(14<=N)} {b(14)*(fp1==fs1)}
Ga14 0 {15*(15<=N)} {666*(15<=N)} 0 {b(15)*(fp1==fs1)}
Ga15 0 {16*(16<=N)} 0 {666*(16<=N)} {b(16)*(fp1==fs1)}
Ga16 0 {17*(17<=N)} {666*(17<=N)} 0 {b(17)*(fp1==fs1)}
Ga17 0 {18*(18<=N)} 0 {666*(18<=N)} {b(18)*(fp1==fs1)}
Ga18 0 {19*(19<=N)} {666*(19<=N)} 0 {b(19)*(fp1==fs1)}
Ga19 0 {20*(20<=N)} 0 {666*(20<=N)} {b(20)*(fp1==fs1)}
Ga20 0 {21*(21<=N)} {666*(21<=N)} 0 {b(21)*(fp1==fs1)}
Ga21 0 {22*(22<=N)} 0 {666*(22<=N)} {b(22)*(fp1==fs1)}
Ga22 0 {23*(23<=N)} {666*(23<=N)} 0 {b(23)*(fp1==fs1)}
Ga23 0 {24*(24<=N)} 0 {666*(24<=N)} {b(24)*(fp1==fs1)}
Ga24 0 {25*(25<=N)} {666*(25<=N)} 0 {b(25)*(fp1==fs1)}
Ga25 0 {26*(26<=N)} 0 {666*(26<=N)} {b(26)*(fp1==fs1)}
Ga26 0 {27*(27<=N)} {666*(27<=N)} 0 {b(27)*(fp1==fs1)}
Ga27 0 {28*(28<=N)} 0 {666*(28<=N)} {b(28)*(fp1==fs1)}
Ga28 0 {29*(29<=N)} {666*(29<=N)} 0 {b(29)*(fp1==fs1)}
Ga29 0 {30*(30<=N)} 0 {666*(30<=N)} {b(30)*(fp1==fs1)}
Ga30 0 {31*(31<=N)} {666*(31<=N)} 0 {b(31)*(fp1==fs1)}
Gb0 0 1 0 999 {b(1)}
Gb1 0 {2*(2<=N)} {1*(2<=N)} {999*(2<=N)} {b(2)}
Gb2 0 {3*(3<=N)} {2*(3<=N)} {999*(3<=N)} {b(3)}
Gb3 0 {4*(4<=N)} {3*(4<=N)} {999*(4<=N)} {b(4)}
Gb4 0 {5*(5<=N)} {4*(5<=N)} {999*(5<=N)} {b(5)}
Gb5 0 {6*(6<=N)} {5*(6<=N)} {999*(6<=N)} {b(6)}
Gb6 0 {7*(7<=N)} {6*(7<=N)} {999*(7<=N)} {b(7)}
Gb7 0 {8*(8<=N)} {7*(8<=N)} {999*(8<=N)} {b(8)}
Gb8 0 {9*(9<=N)} {8*(9<=N)} {999*(9<=N)} {b(9)}
Gb9 0 {10*(10<=N)} {9*(10<=N)} {999*(10<=N)} {b(10)}
Gb10 0 {11*(11<=N)} {10*(11<=N)} {999*(11<=N)} {b(11)}
Gb11 0 {12*(12<=N)} {11*(12<=N)} {999*(12<=N)} {b(12)}
Gb12 0 {13*(13<=N)} {12*(13<=N)} {999*(13<=N)} {b(13)}
Gb13 0 {14*(14<=N)} {13*(14<=N)} {999*(14<=N)} {b(14)}
Gb14 0 {15*(15<=N)} {14*(15<=N)} {999*(15<=N)} {b(15)}
Gb15 0 {16*(16<=N)} {15*(16<=N)} {999*(16<=N)} {b(16)}
Gb16 0 {17*(17<=N)} {16*(17<=N)} {999*(17<=N)} {b(17)}
Gb17 0 {18*(18<=N)} {17*(18<=N)} {999*(18<=N)} {b(18)}
Gb18 0 {19*(19<=N)} {18*(19<=N)} {999*(19<=N)} {b(19)}
Gb19 0 {20*(20<=N)} {19*(20<=N)} {999*(20<=N)} {b(20)}
Gb20 0 {21*(21<=N)} {20*(21<=N)} {999*(21<=N)} {b(21)}
Gb21 0 {22*(22<=N)} {21*(22<=N)} {999*(22<=N)} {b(22)}
Gb22 0 {23*(23<=N)} {22*(23<=N)} {999*(23<=N)} {b(23)}
Gb23 0 {24*(24<=N)} {23*(24<=N)} {999*(24<=N)} {b(24)}
Gb24 0 {25*(25<=N)} {24*(25<=N)} {999*(25<=N)} {b(25)}
Gb25 0 {26*(26<=N)} {25*(26<=N)} {999*(26<=N)} {b(26)}
Gb26 0 {27*(27<=N)} {26*(27<=N)} {999*(27<=N)} {b(27)}
Gb27 0 {28*(28<=N)} {27*(28<=N)} {999*(28<=N)} {b(28)}
Gb28 0 {29*(29<=N)} {28*(29<=N)} {999*(29<=N)} {b(29)}
Gb29 0 {30*(30<=N)} {29*(30<=N)} {999*(30<=N)} {b(30)}
Gb30 0 {31*(31<=N)} {30*(31<=N)} {999*(31<=N)} {b(31)}
Gb31 0 {32*(32<=N)} {31*(32<=N)} {999*(32<=N)} {b(32)}
Cs1 1 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs2 {2*(2<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs3 {3*(3<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs4 {4*(4<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs5 {5*(5<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs6 {6*(6<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs7 {7*(7<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs8 {8*(8<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs9 {9*(9<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs10 {10*(10<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs11 {11*(11<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs12 {12*(12<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs13 {13*(13<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs14 {14*(14<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs15 {15*(15<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs16 {16*(16<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs17 {17*(17<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs18 {18*(18<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs19 {19*(19<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs20 {20*(20<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs21 {21*(21<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs22 {22*(22<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs23 {23*(23<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs24 {24*(24<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs25 {25*(25<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs26 {26*(26<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs27 {27*(27<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs28 {28*(28<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs29 {29*(29<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs30 {30*(30<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs31 {31*(31<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs32 {32*(32<=N)} 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Gout 0 out 999 0 {G}
Rout out 0 1 noiseless
.ends Bessel
************************
*
*	Bessel
*
************************
*
* [NOTES]
*
* - This is the old one, because the new one seems to still give ugly noise in
* .AC.
*
***********************
.subckt Bessel2 in out 0.1 0.2 0.3
.param N=13
.param fp1=1k
.param fs1=1k
.param Asc=0
.param G=1
.param Rpar=1G
.param wsc=if( N==1,(10**(Asc/10)-u(Asc))**(-0.5/N),
+ (8091309.68544832*exp((-0.5)*(((ln(Asc**u(Asc))-54.61336204495193)/
+ 10.45931985911644)**2+((ln(N)-8.03901973218457)/
+ 3.262082976398164)**2))+.02602784079436049) )**(sgn(fs1-fp1)*u(Asc))
.param a_2=(fp1>fs1)  Cs=wsc**u(Asc)/2/pi/fp1
.func b(x)=if( x>N, 1, ((2*N-(a_2*N+a_2-1+sgn(.5-a_2)*x))*((a_2*N+a_2-1+sgn(.5-a_2)*x)+1)/
+ 2/(N-(a_2*N+a_2-1+sgn(.5-a_2)*x)))**sgn(.5-a_2) )
.func a(x)=(b(1)*b(2)*b(3)*b(4)*b(5)*b(6)*b(7)*b(8)*b(9)*b(10)*
+ b(11)*b(12)*b(13)*b(14)*b(15)*b(16)*b(17)*b(18)*b(19)*b(20)*
+ b(21)*b(22)*b(23)*b(24)*b(25)*b(26)*b(27)*b(28)*b(29)*b(30)*
+ b(31)*b(32))**sgn(a_2-.5)
Gb1 0 1 0 out {b(1)}
Gb2 0 2 1 out {b(2)}
Gb3 0 3 2 out {b(3)}
Gb4 0 4 3 out {b(4)}
Gb5 0 5 4 out {b(5)}
Gb6 0 6 5 out {b(6)}
Gb7 0 7 6 out {b(7)}
Gb8 0 8 7 out {b(8)}
Gb9 0 9 8 out {b(9)}
Gb10 0 10 9 out {b(10)}
Gb11 0 11 10 out {b(11)}
Gb12 0 12 11 out {b(12)}
Gb13 0 13 12 out {b(13)}
Gb14 0 14 13 out {b(14)}
Gb15 0 15 14 out {b(15)}
Gb16 0 16 15 out {b(16)}
Gb17 0 17 16 out {b(17)}
Gb18 0 18 17 out {b(18)}
Gb19 0 19 18 out {b(19)}
Gb20 0 20 19 out {b(20)}
Gb21 0 21 20 out {b(21)}
Gb22 0 22 21 out {b(22)}
Gb23 0 23 22 out {b(23)}
Gb24 0 24 23 out {b(24)}
Gb25 0 25 24 out {b(25)}
Gb26 0 26 25 out {b(26)}
Gb27 0 27 26 out {b(27)}
Gb28 0 28 27 out {b(28)}
Gb29 0 29 28 out {b(29)}
Gb30 0 30 29 out {b(30)}
Gb31 0 31 30 out {b(31)}
Gb32 0 32 31 out {b(32)}
Cs1 1 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs2 2 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs3 3 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs4 4 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs5 5 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs6 6 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs7 7 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs8 8 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs9 9 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs10 10 0 {Cs} Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Cs11 0 11 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs12 0 12 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs13 0 13 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs14 0 14 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs15 0 15 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs16 0 16 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs17 0 17 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs18 0 18 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs19 0 19 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs20 0 20 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs21 0 21 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs22 0 22 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs23 0 23 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs24 0 24 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs25 0 25 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs26 0 26 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs27 0 27 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs28 0 28 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs29 0 29 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs30 0 30 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs31 0 31 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Cs32 0 32 {Cs} Rser=0 Rpar={Rpar} Cpar=0 Lser=0 RLshunt=0 ic=0
Gan 0 out in 0 {a_2**inv(fp1==fs1)}
Ga0 0 1 in 0 {inv(a_2)*a(0)**a_2}
Ga2 0 2 0 in {b(2)*(fp1==fs1)}
Ga3 0 3 in 0 {b(3)*(fp1==fs1)}
Ga4 0 4 0 in {b(4)*(fp1==fs1)}
Ga5 0 5 in 0 {b(5)*(fp1==fs1)}
Ga6 0 6 0 in {b(6)*(fp1==fs1)}
Ga7 0 7 in 0 {b(7)*(fp1==fs1)}
Ga8 0 8 0 in {b(8)*(fp1==fs1)}
Ga9 0 9 in 0 {b(9)*(fp1==fs1)}
Ga10 0 10 0 in {b(10)*(fp1==fs1)}
Ga11 0 11 in 0 {b(11)*(fp1==fs1)}
Ga12 0 12 0 in {b(12)*(fp1==fs1)}
Ga13 0 13 in 0 {b(13)*(fp1==fs1)}
Ga14 0 14 0 in {b(14)*(fp1==fs1)}
Ga15 0 15 in 0 {b(15)*(fp1==fs1)}
Ga16 0 16 0 in {b(16)*(fp1==fs1)}
Ga17 0 17 in 0 {b(17)*(fp1==fs1)}
Ga18 0 18 0 in {b(18)*(fp1==fs1)}
Ga19 0 19 in 0 {b(19)*(fp1==fs1)}
Ga20 0 20 0 in {b(20)*(fp1==fs1)}
Ga21 0 21 in 0 {b(21)*(fp1==fs1)}
Ga22 0 22 0 in {b(22)*(fp1==fs1)}
Ga23 0 23 in 0 {b(23)*(fp1==fs1)}
Ga24 0 24 0 in {b(24)*(fp1==fs1)}
Ga25 0 25 in 0 {b(25)*(fp1==fs1)}
Ga26 0 26 0 in {b(26)*(fp1==fs1)}
Ga27 0 27 in 0 {b(27)*(fp1==fs1)}
Ga28 0 28 0 in {b(28)*(fp1==fs1)}
Ga29 0 29 in 0 {b(29)*(fp1==fs1)}
Ga30 0 30 0 in {b(30)*(fp1==fs1)}
Ga31 0 31 in 0 {b(31)*(fp1==fs1)}
Ga32 0 32 0 in {b(32)*(fp1==fs1)}
Gout 0 out {N} 0 {G}
Rout out 0 1 noiseless
.ends Bessel2
********************************
*
*	Butterworth
*
********************************
*
* Parameters: N, fp1, fs1, fp2, fs2, Asc, As, G (, Rpar)
* Supports: AP/LP/HP/BP/BS
* Pins used: IN, OUT, 0.1, 0.2
*
* Notes:
* - 
*
********************************
.subckt Butterworth in out 0.1 0.2 0.3
.param N=0
.param fp1=500
.param fs1=400
.param fp2=2k
.param fs2=2.5k
.param G=1
.param Asc=3
.param As=40
.param Cs=1/wc Rpar=1G
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fs1>0, 2,
+ if( fp1>fs1 & fp2<fs2 & fp1<fp2 & fs1>0, 3,
+ if( fp1<fs1 & fp2>fs2 & fp1<fp2 & fp1>0, 4, 0 ))))
.param es=10**(As/10)-1 esc=if(Asc>0,10**(Asc/10)-1,exp(-2*abs(log(ratio))*N)*es )
.param wc=2*pi*sqrt(fp1*((fp2-fp1)*(case>2)+fp1))  wsc=esc**(.5/Ord)
.param  BP=2*pi*(fp2-fp1)/wc  BS=2*pi*(fs2-fs1)/wc  ratio=BS/BP
.param Ord=(N==0)*ceil( log(es/esc)/2/abs(log(ratio)) )+N
.func par(x)=1-ceil(x/2)+floor(x/2)
.func imag(x)=if( case<=2, cos((2*x-1)*pi/2/Ord)*wsc**sgn(par(case)-.5),
+ if( x<=ceil(Ord/2), imbp1(x), imbp2(x-ceil(Ord/2)) ) )
.func rebp1(x)=(BP*sin((2*x-1)*pi/2/Ord)*wsc**sgn(par(case)-.5)-
+ sqrt(hypot(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(par(case)-.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(par(case)-.5))-4))*
+ cos(atan2(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(par(case)-.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(par(case)-.5))-4)/2))/2
.func imbp1(x)=(sqrt(hypot(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(par(case)-.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(par(case)-.5))-4))*
+ sin(atan2(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(par(case)-.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(par(case)-.5))-4)/2)-
+ BP*cos((2*x-1)*pi/2/Ord)*wsc**sgn(par(case)-.5))/2
.func rebp2(x)=(BP*sin((2*x-1)*pi/2/Ord)*wsc**sgn(par(case)-.5)+
+ sqrt(hypot(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(par(case)-.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(par(case)-.5))-4))*
+ cos(atan2(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(par(case)-.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(par(case)-.5))-4)/2))/2
.func imbp2(x)=(sqrt(hypot(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(par(case)-.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(par(case)-.5))-4))*
+ sin(atan2(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(par(case)-.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(par(case)-.5))-4)/2)+
+ BP*cos((2*x-1)*pi/2/Ord)*wsc**sgn(par(case)-.5))/2
.func a2(x)=par(case)
.func a1(x)=if( case==0 | (ceil(case/2)==1 & x==(Ord+1)/2), sgn(case-.5)*2**inv(case)*
+ real(x), if( case==3, 1, 0 ) )
.func a0(x)=if( case<=1, real(x)**2+imag(x)**2, if( case==4, 1, 0 ) )
.func b1(x)=real(x)+real(x+(case>2&x==Ord/2+.5)*x)
.func b0(x)=(real(x)**2+imag(x)**2)**inv(case>2&x==Ord/2+.5)
.func real(x)=if( case<=2, sin((2*x-1)*pi/2/Ord)*wsc**sgn(par(case)-.5),
+ if( x<=ceil(Ord/2), rebp1(x), rebp2(x-ceil(Ord/2)) ) )
Ga2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} in 0 {a2(1)}
Ga2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a2(2)}
Ga2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a2(3)}
Ga2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a2(4)}
Ga2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a2(5)}
Ga2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a2(6)}
Ga2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a2(7)}
Ga2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a2(8)}
Ga2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a2(9)}
Ga2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a2(10)}
Ga2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a2(11)}
Ga2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a2(12)}
Ga2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a2(13)}
Ga2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a2(14)}
Ga2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a2(15)}
Ga2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a2(16)}
Ga1_1 0 {1.2*(1<=ceil(Ord/2**(case<3)))} in 0 {a1(1)}
Ga1_2 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a1(2)}
Ga1_3 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a1(3)}
Ga1_4 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a1(4)}
Ga1_5 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a1(5)}
Ga1_6 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a1(6)}
Ga1_7 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a1(7)}
Ga1_8 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a1(8)}
Ga1_9 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a1(9)}
Ga1_10 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a1(10)}
Ga1_11 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a1(11)}
Ga1_12 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a1(12)}
Ga1_13 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a1(13)}
Ga1_14 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a1(14)}
Ga1_15 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a1(15)}
Ga1_16 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a1(16)}
Ga0_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} in 0 {a0(1)}
Ga0_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a0(2)}
Ga0_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a0(3)}
Ga0_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a0(4)}
Ga0_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a0(5)}
Ga0_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a0(6)}
Ga0_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a0(7)}
Ga0_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a0(8)}
Ga0_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a0(9)}
Ga0_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a0(10)}
Ga0_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a0(11)}
Ga0_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a0(12)}
Ga0_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a0(13)}
Ga0_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a0(14)}
Ga0_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a0(15)}
Ga0_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a0(16)}
Gb2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.2*(1<=ceil(Ord/2**(case<3)))} 0 1
Gb2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.2*(2<=ceil(Ord/2**(case<3)))} 0 1
Gb2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.2*(3<=ceil(Ord/2**(case<3)))} 0 1
Gb2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.2*(4<=ceil(Ord/2**(case<3)))} 0 1
Gb2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.2*(5<=ceil(Ord/2**(case<3)))} 0 1
Gb2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.2*(6<=ceil(Ord/2**(case<3)))} 0 1
Gb2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.2*(7<=ceil(Ord/2**(case<3)))} 0 1
Gb2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.2*(8<=ceil(Ord/2**(case<3)))} 0 1
Gb2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.2*(9<=ceil(Ord/2**(case<3)))} 0 1
Gb2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.2*(10<=ceil(Ord/2**(case<3)))} 0 1
Gb2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.2*(11<=ceil(Ord/2**(case<3)))} 0 1
Gb2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.2*(12<=ceil(Ord/2**(case<3)))} 0 1
Gb2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.2*(13<=ceil(Ord/2**(case<3)))} 0 1
Gb2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.2*(14<=ceil(Ord/2**(case<3)))} 0 1
Gb2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.2*(15<=ceil(Ord/2**(case<3)))} 0 1
Gb2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.2*(16<=ceil(Ord/2**(case<3)))} 0 1
Gb1_1 0 {1.2*(1<=ceil(Ord/2**(case<3)))} {1.1*(1<=ceil(Ord/2**(case<3)))} 1 {b1(1)}
Gb1_2 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {2.1*(2<=ceil(Ord/2**(case<3)))} 2 {b1(2)}
Gb1_3 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {3.1*(3<=ceil(Ord/2**(case<3)))} 3 {b1(3)}
Gb1_4 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {4.1*(4<=ceil(Ord/2**(case<3)))} 4 {b1(4)}
Gb1_5 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {5.1*(5<=ceil(Ord/2**(case<3)))} 5 {b1(5)}
Gb1_6 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {6.1*(6<=ceil(Ord/2**(case<3)))} 6 {b1(6)}
Gb1_7 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {7.1*(7<=ceil(Ord/2**(case<3)))} 7 {b1(7)}
Gb1_8 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {8.1*(8<=ceil(Ord/2**(case<3)))} 8 {b1(8)}
Gb1_9 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {9.1*(9<=ceil(Ord/2**(case<3)))} 9 {b1(9)}
Gb1_10 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {10.1*(10<=ceil(Ord/2**(case<3)))} 10 {b1(10)}
Gb1_11 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {11.1*(11<=ceil(Ord/2**(case<3)))} 11 {b1(11)}
Gb1_12 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {12.1*(12<=ceil(Ord/2**(case<3)))} 12 {b1(12)}
Gb1_13 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {13.1*(13<=ceil(Ord/2**(case<3)))} 13 {b1(13)}
Gb1_14 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {14.1*(14<=ceil(Ord/2**(case<3)))} 14 {b1(14)}
Gb1_15 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {15.1*(15<=ceil(Ord/2**(case<3)))} 15 {b1(15)}
Gb1_16 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {16.1*(16<=ceil(Ord/2**(case<3)))} 16 {b1(16)}
Gb0_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 1 {b0(1)}
Gb0_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 2 {b0(2)}
Gb0_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 3 {b0(3)}
Gb0_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 4 {b0(4)}
Gb0_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 5 {b0(5)}
Gb0_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 6 {b0(6)}
Gb0_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 7 {b0(7)}
Gb0_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 8 {b0(8)}
Gb0_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 9 {b0(9)}
Gb0_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 10 {b0(10)}
Gb0_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 11 {b0(11)}
Gb0_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 12 {b0(12)}
Gb0_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 13 {b0(13)}
Gb0_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 14 {b0(14)}
Gb0_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 15 {b0(15)}
Gb0_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 16 {b0(16)}
Cs1_1 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(1)} Rpar={Rpar}
Cs1_2 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(2)} Rpar={Rpar}
Cs1_3 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(3)} Rpar={Rpar}
Cs1_4 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(4)} Rpar={Rpar}
Cs1_5 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(5)} Rpar={Rpar}
Cs1_6 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(6)} Rpar={Rpar}
Cs1_7 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(7)} Rpar={Rpar}
Cs1_8 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(8)} Rpar={Rpar}
Cs1_9 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(9)} Rpar={Rpar}
Cs1_10 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(10)} Rpar={Rpar}
Cs1_11 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(11)} Rpar={Rpar}
Cs1_12 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(12)} Rpar={Rpar}
Cs1_13 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(13)} Rpar={Rpar}
Cs1_14 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(14)} Rpar={Rpar}
Cs1_15 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(15)} Rpar={Rpar}
Cs1_16 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(16)} Rpar={Rpar}
Cs2_1 {1.2*(1<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_2 {2.2*(2<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_3 {3.2*(3<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_4 {4.2*(4<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_5 {5.2*(5<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_6 {6.2*(6<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_7 {7.2*(7<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_8 {8.2*(8<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_9 {9.2*(9<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_10 {10.2*(10<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_11 {11.2*(11<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_12 {12.2*(12<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_13 {13.2*(13<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_14 {14.2*(14<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_15 {15.2*(15<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_16 {16.2*(16<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
R1 1 0 1
R2 2 0 1
R3 3 0 1
R4 4 0 1
R5 5 0 1
R6 6 0 1
R7 7 0 1
R8 8 0 1
R9 9 0 1
R10 10 0 1
R11 11 0 1
R12 12 0 1
R13 13 0 1
R14 14 0 1
R15 15 0 1
R16 16 0 1
Gout 0 out {if(case>=3,2,1)*ceil(Ord/2)-(par(Ord+1)&case>2)} 0
+ {G*(sgn(fp2-fp1)*BP/wsc)**((case==3)*Ord)}
Rout 0 out 1
VN 0.1 0 {Ord} AC {10**(Ord/20)} {Ord}
Vc 0.2 0 {case} AC {10**(case/20)} {case}
.ends Butterworth
********************************
*
*	Chebyshev, type I
*
********************************
*
* Parameters: N, fp1, fs1, fp2, fs2, Asc, Ap, As, G (, Rpar)
* Supports: AP/LP/HP/BP/BS
* Pins used: IN, OUT, 0.1, 0.2
*
* Notes:
* - 
*
********************************
.subckt Chebyshev in out 0.1 0.2 0.3
.param N=0
.param fp1=500
.param fs1=400
.param fp2=2k
.param fs2=2.5k
.param G=1
.param Ap=1
.param As=60
.param Asc=3
.param Cs=.5/pi/wc Rpar=1G
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fp1>0, 2,
+ if( fp1>fs1 & fp2<fs2 & fp1<fp2 & fp1>0, 3,
+ if( fp1<fs1 & fp2>fs2 & fp1<fp2 & fp1>0, 4, 0 ))))
.param esc=sqrt(10**(Asc/10)-1)   es=sqrt(10**(As/10)-1)
.param ep=if(Ap>0,1/sqrt(10**(Ap/10)-1),cosh(acosh(ratio)*N)/es)
.param wsc=cosh(acosh(ep*esc)/Ord)  wc=sqrt( fp1*( (fp2-fp1)*(case>2)+fp1 ) )
.param  BP=(fp2-fp1)/wc  BS=(fs2-fs1)/wc  ratio=(BS/BP)**sgn(par(case+1)-.5)
.param Ord=(N==0)*ceil(acosh(es/sqrt(10**if(Asc>Ap,sqrt(Ap*Asc)/20,Ap/10)**u(Ap)-1) )/
+ acosh(ratio))+N
.func par(x)=1-ceil(x/2)+floor(x/2)
.func den(x)=wsc*((cos((2*x-1)*pi/Ord)+cosh((2*asinh(ep))/Ord))/wsc**2/2)**par(case)
.func rebp1(x)=(BP*sin((2*x-1)*pi/2/Ord)*sinh(asinh(ep)/Ord)/den(x)-
+ sqrt(hypot(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-1/2)/den(x)**2-4))*
+ cos(atan2(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-1/2)/den(x)**2-4)/2))/2
.func imbp1(x)=(sqrt(hypot(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-1/2)/den(x)**2-4))*
+ sin(atan2(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-1/2)/den(x)**2-4)/2)-
+ BP*cos((2*x-1)*pi/2/Ord)*cosh(asinh(ep)/Ord)/den(x))/2
.func rebp2(x)=(BP*sin((2*x-1)*pi/2/Ord)*sinh(asinh(ep)/Ord)/den(x)+
+ sqrt(hypot(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-1/2)/den(x)**2-4))*
+ cos(atan2(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-1/2)/den(x)**2-4)/2))/2
.func imbp2(x)=(sqrt(hypot(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-1/2)/den(x)**2-4))*
+ sin(atan2(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-1/2)/den(x)**2-4)/2)+
+ BP*cos((2*x-1)*pi/2/Ord)*cosh(asinh(ep)/Ord)/den(x))/2
.func real(x)=if( case<=2, sin((2*x-1)*pi/2/Ord)*sinh(asinh(ep)/Ord)/den(x),
+ if( x<=ceil(Ord/2), rebp1(x), rebp2(x-ceil(Ord/2)) ) )
.func imag(x)=if( case<=2, cos((2*x-1)*pi/2/Ord)*cosh(asinh(ep)/Ord)/den(x),
+ if( x<=ceil(Ord/2), imbp1(x), imbp2(x-ceil(Ord/2)) ) )
.func a2(x)=par(case)
.func a1(x)=if( case==0 | ((case==1|case==2) & x==Ord/2+.5), sgn(case-.5)*2**inv(case)*
+ real(x), if( case==3, 1, 0 ) )
.func a0(x)=(case<2|case==4)*(real(x)**2+imag(x)**2)**(case<4)
.func b1(x)=real(x)+real(x+x*(case>2&x==Ord/2+.5))
.func b0(x)=(real(x)**2+imag(x)**2)**inv(case>2&x==Ord/2+.5)
.param Gain=((sgn(fp2-fp1)*BP/wsc)**Ord/(2**(Ord-1)/ep)*sqrt(1+ep**(-2)*
+ (par(Ord))) )**(case==3&par(case+1))
Ga2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} in 0 {a2(1)}
Ga2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a2(2)}
Ga2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a2(3)}
Ga2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a2(4)}
Ga2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a2(5)}
Ga2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a2(6)}
Ga2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a2(7)}
Ga2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a2(8)}
Ga2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a2(9)}
Ga2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a2(10)}
Ga2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a2(11)}
Ga2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a2(12)}
Ga2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a2(13)}
Ga2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a2(14)}
Ga2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a2(15)}
Ga2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a2(16)}
Ga1_1 0 {1.2*(1<=ceil(Ord/2**(case<3)))} in 0 {a1(1)}
Ga1_2 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a1(2)}
Ga1_3 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a1(3)}
Ga1_4 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a1(4)}
Ga1_5 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a1(5)}
Ga1_6 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a1(6)}
Ga1_7 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a1(7)}
Ga1_8 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a1(8)}
Ga1_9 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a1(9)}
Ga1_10 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a1(10)}
Ga1_11 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a1(11)}
Ga1_12 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a1(12)}
Ga1_13 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a1(13)}
Ga1_14 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a1(14)}
Ga1_15 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a1(15)}
Ga1_16 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a1(16)}
Ga0_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} in 0 {a0(1)}
Ga0_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a0(2)}
Ga0_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a0(3)}
Ga0_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a0(4)}
Ga0_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a0(5)}
Ga0_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a0(6)}
Ga0_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a0(7)}
Ga0_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a0(8)}
Ga0_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a0(9)}
Ga0_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a0(10)}
Ga0_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a0(11)}
Ga0_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a0(12)}
Ga0_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a0(13)}
Ga0_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a0(14)}
Ga0_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a0(15)}
Ga0_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a0(16)}
Gb2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.2*(1<=ceil(Ord/2**(case<3)))} 0 1
Gb2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.2*(2<=ceil(Ord/2**(case<3)))} 0 1
Gb2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.2*(3<=ceil(Ord/2**(case<3)))} 0 1
Gb2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.2*(4<=ceil(Ord/2**(case<3)))} 0 1
Gb2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.2*(5<=ceil(Ord/2**(case<3)))} 0 1
Gb2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.2*(6<=ceil(Ord/2**(case<3)))} 0 1
Gb2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.2*(7<=ceil(Ord/2**(case<3)))} 0 1
Gb2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.2*(8<=ceil(Ord/2**(case<3)))} 0 1
Gb2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.2*(9<=ceil(Ord/2**(case<3)))} 0 1
Gb2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.2*(10<=ceil(Ord/2**(case<3)))} 0 1
Gb2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.2*(11<=ceil(Ord/2**(case<3)))} 0 1
Gb2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.2*(12<=ceil(Ord/2**(case<3)))} 0 1
Gb2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.2*(13<=ceil(Ord/2**(case<3)))} 0 1
Gb2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.2*(14<=ceil(Ord/2**(case<3)))} 0 1
Gb2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.2*(15<=ceil(Ord/2**(case<3)))} 0 1
Gb2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.2*(16<=ceil(Ord/2**(case<3)))} 0 1
Gb1_1 0 {1.2*(1<=ceil(Ord/2**(case<3)))} {1.1*(1<=ceil(Ord/2**(case<3)))} 1 {b1(1)}
Gb1_2 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {2.1*(2<=ceil(Ord/2**(case<3)))} 2 {b1(2)}
Gb1_3 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {3.1*(3<=ceil(Ord/2**(case<3)))} 3 {b1(3)}
Gb1_4 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {4.1*(4<=ceil(Ord/2**(case<3)))} 4 {b1(4)}
Gb1_5 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {5.1*(5<=ceil(Ord/2**(case<3)))} 5 {b1(5)}
Gb1_6 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {6.1*(6<=ceil(Ord/2**(case<3)))} 6 {b1(6)}
Gb1_7 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {7.1*(7<=ceil(Ord/2**(case<3)))} 7 {b1(7)}
Gb1_8 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {8.1*(8<=ceil(Ord/2**(case<3)))} 8 {b1(8)}
Gb1_9 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {9.1*(9<=ceil(Ord/2**(case<3)))} 9 {b1(9)}
Gb1_10 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {10.1*(10<=ceil(Ord/2**(case<3)))} 10 {b1(10)}
Gb1_11 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {11.1*(11<=ceil(Ord/2**(case<3)))} 11 {b1(11)}
Gb1_12 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {12.1*(12<=ceil(Ord/2**(case<3)))} 12 {b1(12)}
Gb1_13 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {13.1*(13<=ceil(Ord/2**(case<3)))} 13 {b1(13)}
Gb1_14 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {14.1*(14<=ceil(Ord/2**(case<3)))} 14 {b1(14)}
Gb1_15 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {15.1*(15<=ceil(Ord/2**(case<3)))} 15 {b1(15)}
Gb1_16 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {16.1*(16<=ceil(Ord/2**(case<3)))} 16 {b1(16)}
Gb0_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 1 {b0(1)}
Gb0_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 2 {b0(2)}
Gb0_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 3 {b0(3)}
Gb0_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 4 {b0(4)}
Gb0_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 5 {b0(5)}
Gb0_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 6 {b0(6)}
Gb0_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 7 {b0(7)}
Gb0_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 8 {b0(8)}
Gb0_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 9 {b0(9)}
Gb0_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 10 {b0(10)}
Gb0_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 11 {b0(11)}
Gb0_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 12 {b0(12)}
Gb0_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 13 {b0(13)}
Gb0_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 14 {b0(14)}
Gb0_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 15 {b0(15)}
Gb0_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 16 {b0(16)}
Cs1_1 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(1)} Rpar={Rpar}
Cs1_2 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(2)} Rpar={Rpar}
Cs1_3 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(3)} Rpar={Rpar}
Cs1_4 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(4)} Rpar={Rpar}
Cs1_5 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(5)} Rpar={Rpar}
Cs1_6 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(6)} Rpar={Rpar}
Cs1_7 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(7)} Rpar={Rpar}
Cs1_8 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(8)} Rpar={Rpar}
Cs1_9 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(9)} Rpar={Rpar}
Cs1_10 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(10)} Rpar={Rpar}
Cs1_11 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(11)} Rpar={Rpar}
Cs1_12 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(12)} Rpar={Rpar}
Cs1_13 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(13)} Rpar={Rpar}
Cs1_14 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(14)} Rpar={Rpar}
Cs1_15 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(15)} Rpar={Rpar}
Cs1_16 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(16)} Rpar={Rpar}
Cs2_1 {1.2*(1<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_2 {2.2*(2<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_3 {3.2*(3<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_4 {4.2*(4<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_5 {5.2*(5<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_6 {6.2*(6<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_7 {7.2*(7<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_8 {8.2*(8<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_9 {9.2*(9<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_10 {10.2*(10<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_11 {11.2*(11<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_12 {12.2*(12<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_13 {13.2*(13<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_14 {14.2*(14<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_15 {15.2*(15<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_16 {16.2*(16<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
R1 1 0 1
R2 2 0 1
R3 3 0 1
R4 4 0 1
R5 5 0 1
R6 6 0 1
R7 7 0 1
R8 8 0 1
R9 9 0 1
R10 10 0 1
R11 11 0 1
R12 12 0 1
R13 13 0 1
R14 14 0 1
R15 15 0 1
R16 16 0 1
Gout 0 out {if(case>=3,2,1)*ceil(Ord/2)-u(par(Ord+1)&case>2)} 0 {G*Gain}
Rout 0 out 1
VN 0.1 0 {Ord} AC {10**(Ord/20)} {Ord}
Vc 0.2 0 {case} AC {10**(case/20)} {case}
.ends Chebyshev
********************************
*
*	Chebyshev, type II
*
********************************
*
* Parameters: N, fp1, fs1, fp2, fs2, Asc, As, G (, Rpar)
* Supports: LP/HP/BP/BS
* Pins used: IN, OUT, 0.1, 0.2
*
* Notes:
* - If Asc>=As when N=0, "As" will be considered.
*
********************************
.subckt InvChebyshev in out 0.1 0.2 0.3
.param N=0
.param fp1=500
.param fs1=400
.param fp2=2k
.param fs2=2.5k
.param G=1
.param As=60
.param Asc=3
.param Cs=.5/pi/wc Rpar=1G
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fs1>0, 2,
+ if( fp1>fs1 & fp2<fs2 & fp1<fp2 & fs1>0, 3,
+ if( fp1<fs1 & fp2>fs2 & fp1<fp2 & fp1>0, 4, 0 ))))
.param esc=if(Asc>0,sqrt(10**(Asc/10)-1),sqrt(10**(As/10)-1)/cosh(N*acosh(ratio)) )
.param es=if(As>0,sqrt(10**(As/10)-1),cosh(N*acosh(ratio))*esc )
.param wsc=cosh(acosh(es/esc)/Ord)  wc=sqrt(fp1*((fp2-fp1)*(case>2)+fp1))
.param  BP=(fp2-fp1)/wc  BS=(fs2-fs1)/wc
.param ratio=(BS/BP)**sgn(par(case+1)-.5)
.param Ord=if(N==0,ceil( acosh(es/esc**inv(Asc>=As))/acosh(ratio)),N)
.func par(x)=1-ceil(x/2)+floor(x/2)
.func den(x)=wsc*((cos((2*x-1)*pi/Ord)+cosh((2*asinh(es))/Ord))/wsc**2/2)**par(case+1)
.func rebp1(x)=(BP*sin((2*x-1)*pi/2/Ord)*sinh(asinh(es)/Ord)/den(x)-
+ sqrt(hypot(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4))*
+ cos(atan2(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4)/2))/2
.func imbp1(x)=(sqrt(hypot(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4))*
+ sin(atan2(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4)/2)-
+ BP*cos((2*x-1)*pi/2/Ord)*cosh(asinh(es)/Ord)/den(x))/2
.func rebp2(x)=(BP*sin((2*x-1)*pi/2/Ord)*sinh(asinh(es)/Ord)/den(x)+
+ sqrt(hypot(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4))*
+ cos(atan2(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4)/2))/2
.func imbp2(x)=(sqrt(hypot(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4))*
+ sin(atan2(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4)/2)+
+ BP*cos((2*x-1)*pi/2/Ord)*cosh(asinh(es)/Ord)/den(x))/2
.func zebp1(x)=(sqrt(BP**2*(cos((2*x-1)*pi/2/Ord)/wsc)**(2*sgn(par(case)-.5))+4)-
+ BP*(cos((2*x-1)*pi/2/Ord)/wsc)**sgn(par(case)-.5))/2
.func zebp2(x)=(sqrt(BP**2*(cos((2*x-1)*pi/2/Ord)/wsc)**(2*sgn(par(case)-.5))+4)+
+ BP*(cos((2*x-1)*pi/2/Ord)/wsc)**sgn(par(case)-.5))/2
.func real(x)=if( case<=2, sin((2*x-1)*pi/2/Ord)*sinh(asinh(es)/Ord)/den(x),
+ if( x<=ceil(Ord/2), rebp1(x), rebp2(x-ceil(Ord/2)) ) )
.func imag(x)=if( case<=2, cos((2*x-1)*pi/2/Ord)*cosh(asinh(es)/Ord)/den(x),
+ if( x<=ceil(Ord/2), imbp1(x), imbp2(x-ceil(Ord/2)) ) )
.func zero(x)=if( case<=2, (cos((2*x-1)*pi/2/Ord)/wsc)**sgn(par(case)-.5),
+ if( x<=ceil(Ord/2), zebp1(x), zebp2(x-ceil(Ord/2)) ) )
.func a2(x)=inv(x==Ord/2+.5&par(case+1))
.func a1(x)=(x==Ord/2+.5&case<4)*real(x)**inv(case==3)
.func a0(x)=if( x==Ord/2+.5, (real(x)**2)*(case==1)+(case==4), zero(x)**2 )
.func b1(x)=real(x)+real(x+(x==Ord/2+.5&case>2)*x)
.func b0(x)=(real(x)**2+imag(x)**2)**inv(x==Ord/2+.5&case>2)
Ga2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} in 0 {a2(1)}
Ga2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a2(2)}
Ga2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a2(3)}
Ga2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a2(4)}
Ga2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a2(5)}
Ga2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a2(6)}
Ga2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a2(7)}
Ga2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a2(8)}
Ga2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a2(9)}
Ga2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a2(10)}
Ga2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a2(11)}
Ga2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a2(12)}
Ga2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a2(13)}
Ga2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a2(14)}
Ga2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a2(15)}
Ga2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a2(16)}
Ga1_1 0 {1.2*(1<=ceil(Ord/2**(case<3)))} in 0 {a1(1)}
Ga1_2 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a1(2)}
Ga1_3 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a1(3)}
Ga1_4 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a1(4)}
Ga1_5 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a1(5)}
Ga1_6 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a1(6)}
Ga1_7 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a1(7)}
Ga1_8 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a1(8)}
Ga1_9 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a1(9)}
Ga1_10 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a1(10)}
Ga1_11 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a1(11)}
Ga1_12 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a1(12)}
Ga1_13 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a1(13)}
Ga1_14 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a1(14)}
Ga1_15 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a1(15)}
Ga1_16 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a1(16)}
Ga0_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} in 0 {a0(1)}
Ga0_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a0(2)}
Ga0_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a0(3)}
Ga0_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a0(4)}
Ga0_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a0(5)}
Ga0_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a0(6)}
Ga0_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a0(7)}
Ga0_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a0(8)}
Ga0_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a0(9)}
Ga0_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a0(10)}
Ga0_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a0(11)}
Ga0_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a0(12)}
Ga0_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a0(13)}
Ga0_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a0(14)}
Ga0_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a0(15)}
Ga0_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a0(16)}
Gb2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.2*(1<=ceil(Ord/2**(case<3)))} 0 1
Gb2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.2*(2<=ceil(Ord/2**(case<3)))} 0 1
Gb2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.2*(3<=ceil(Ord/2**(case<3)))} 0 1
Gb2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.2*(4<=ceil(Ord/2**(case<3)))} 0 1
Gb2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.2*(5<=ceil(Ord/2**(case<3)))} 0 1
Gb2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.2*(6<=ceil(Ord/2**(case<3)))} 0 1
Gb2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.2*(7<=ceil(Ord/2**(case<3)))} 0 1
Gb2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.2*(8<=ceil(Ord/2**(case<3)))} 0 1
Gb2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.2*(9<=ceil(Ord/2**(case<3)))} 0 1
Gb2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.2*(10<=ceil(Ord/2**(case<3)))} 0 1
Gb2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.2*(11<=ceil(Ord/2**(case<3)))} 0 1
Gb2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.2*(12<=ceil(Ord/2**(case<3)))} 0 1
Gb2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.2*(13<=ceil(Ord/2**(case<3)))} 0 1
Gb2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.2*(14<=ceil(Ord/2**(case<3)))} 0 1
Gb2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.2*(15<=ceil(Ord/2**(case<3)))} 0 1
Gb2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.2*(16<=ceil(Ord/2**(case<3)))} 0 1
Gb1_1 0 {1.2*(1<=ceil(Ord/2**(case<3)))} {1.1*(1<=ceil(Ord/2**(case<3)))} 1 {b1(1)}
Gb1_2 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {2.1*(2<=ceil(Ord/2**(case<3)))} 2 {b1(2)}
Gb1_3 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {3.1*(3<=ceil(Ord/2**(case<3)))} 3 {b1(3)}
Gb1_4 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {4.1*(4<=ceil(Ord/2**(case<3)))} 4 {b1(4)}
Gb1_5 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {5.1*(5<=ceil(Ord/2**(case<3)))} 5 {b1(5)}
Gb1_6 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {6.1*(6<=ceil(Ord/2**(case<3)))} 6 {b1(6)}
Gb1_7 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {7.1*(7<=ceil(Ord/2**(case<3)))} 7 {b1(7)}
Gb1_8 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {8.1*(8<=ceil(Ord/2**(case<3)))} 8 {b1(8)}
Gb1_9 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {9.1*(9<=ceil(Ord/2**(case<3)))} 9 {b1(9)}
Gb1_10 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {10.1*(10<=ceil(Ord/2**(case<3)))} 10 {b1(10)}
Gb1_11 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {11.1*(11<=ceil(Ord/2**(case<3)))} 11 {b1(11)}
Gb1_12 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {12.1*(12<=ceil(Ord/2**(case<3)))} 12 {b1(12)}
Gb1_13 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {13.1*(13<=ceil(Ord/2**(case<3)))} 13 {b1(13)}
Gb1_14 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {14.1*(14<=ceil(Ord/2**(case<3)))} 14 {b1(14)}
Gb1_15 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {15.1*(15<=ceil(Ord/2**(case<3)))} 15 {b1(15)}
Gb1_16 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {16.1*(16<=ceil(Ord/2**(case<3)))} 16 {b1(16)}
Gb0_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 1 {b0(1)}
Gb0_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 2 {b0(2)}
Gb0_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 3 {b0(3)}
Gb0_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 4 {b0(4)}
Gb0_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 5 {b0(5)}
Gb0_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 6 {b0(6)}
Gb0_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 7 {b0(7)}
Gb0_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 8 {b0(8)}
Gb0_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 9 {b0(9)}
Gb0_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 10 {b0(10)}
Gb0_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 11 {b0(11)}
Gb0_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 12 {b0(12)}
Gb0_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 13 {b0(13)}
Gb0_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 14 {b0(14)}
Gb0_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 15 {b0(15)}
Gb0_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 16 {b0(16)}
Cs1_1 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(1)} Rpar={Rpar}
Cs1_2 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(2)} Rpar={Rpar}
Cs1_3 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(3)} Rpar={Rpar}
Cs1_4 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(4)} Rpar={Rpar}
Cs1_5 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(5)} Rpar={Rpar}
Cs1_6 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(6)} Rpar={Rpar}
Cs1_7 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(7)} Rpar={Rpar}
Cs1_8 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(8)} Rpar={Rpar}
Cs1_9 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(9)} Rpar={Rpar}
Cs1_10 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(10)} Rpar={Rpar}
Cs1_11 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(11)} Rpar={Rpar}
Cs1_12 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(12)} Rpar={Rpar}
Cs1_13 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(13)} Rpar={Rpar}
Cs1_14 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(14)} Rpar={Rpar}
Cs1_15 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(15)} Rpar={Rpar}
Cs1_16 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(16)} Rpar={Rpar}
Cs2_1 {1.2*(1<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_2 {2.2*(2<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_3 {3.2*(3<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_4 {4.2*(4<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_5 {5.2*(5<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_6 {6.2*(6<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_7 {7.2*(7<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_8 {8.2*(8<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_9 {9.2*(9<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_10 {10.2*(10<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_11 {11.2*(11<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_12 {12.2*(12<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_13 {13.2*(13<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_14 {14.2*(14<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_15 {15.2*(15<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_16 {16.2*(16<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
R1 1 0 1
R2 2 0 1
R3 3 0 1
R4 4 0 1
R5 5 0 1
R6 6 0 1
R7 7 0 1
R8 8 0 1
R9 9 0 1
R10 10 0 1
R11 11 0 1
R12 12 0 1
R13 13 0 1
R14 14 0 1
R15 15 0 1
R16 16 0 1
.param Gain=(es**(-(par(case+1)&par(Ord)))*(sgn(fp2-fp1)*BP*Ord*wsc/
+ real(ceil(Ord/2))**(case==1&par(Ord+1))/sqrt(1+es**2))**par(Ord+1))**par(case+1)
Gout 0 out {if(case>=3,2,1)*ceil(Ord/2)-u(par(Ord+1)&case>2)} 0 {G*Gain}
Rout 0 out 1
VN 0.1 0 {Ord} AC {10**(Ord/20)} {Ord}
Vc 0.2 0 {case} AC {10**(case/20)} {case}
.ends InvChebyshev
********************************
*
*	Cauer (Elliptic)
*
********************************
*
* Parameters: N, fp1, fs1, fp2, fs2, Ap, As, G (, Rpar)
* Supports: LP/HP/BP/BS
* Pins used: IN, OUT, 0.1, 0.2
*
* Notes:
* - Simulation is delayed a bit because of the computational-intensive formulas.
* Even so, the simulation itself isn't slow, on the contrary.
* - Accuracy is usually 3 to 4 decimals or better, but can drop to ~2~3 if using
* verylarge/small values for attenuations. E.g., a 32nd order (N=0) LP with
* Ap=0.001 @fp1=1 and As=260 @fs1=1.1 will have a droop of maximum 0.2mdB
* towards the end of the pass-band.
* - While the above is possible, imposing N for the same conditions will show a
* real slope but with a many hundreds of dB attenuation and there may be other
* cases like this; it's because the elliptic nome q1 will get too small values
* for the matrix solver. Choosing the alternate solver may help a bit, but not
* much. In short, try to keep As<120 when N>0, overly exaggerated values will
* not be without consequences.
*
********************************
.subckt Cauer in out 0.1 0.2 0.3
.param N=0
.param fp1=500
.param fs1=400
.param fp2=2k
.param fs2=2.5k
.param Ap=1
.param As=60
.param G=1
.param Rpar=1G
.param Cs=.5/pi/wc
.param ep=if(Ap>0,(10**(Ap*.1)-1)**.5,4*(10**(As*.1)-1)**.5*exp(log(nomeqq)*N/2) )
.param es=if(As>0,(10**(As*.1)-1)**.5,(10**(Ap*.1)-1)**.5/4*exp(-log(nomeqq)*N/2) )
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fs1>0, 2,
+ if( fp1>fs1 & fp2<fs2 & fp1<fp2 & fs1>0, 3,
+ if( fp1<fs1 & fp2>fs2 & fp1<fp2 & fp1>0, 4, 0 ))))
.param wc=sqrt( fp1*( (fp2-fp1)*(case>2)+fp1 ) )  BP=(fp2-fp1)/wc  BS=(fs2-fs1)/wc
.param modk1=ep/es  modkk=(BS/BP)**sgn(par(case)-.5)
.param modk2=4*nomeq2**.5*(1+4*nomeq2**2)**.5/(1+2*nomeq2)**2
.param h0=.5*(1-(1-modkk**2)**.25)/(1+(1-modkk**2)**.25)
.param nomeq2=nomeq1**(1/N**u(N))  nomeqq=h0*(1+2*h0**4)
.param nomeq1=exp(-pi*ellK((1-modk1**2))/ellK(modk1**2))
.param nomeq=if(N==0,nomeqq,nomeq2)  modk=if(N==0,modkk,modk2)
.param Ord=if( N==0, ceil(2*log(4*es/ep)/log(1/nomeq)), N )
.param Lambda=.5/Ord*log((sqrt(ep**2+1)+1)/(sqrt(ep**2+1)-1))
.func par(x)=1-ceil(x/2)+floor(x/2)
.func ellK(x)=(2**4.875*pi)/(2**.875*sqrt(1-x)+2**1.875*(1-x)**.25+2**2.375* 
+ sqrt(sqrt(1-x)+1)*(1-x)**.125+2**2.625*(sqrt(1-x)+1)**.25*sqrt(sqrt(1-x)+ 
+ 2*(1-x)**.25+1)*(1-x)**.0625+2**2.5*(sqrt(1-x)+1)**.125* 
+ (sqrt(1-x)+2*(1-x)**.25+1)**.25*sqrt(sqrt(2)*sqrt(1-x)+2**1.5*(1-x)**.25+ 
+ 4*sqrt(sqrt(1-x)+1)*(1-x)**.125+sqrt(2))*(1-x)**.03125+2**.875)
.func ze_(x)=(nomeq**.25*(nomeq**6*sin(5*pi*((x-0.5)/Ord+0.5))-
+ nomeq**2*sin(3*pi*((x-0.5)/Ord+0.5))+sin(pi*((x-0.5)/Ord+0.5))))/
+ (nomeq**4*cos(4*pi*((x-0.5)/Ord+0.5))-nomeq*cos(2*pi*((x-0.5)/Ord+0.5))+0.5)/sqrt(modk)
.param real0=(nomeq**.25*(nomeq**6*sinh(5*Lambda)-nomeq**2*sinh(3*Lambda)+
+ sinh(Lambda)))/(nomeq**4*cosh(4*Lambda)-nomeq*cosh(2*Lambda)+0.5)
.func Q0(x)=ze_(x)/(2*real0)*sqrt((real0**2+ze_(x)**2*modk)*(real0**2*modk+ze_(x)**(-2))/
+ ((1-(ze_(x)*modk)**2)*(1-ze_(x)**2)))
.func bi0(x)=(real0**2/modk+ze_(x)**2)/(1+(real0*ze_(x))**2*modk)
.func Iarg(x)=BP**2*(bi0(x)*sqrt(1-.25/Q0(x)**2)/Q0(x))/bi0(x)**(2*par(case))
.func Rarg(x)=BP**2*bi0(x)*(.5/Q0(x)**2-1)/bi0(x)**(2*par(case))-4
.func rebp1(x)=(BP*bi0(x)**.5/2/Q0(x)/bi0(x)**par(case)-
+ sqrt(hypot(Iarg(x),Rarg(x)))*cos(atan2(Iarg(x),Rarg(x))/2))/2
.func imbp1(x)=(sqrt(hypot(Iarg(x),Rarg(x)))*sin(atan2(Iarg(x),Rarg(x))/2)-
+ BP*sqrt(bi0(x)*(1-.25/Q0(x)**2))/bi0(x)**par(case))/2
.func rebp2(x)=(BP*bi0(x)**.5/2/Q0(x)/bi0(x)**par(case)+
+ sqrt(hypot(Iarg(x),Rarg(x)))*cos(atan2(Iarg(x),Rarg(x))/2))/2
.func imbp2(x)=(sqrt(hypot(Iarg(x),Rarg(x)))*sin(atan2(Iarg(x),Rarg(x))/2)+
+ BP*sqrt(bi0(x)*(1-.25/Q0(x)**2))/bi0(x)**par(case))/2
.func zebp1(x)=(sqrt(BP**2*(modk*ze_(x))**(2*sgn(par(case)-.5))+4)-
+ BP*(modk*ze_(x))**sgn(par(case)-.5))/2
.func zebp2(x)=(sqrt(BP**2*(modk*ze_(x))**(2*sgn(par(case)-.5))+4)+
+ BP*(modk*ze_(x))**sgn(par(case)-.5))/2
.func real(x)=if( case<3, bi0(x)**.5/2/Q0(x)/bi0(x)**par(case),
+ if( x<=ceil(Ord/2), rebp1(x), rebp2(x-ceil(Ord/2)) ) )
.func imag(x)=if( case<3, sqrt(bi0(x)*(1-.25/Q0(x)**2))/bi0(x)**par(case),
+ if( x<=ceil(Ord/2), imbp1(x), imbp2(x-ceil(Ord/2)) ) )
.func zero(x)=if( case<3, (modk*ze_(x))**sgn(par(case)-.5),
+ if( x<=ceil(Ord/2), zebp1(x), zebp2(x-ceil(Ord/2)) ) )
.func a2(x)=inv(x==Ord/2+.5&par(case+1))
.func a1(x)=if( x==Ord/2+.5, (case<3)*real(x)+(case==3), 0 )
.func a0(x)=if( x==Ord/2+.5, (case==1)*real(x)**2+(case==4), zero(x)**2 )
.func b1(x)=real(x)+real(x*(x==Ord/2+.5&case>2)+x)
.func b0(x)=(real(x)**2+imag(x)**2)**inv(x==Ord/2+.5&case>2)
Ga2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} in 0 {a2(1)}
Ga2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a2(2)}
Ga2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a2(3)}
Ga2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a2(4)}
Ga2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a2(5)}
Ga2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a2(6)}
Ga2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a2(7)}
Ga2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a2(8)}
Ga2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a2(9)}
Ga2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a2(10)}
Ga2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a2(11)}
Ga2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a2(12)}
Ga2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a2(13)}
Ga2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a2(14)}
Ga2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a2(15)}
Ga2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a2(16)}
Ga1_1 0 {1.2*(1<=ceil(Ord/2**(case<3)))} in 0 {a1(1)}
Ga1_2 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a1(2)}
Ga1_3 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a1(3)}
Ga1_4 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a1(4)}
Ga1_5 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a1(5)}
Ga1_6 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a1(6)}
Ga1_7 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a1(7)}
Ga1_8 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a1(8)}
Ga1_9 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a1(9)}
Ga1_10 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a1(10)}
Ga1_11 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a1(11)}
Ga1_12 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a1(12)}
Ga1_13 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a1(13)}
Ga1_14 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a1(14)}
Ga1_15 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a1(15)}
Ga1_16 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a1(16)}
Ga0_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} in 0 {a0(1)}
Ga0_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {a0(2)}
Ga0_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {a0(3)}
Ga0_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {a0(4)}
Ga0_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {a0(5)}
Ga0_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {a0(6)}
Ga0_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {a0(7)}
Ga0_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {a0(8)}
Ga0_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {a0(9)}
Ga0_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {a0(10)}
Ga0_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {a0(11)}
Ga0_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {a0(12)}
Ga0_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {a0(13)}
Ga0_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {a0(14)}
Ga0_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {a0(15)}
Ga0_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {a0(16)}
Gb2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.2*(1<=ceil(Ord/2**(case<3)))} 0 1
Gb2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.2*(2<=ceil(Ord/2**(case<3)))} 0 1
Gb2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.2*(3<=ceil(Ord/2**(case<3)))} 0 1
Gb2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.2*(4<=ceil(Ord/2**(case<3)))} 0 1
Gb2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.2*(5<=ceil(Ord/2**(case<3)))} 0 1
Gb2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.2*(6<=ceil(Ord/2**(case<3)))} 0 1
Gb2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.2*(7<=ceil(Ord/2**(case<3)))} 0 1
Gb2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.2*(8<=ceil(Ord/2**(case<3)))} 0 1
Gb2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.2*(9<=ceil(Ord/2**(case<3)))} 0 1
Gb2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.2*(10<=ceil(Ord/2**(case<3)))} 0 1
Gb2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.2*(11<=ceil(Ord/2**(case<3)))} 0 1
Gb2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.2*(12<=ceil(Ord/2**(case<3)))} 0 1
Gb2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.2*(13<=ceil(Ord/2**(case<3)))} 0 1
Gb2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.2*(14<=ceil(Ord/2**(case<3)))} 0 1
Gb2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.2*(15<=ceil(Ord/2**(case<3)))} 0 1
Gb2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.2*(16<=ceil(Ord/2**(case<3)))} 0 1
Gb1_1 0 {1.2*(1<=ceil(Ord/2**(case<3)))} {1.1*(1<=ceil(Ord/2**(case<3)))} 1 {b1(1)}
Gb1_2 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {2.1*(2<=ceil(Ord/2**(case<3)))} 2 {b1(2)}
Gb1_3 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {3.1*(3<=ceil(Ord/2**(case<3)))} 3 {b1(3)}
Gb1_4 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {4.1*(4<=ceil(Ord/2**(case<3)))} 4 {b1(4)}
Gb1_5 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {5.1*(5<=ceil(Ord/2**(case<3)))} 5 {b1(5)}
Gb1_6 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {6.1*(6<=ceil(Ord/2**(case<3)))} 6 {b1(6)}
Gb1_7 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {7.1*(7<=ceil(Ord/2**(case<3)))} 7 {b1(7)}
Gb1_8 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {8.1*(8<=ceil(Ord/2**(case<3)))} 8 {b1(8)}
Gb1_9 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {9.1*(9<=ceil(Ord/2**(case<3)))} 9 {b1(9)}
Gb1_10 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {10.1*(10<=ceil(Ord/2**(case<3)))} 10 {b1(10)}
Gb1_11 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {11.1*(11<=ceil(Ord/2**(case<3)))} 11 {b1(11)}
Gb1_12 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {12.1*(12<=ceil(Ord/2**(case<3)))} 12 {b1(12)}
Gb1_13 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {13.1*(13<=ceil(Ord/2**(case<3)))} 13 {b1(13)}
Gb1_14 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {14.1*(14<=ceil(Ord/2**(case<3)))} 14 {b1(14)}
Gb1_15 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {15.1*(15<=ceil(Ord/2**(case<3)))} 15 {b1(15)}
Gb1_16 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {16.1*(16<=ceil(Ord/2**(case<3)))} 16 {b1(16)}
Gb0_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 1 {b0(1)}
Gb0_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 2 {b0(2)}
Gb0_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 3 {b0(3)}
Gb0_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 4 {b0(4)}
Gb0_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 5 {b0(5)}
Gb0_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 6 {b0(6)}
Gb0_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 7 {b0(7)}
Gb0_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 8 {b0(8)}
Gb0_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 9 {b0(9)}
Gb0_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 10 {b0(10)}
Gb0_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 11 {b0(11)}
Gb0_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 12 {b0(12)}
Gb0_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 13 {b0(13)}
Gb0_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 14 {b0(14)}
Gb0_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 15 {b0(15)}
Gb0_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 16 {b0(16)}
Cs1_1 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(1)} Rpar={Rpar}
Cs1_2 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(2)} Rpar={Rpar}
Cs1_3 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(3)} Rpar={Rpar}
Cs1_4 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(4)} Rpar={Rpar}
Cs1_5 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(5)} Rpar={Rpar}
Cs1_6 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(6)} Rpar={Rpar}
Cs1_7 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(7)} Rpar={Rpar}
Cs1_8 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(8)} Rpar={Rpar}
Cs1_9 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(9)} Rpar={Rpar}
Cs1_10 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(10)} Rpar={Rpar}
Cs1_11 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(11)} Rpar={Rpar}
Cs1_12 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(12)} Rpar={Rpar}
Cs1_13 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(13)} Rpar={Rpar}
Cs1_14 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(14)} Rpar={Rpar}
Cs1_15 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(15)} Rpar={Rpar}
Cs1_16 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {Cs*b1(16)} Rpar={Rpar}
Cs2_1 {1.2*(1<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_2 {2.2*(2<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_3 {3.2*(3<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_4 {4.2*(4<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_5 {5.2*(5<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_6 {6.2*(6<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_7 {7.2*(7<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_8 {8.2*(8<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_9 {9.2*(9<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_10 {10.2*(10<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_11 {11.2*(11<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_12 {12.2*(12<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_13 {13.2*(13<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_14 {14.2*(14<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_15 {15.2*(15<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
Cs2_16 {16.2*(16<=ceil(Ord/2**(case<3)))} 0 {Cs} Rpar={Rpar}
R1 1 0 1
R2 2 0 1
R3 3 0 1
R4 4 0 1
R5 5 0 1
R6 6 0 1
R7 7 0 1
R8 8 0 1
R9 9 0 1
R10 10 0 1
R11 11 0 1
R12 12 0 1
R13 13 0 1
R14 14 0 1
R15 15 0 1
R16 16 0 1
.func Ampl(x)=if( par(case) | x>Ord/2, 1, bi0(x)*ze_(x)**2 )
.param Gain=modk**( (Ord-par(Ord+1))*(par(case+1)) )*
+ (rebp1(Ord/2+.5)+rebp2(Ord/2+.5))**(case==3&par(Ord+1))*
+ Ampl(1)*Ampl(2)*Ampl(3)*Ampl(4)*Ampl(5)*Ampl(6)*Ampl(7)*Ampl(8)*Ampl(9)*Ampl(10)*
+ Ampl(11)*Ampl(12)*Ampl(13)*Ampl(14)*Ampl(15)*Ampl(16)
Gout 0 out {if(case>2,2,1)*ceil(Ord/2)-(par(Ord+1)&case>2)} 0 {G*Gain}
Rout out 0 1
VN 0.1 0 {Ord} AC {10**(Ord/20)} {Ord}
Vc 0.2 0 {case} AC {10**(case/20)} {case}
.ends Cauer
********************************************************************************
********************************************************************************
*
*			~~ INFINITE IMPULSE RESPONSE ~~
*
********************************************************************************
********************************************************************************
*
* [GENERAL]
*
* - The following are IIR versions of their analog counterparts. 3dBoct has no
* place here and Bessel loses it's trump card as an IIR. It also implies either
* using its poles for the bilinear transform (possible, if tables are involved,
* or if Bairstow's method or similar would be used, but it's not worth it), or
* directly trying to apply the transform to the Nth order polynomial, meaning
* this would no longer be a filter, but a CPU stress program.
*
*
* [SYMBOL]
*
* - They share the same pins as the analog ones, with the same explanations:
*
*  0.1	= order of filter, active, works in .AC (except 3dBoct);
*  0.2	= can have any integer values from <0V:4V>, with 0 meaning AP, 1 = LP,
*	2 = HP, 3 = BP and 4 = BS; active, works in .AC (except 3dBoct);
*  0.3	= outputs the sampling clock, if quant=1. It's useless, though, so it
*	can be safely ignored.
*
*
* [PARAMETERS]
*
* N=<0:32>	= order of the filter, 32 for LP/HP, 16 for BP/BS;
* f0	[Hz]	= sampling frequency;
* fp1	[Hz]	= lower pass-band (corner) frequency;
* fs1	[Hz]	= lower stop-band frequency;
* fp2	[Hz]	= upper pass-band (corner) frequency;
* fs2	[Hz]	= upper stop-band frequency;
* Ap	[dB]	= pass-band ripple, positive value (Chebyshev I and Cauer);
* As	[dB]	= stop-band attenuation, positive value;
* Asc	[dB]	= frequency-scaling attenuation, positive, (all but Cauer);
* G	[linear]= gain;
* quant=<0,1>	= disables/enables a real sample & hold output at the cost of a
*		slower simulation (optional).
*
* - Hidden:
*
* Cpar	[F]	= capacitance across the clock source, default 10p (opt.);
* tr	[s]	= the sampling clock's rising/falling time, it needs quant=1;
*		together with "Cpar" affect the output's erratic spikes, default
*		0.1/f0 (opt.);
* td	[s]	= LTspice's A-device parameter, for the sample & hold, default
*		0.01*tr (opt.).
*
*
* [CHARACTERISTICS]
*
* - The four frequencies decide the configuration, LP/HP/BP/BS, and share the
* same explanations (and graphs) as in the analog section.
* - All IIRs also support the same optimizations as the analog ones, but the
* results will only be relative to "fs1"; "fs2" only needs to be <>fp2.
* - For BP/BS, N is half of the real value, e.g. N=10 actually means N=20.
* - The input is floating, unless quant=1, then Rin=1G.
*
* [NOTES]
*
* - For quant=1, with default values, Cpar=10p represents parallel capacitor
* across the clock source, to smooth out the rising/falling times defined by
* tr=0.1/f0, while td=0.01*tr is the delaying time for the S&H device. Their
* values combined can make the output avoid the spikes due to the tlines and
* the switching behaviour, while not slowing down the simulation. These values,
* as they are now, have been hammered through testing and have been found to be
* the best compromise between a clean output vs. speed. Still, should someone
* need different values, they can be changed as seen fit.
* - quant=1 in an .AC simulation will display a -120dB trace instead of a 0dB
* one, therefore set quant=0 for accurate .AC. It's because it redirects the
* input through a SAMPLEHOLD, while the "real" input passes through a 1G Ohm
* resistor. The A-device seems to have a default Rout=1k, therefore the divisor
* makes a 20*log10( 1k/(1k+1G) )~-120dB attenuation. At any rate, this setting
* only has value in .TRAN.
* - If quant=1, the output will always start from zero. For example, if the
* input is a cosine, the output will have transients as if the input is a sine.
* This is due to the S&H's causality, it can't sample before the simulation has
* started, so it's initially zero.
* - Here, too, Cauer doesn't support frequency scaling.
* - "quant" isn't necessarily needed for the output to appear sampled, e.g. if
* the input is a step, or if "f0" and "N" are low enough, then the output will
* try to follow due to the tlines, but for a sine input the transitions are
* smooth and the output will be the same (more or less, there still are tlines
* at work).
* - Ignore anything coming out of pin '0.3'.
*
********************************
*
*	Butterworth, IIR
*
********************************
*
* Parameters: N, f0, fp1, fs1, fp2, fs2, Asc, As, G, quant (, Cpar, tr, td)
* Supports: LP/HP/BP/BS
* Pins used: IN, OUT, 0.1, 0.2 (, 0.3)
*
* Notes:
* - 
*
********************************
.subckt Butterworth_IIR in out 0.1 0.2 0.3
.param N=0
.param fp1=1k
.param fs1=800
.param fp2=2k
.param fs2=2.5k
.param f0=10k
.param As=40
.param Asc=3
.param G=1
.param quant=0  Cpar=10p tr=.1/f0 td=10m*tr
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fs1>0, 2,
+ if( fp1>fs1 & fp2<fs2 & fp1<fp2 & fs1>0, 3,
+ if( fp1<fs1 & fp2>fs2 & fp1<fp2 & fp1>0, 4, 0 ))))
.param esc=if(Asc>0,10**(Asc*.1)-1,es*exp(-2*abs(log( ratio ))*N))  es=(10**(As*.1)-1)
.param fpz1=tan(pi*fp1/f0) fpz2=tan(pi*fp2/f0) fsz1=tan(pi*fs1/f0)
.param wc=(fpz1*((fpz2-fpz1)*(case>2)+fpz1))  wsc=esc**(.5/Ord)
.param BP=fpz2-fpz1 ratio=if(case<3,fpz1/fsz1,BP*fsz1/(wc-fsz1**2))**sgn(par(case)-.5)
.param Ord=(N==0)*ceil( log(es/esc)/2/abs(log( ratio )) )+N
.func par(x)=1-ceil(x/2)+floor(x/2)
.func rebp1(x)=(BP*sin((2*x-1)*pi/2/Ord)*wsc**sgn(case-3.5)-
+ sqrt(hypot(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(case-3.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(case-3.5))-4*wc))*
+ cos(atan2(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(case-3.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(case-3.5))-4*wc)/2))/2
.func imbp1(x)=(sqrt(hypot(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(case-3.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(case-3.5))-4*wc))*
+ sin(atan2(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(case-3.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(case-3.5))-4*wc)/2)-
+ BP*cos((2*x-1)*pi/2/Ord)*wsc**sgn(case-3.5))/2
.func rebp2(x)=(BP*sin((2*x-1)*pi/2/Ord)*wsc**sgn(case-3.5)+
+ sqrt(hypot(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(case-3.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(case-3.5))-4*wc))*
+ cos(atan2(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(case-3.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(case-3.5))-4*wc)/2))/2
.func imbp2(x)=(sqrt(hypot(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(case-3.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(case-3.5))-4*wc))*
+ sin(atan2(BP**2*sin((2*x-1)*pi/Ord)*wsc**(2*sgn(case-3.5)),
+ BP**2*(-cos((2*x-1)*pi/Ord))*wsc**(2*sgn(case-3.5))-4*wc)/2)+
+ BP*cos((2*x-1)*pi/2/Ord)*wsc**sgn(case-3.5))/2
.func real(x)=if( case<3, sin((2*x-1)*pi/2/Ord)*wc**.5*wsc**sgn(case-1.5),
+ if( x<=ceil(Ord/2), rebp1(x), rebp2(x-ceil(Ord/2)) ) )
.func imag(x)=if( case<3, cos((2*x-1)*pi/2/Ord)*wc**.5*wsc**sgn(case-1.5),
+ if( x<=ceil(Ord/2), imbp1(x), imbp2(x-ceil(Ord/2)) ) )
.func a2(x)=par(case)
.func a1(x)=(( case<3 & x==Ord/2+.5 )*real(x))**inv(case==3)
.func a0(x)=table(case,1,(real(x)**2+imag(x)**2),2,0,3,0,4,wc)
.func b1(x)=real(x)+real(x+(case>2&x==Ord/2+.5)*x)
.func b0(x)=(real(x)**2+imag(x)**2)**inv(x==Ord/2+.5&case>2)*wc**(x==Ord/2+.5&case>2)
.func _A2(x)=(a2(x)-a1(x)+a0(x))*(x<=ceil(Ord/2**(case<3)))
.func _A1(x)=(2*( a0(x)-a2(x) ))*(x<=ceil(Ord/2**(case<3)))
.func _A0(x)=(a2(x)+a1(x)+a0(x))*(x<=ceil(Ord/2**(case<3)))
.func _B2(x)=(1-b1(x)+b0(x))*(x<=ceil(Ord/2**(case<3)))
.func _B1(x)=(2*( b0(x)-1 ))*(x<=ceil(Ord/2**(case<3)))
.func _B0(x)=(1+b1(x)+b0(x))**(x<=ceil(Ord/2**(case<3)))
Rin in 666 1G
Rsh in 999 1
Ash {quant*999} 0 {quant*0.3} 0 0 0 {quant*666} 0 SAMPLEHOLD td={td}
Iclk 0 {quant*.3} pulse 0 1 0 {tr} {tr} {.5/f0} {1/f0}
Cclk 0 0.3 {Cpar} Rpar=1
Gb0_1 0 667 666 0 {1/_B0(1)}
Gb2_1 0 667 0 {1.2*(1<=ceil(Ord/2**(case<3)))} {_B2(1)/_B0(1)}
Gb2_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {_B2(2)/_B0(2)}
Gb2_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {_B2(3)/_B0(3)}
Gb2_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {_B2(4)/_B0(4)}
Gb2_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {_B2(5)/_B0(5)}
Gb2_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {_B2(6)/_B0(6)}
Gb2_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {_B2(7)/_B0(7)}
Gb2_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {_B2(8)/_B0(8)}
Gb2_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {_B2(9)/_B0(9)}
Gb2_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {_B2(10)/_B0(10)}
Gb2_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {_B2(11)/_B0(11)}
Gb2_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {_B2(12)/_B0(12)}
Gb2_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {_B2(13)/_B0(13)}
Gb2_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {_B2(14)/_B0(14)}
Gb2_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {_B2(15)/_B0(15)}
Gb2_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {_B2(16)/_B0(16)}
Gb1_1 0 667 0 {1.1*(1<=ceil(Ord/2**(case<3)))} {_B1(1)/_B0(1)}
Gb1_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.1*(2<=ceil(Ord/2**(case<3)))} {_B1(2)/_B0(2)}
Gb1_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.1*(3<=ceil(Ord/2**(case<3)))} {_B1(3)/_B0(3)}
Gb1_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.1*(4<=ceil(Ord/2**(case<3)))} {_B1(4)/_B0(4)}
Gb1_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.1*(5<=ceil(Ord/2**(case<3)))} {_B1(5)/_B0(5)}
Gb1_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.1*(6<=ceil(Ord/2**(case<3)))} {_B1(6)/_B0(6)}
Gb1_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.1*(7<=ceil(Ord/2**(case<3)))} {_B1(7)/_B0(7)}
Gb1_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.1*(8<=ceil(Ord/2**(case<3)))} {_B1(8)/_B0(8)}
Gb1_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.1*(9<=ceil(Ord/2**(case<3)))} {_B1(9)/_B0(9)}
Gb1_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.1*(10<=ceil(Ord/2**(case<3)))} {_B1(10)/_B0(10)}
Gb1_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.1*(11<=ceil(Ord/2**(case<3)))} {_B1(11)/_B0(11)}
Gb1_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.1*(12<=ceil(Ord/2**(case<3)))} {_B1(12)/_B0(12)}
Gb1_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.1*(13<=ceil(Ord/2**(case<3)))} {_B1(13)/_B0(13)}
Gb1_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.1*(14<=ceil(Ord/2**(case<3)))} {_B1(14)/_B0(14)}
Gb1_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.1*(15<=ceil(Ord/2**(case<3)))} {_B1(15)/_B0(15)}
Gb1_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.1*(16<=ceil(Ord/2**(case<3)))} {_B1(16)/_B0(16)}
Ga2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.2*(1<=ceil(Ord/2**(case<3)))} 0 {_A2(1)/_B0(2)}
Ga2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.2*(2<=ceil(Ord/2**(case<3)))} 0 {_A2(2)/_B0(3)}
Ga2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.2*(3<=ceil(Ord/2**(case<3)))} 0 {_A2(3)/_B0(4)}
Ga2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.2*(4<=ceil(Ord/2**(case<3)))} 0 {_A2(4)/_B0(5)}
Ga2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.2*(5<=ceil(Ord/2**(case<3)))} 0 {_A2(5)/_B0(6)}
Ga2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.2*(6<=ceil(Ord/2**(case<3)))} 0 {_A2(6)/_B0(7)}
Ga2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.2*(7<=ceil(Ord/2**(case<3)))} 0 {_A2(7)/_B0(8)}
Ga2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.2*(8<=ceil(Ord/2**(case<3)))} 0 {_A2(8)/_B0(9)}
Ga2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.2*(9<=ceil(Ord/2**(case<3)))} 0 {_A2(9)/_B0(10)}
Ga2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.2*(10<=ceil(Ord/2**(case<3)))} 0 {_A2(10)/_B0(11)}
Ga2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.2*(11<=ceil(Ord/2**(case<3)))} 0 {_A2(11)/_B0(12)}
Ga2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.2*(12<=ceil(Ord/2**(case<3)))} 0 {_A2(12)/_B0(13)}
Ga2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.2*(13<=ceil(Ord/2**(case<3)))} 0 {_A2(13)/_B0(14)}
Ga2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.2*(14<=ceil(Ord/2**(case<3)))} 0 {_A2(14)/_B0(15)}
Ga2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.2*(15<=ceil(Ord/2**(case<3)))} 0 {_A2(15)/_B0(16)}
Ga2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.2*(16<=ceil(Ord/2**(case<3)))} 0 {_A2(16)/_B0(17)}
Ga1_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {_A1(1)/_B0(2)}
Ga1_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {_A1(2)/_B0(3)}
Ga1_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {_A1(3)/_B0(4)}
Ga1_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {_A1(4)/_B0(5)}
Ga1_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {_A1(5)/_B0(6)}
Ga1_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {_A1(6)/_B0(7)}
Ga1_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {_A1(7)/_B0(8)}
Ga1_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {_A1(8)/_B0(9)}
Ga1_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {_A1(9)/_B0(10)}
Ga1_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {_A1(10)/_B0(11)}
Ga1_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {_A1(11)/_B0(12)}
Ga1_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {_A1(12)/_B0(13)}
Ga1_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {_A1(13)/_B0(14)}
Ga1_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {_A1(14)/_B0(15)}
Ga1_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {_A1(15)/_B0(16)}
Ga1_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {_A1(16)/_B0(17)}
Ga0_1 0 {1*(1<=ceil(Ord/2**(case<3)))} 667 0 {_A0(1)/_B0(2)}
Ga0_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {_A0(2)/_B0(3)}
Ga0_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {_A0(3)/_B0(4)}
Ga0_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {_A0(4)/_B0(5)}
Ga0_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {_A0(5)/_B0(6)}
Ga0_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {_A0(6)/_B0(7)}
Ga0_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {_A0(7)/_B0(8)}
Ga0_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {_A0(8)/_B0(9)}
Ga0_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {_A0(9)/_B0(10)}
Ga0_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {_A0(10)/_B0(11)}
Ga0_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {_A0(11)/_B0(12)}
Ga0_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {_A0(12)/_B0(13)}
Ga0_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {_A0(13)/_B0(14)}
Ga0_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {_A0(14)/_B0(15)}
Ga0_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {_A0(15)/_B0(16)}
Ga0_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {_A0(16)/_B0(17)}
Tz1_1 0 667 0 {1.1*(1<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.1*(2<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.1*(3<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.1*(4<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.1*(5<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.1*(6<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.1*(7<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.1*(8<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.1*(9<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.1*(10<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.1*(11<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.1*(12<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.1*(13<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.1*(14<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.1*(15<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.1*(16<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {1.2*(1<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {2.2*(2<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {3.2*(3<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {4.2*(4<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {5.2*(5<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {6.2*(6<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {7.2*(7<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {8.2*(8<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {9.2*(9<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {10.2*(10<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {11.2*(11<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {12.2*(12<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {13.2*(13<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {14.2*(14<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {15.2*(15<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {16.2*(16<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
R1 {1.2*(1<=ceil(Ord/2**(case<3)))} 0 1
R2 {2.2*(2<=ceil(Ord/2**(case<3)))} 0 1
R3 {3.2*(3<=ceil(Ord/2**(case<3)))} 0 1
R4 {4.2*(4<=ceil(Ord/2**(case<3)))} 0 1
R5 {5.2*(5<=ceil(Ord/2**(case<3)))} 0 1
R6 {6.2*(6<=ceil(Ord/2**(case<3)))} 0 1
R7 {7.2*(7<=ceil(Ord/2**(case<3)))} 0 1
R8 {8.2*(8<=ceil(Ord/2**(case<3)))} 0 1
R9 {9.2*(9<=ceil(Ord/2**(case<3)))} 0 1
R10 {10.2*(10<=ceil(Ord/2**(case<3)))} 0 1
R11 {11.2*(11<=ceil(Ord/2**(case<3)))} 0 1
R12 {12.2*(12<=ceil(Ord/2**(case<3)))} 0 1
R13 {13.2*(13<=ceil(Ord/2**(case<3)))} 0 1
R14 {14.2*(14<=ceil(Ord/2**(case<3)))} 0 1
R15 {15.2*(15<=ceil(Ord/2**(case<3)))} 0 1
R16 {16.2*(16<=ceil(Ord/2**(case<3)))} 0 1
Rx 0 {ceil(Ord/2**(case<3))} 1
Gout 0 out {if(case>2,2,1)*ceil(Ord/2)-(par(Ord+1)&case>2)} 0
+ {G*(sgn(fp2-fp1)*BP/wsc)**((case==3)*Ord)}
Rout 0 out 1
VN 0.1 0 {Ord} AC {10**(Ord/20)} {Ord}
Vc 0.2 0 {case} AC {10**(case/20)} {case}
.ends Butterworth_IIR
****************************************
*
*	Chebyshev, type I, IIR
*
****************************************
*
* Parameters: N, f0, fp1, fs1, fp2, fs2, Asc, Ap, As, G, quant (, Cpar, tr, td)
* Supports: LP/HP/BP/BS
* Pins used: IN, OUT, 0.1, 0.2 (, 0.3)
*
* Notes:
* - 
*
********************************
.subckt Chebyshev_IIR in out 0.1 0.2 0.3
.param N=0
.param fp1=1k
.param fs1=800
.param fp2=2k
.param fs2=2.5k
.param f0=10k
.param Ap=1
.param As=60
.param Asc=3
.param G=1
.param quant=0  Cpar=10p tr=.1/f0 td=10m*tr
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fs1>0, 2,
+ if( fp1>fs1 & fp2<fs2 & fp1<fp2 & fs1>0, 3,
+ if( fp1<fs1 & fp2>fs2 & fp1<fp2 & fp1>0, 4, 0 ))))
.param esc=sqrt(10**(Asc/10)-1)   es=sqrt(10**(As/10)-1)
.param ep=if(Ap>0,1/sqrt(10**(Ap/10)-1),cosh(acosh( ratio )*N)/es)
.param wsc=cosh(acosh(esc*ep)/Ord)  wc=fpz1*if(fp2==0,fpz1,fpz2)
.param fpz1=tan(pi*fp1/f0) fpz2=tan(pi*fp2/f0) fsz1=tan(pi*fs1/f0)
.param BP=fpz2-fpz1 ratio=if(case<3,fpz1/fsz1,BP*fsz1/(wc-fsz1**2))**sgn(par(case)-.5)
.param Ord=(N==0)*ceil(acosh(es/sqrt(10**if(Asc>Ap,sqrt(Ap*Asc)/20,Ap/10)-u(Ap)))/
+ acosh( ratio ))+N
.func par(x)=1-ceil(x/2)+floor(x/2)
.func den(x)=wsc*((cos((2*x-1)*pi/Ord)+cosh((2*asinh(ep))/Ord))/wsc**2/2)**par(case)
.func rebp1(x)=(BP*sin((2*x-1)*pi/2/Ord)*sinh(asinh(ep)/Ord)/den(x)-
+ sqrt(hypot(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc))*
+ cos(atan2(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc)/2))/2
.func imbp1(x)=(sqrt(hypot(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc))*
+ sin(atan2(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc)/2)-
+ BP*cos((2*x-1)*pi/2/Ord)*cosh(asinh(ep)/Ord)/den(x))/2
.func rebp2(x)=(BP*sin((2*x-1)*pi/2/Ord)*sinh(asinh(ep)/Ord)/den(x)+
+ sqrt(hypot(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc))*
+ cos(atan2(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc)/2))/2
.func imbp2(x)=(sqrt(hypot(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc))*
+ sin(atan2(BP**2*(sinh((2*asinh(ep))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(ep))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc)/2)+
+ BP*cos((2*x-1)*pi/2/Ord)*cosh(asinh(ep)/Ord)/den(x))/2
.func real(x)=if( case<3, sin((2*x-1)*pi/2/Ord)*sinh(asinh(ep)/Ord)/den(x)*wc**.5,
+ if( x<=ceil(Ord/2), rebp1(x), rebp2(x-ceil(Ord/2)) ) )
.func imag(x)=if( case<3, cos((2*x-1)*pi/2/Ord)*cosh(asinh(ep)/Ord)/den(x)*wc**.5,
+ if( x<=ceil(Ord/2), imbp1(x), imbp2(x-ceil(Ord/2)) ) )
.func a2(x)=par(case)
.func a1(x)=(( case<3 & x==Ord/2+.5 )*real(x))**inv(case==3)
.func a0(x)=table(case,1,real(x)**2+imag(x)**2,2,0,3,0,4,wc)
.func b1(x)=real(x)+real(x+(case>2&x==Ord/2+.5)*x)
.func b0(x)=(real(x)**2+imag(x)**2)**inv(x==Ord/2+.5&case>2)*wc**(x==Ord/2+.5&case>2)
.func _A2(x)=(a2(x)-a1(x)+a0(x))*(x<=ceil(Ord/2**(case<3)))
.func _A1(x)=(2*( a0(x)-a2(x) ))*(x<=ceil(Ord/2**(case<3)))
.func _A0(x)=(a2(x)+a1(x)+a0(x))*(x<=ceil(Ord/2**(case<3)))
.func _B2(x)=(1-b1(x)+b0(x))*(x<=ceil(Ord/2**(case<3)))
.func _B1(x)=(2*( b0(x)-1 ))*(x<=ceil(Ord/2**(case<3)))
.func _B0(x)=(1+b1(x)+b0(x))**(x<=ceil(Ord/2**(case<3)))
Rin in 666 1G
Rsh in 999 1
Ash {quant*999} 0 {quant*0.3} 0 0 0 {quant*666} 0 SAMPLEHOLD td={td}
Iclk 0 {quant*.3} pulse 0 1 0 {tr} {tr} {.5/f0} {1/f0}
Cclk 0 0.3 {Cpar} Rpar=1
Gb0_1 0 667 666 0 {1/_B0(1)}
Gb2_1 0 667 0 {1.2*(1<=ceil(Ord/2**(case<3)))} {_B2(1)/_B0(1)}
Gb2_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {_B2(2)/_B0(2)}
Gb2_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {_B2(3)/_B0(3)}
Gb2_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {_B2(4)/_B0(4)}
Gb2_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {_B2(5)/_B0(5)}
Gb2_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {_B2(6)/_B0(6)}
Gb2_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {_B2(7)/_B0(7)}
Gb2_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {_B2(8)/_B0(8)}
Gb2_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {_B2(9)/_B0(9)}
Gb2_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {_B2(10)/_B0(10)}
Gb2_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {_B2(11)/_B0(11)}
Gb2_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {_B2(12)/_B0(12)}
Gb2_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {_B2(13)/_B0(13)}
Gb2_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {_B2(14)/_B0(14)}
Gb2_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {_B2(15)/_B0(15)}
Gb2_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {_B2(16)/_B0(16)}
Gb1_1 0 667 0 {1.1*(1<=ceil(Ord/2**(case<3)))} {_B1(1)/_B0(1)}
Gb1_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.1*(2<=ceil(Ord/2**(case<3)))} {_B1(2)/_B0(2)}
Gb1_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.1*(3<=ceil(Ord/2**(case<3)))} {_B1(3)/_B0(3)}
Gb1_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.1*(4<=ceil(Ord/2**(case<3)))} {_B1(4)/_B0(4)}
Gb1_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.1*(5<=ceil(Ord/2**(case<3)))} {_B1(5)/_B0(5)}
Gb1_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.1*(6<=ceil(Ord/2**(case<3)))} {_B1(6)/_B0(6)}
Gb1_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.1*(7<=ceil(Ord/2**(case<3)))} {_B1(7)/_B0(7)}
Gb1_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.1*(8<=ceil(Ord/2**(case<3)))} {_B1(8)/_B0(8)}
Gb1_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.1*(9<=ceil(Ord/2**(case<3)))} {_B1(9)/_B0(9)}
Gb1_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.1*(10<=ceil(Ord/2**(case<3)))} {_B1(10)/_B0(10)}
Gb1_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.1*(11<=ceil(Ord/2**(case<3)))} {_B1(11)/_B0(11)}
Gb1_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.1*(12<=ceil(Ord/2**(case<3)))} {_B1(12)/_B0(12)}
Gb1_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.1*(13<=ceil(Ord/2**(case<3)))} {_B1(13)/_B0(13)}
Gb1_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.1*(14<=ceil(Ord/2**(case<3)))} {_B1(14)/_B0(14)}
Gb1_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.1*(15<=ceil(Ord/2**(case<3)))} {_B1(15)/_B0(15)}
Gb1_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.1*(16<=ceil(Ord/2**(case<3)))} {_B1(16)/_B0(16)}
Ga2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.2*(1<=ceil(Ord/2**(case<3)))} 0 {_A2(1)/_B0(2)}
Ga2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.2*(2<=ceil(Ord/2**(case<3)))} 0 {_A2(2)/_B0(3)}
Ga2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.2*(3<=ceil(Ord/2**(case<3)))} 0 {_A2(3)/_B0(4)}
Ga2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.2*(4<=ceil(Ord/2**(case<3)))} 0 {_A2(4)/_B0(5)}
Ga2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.2*(5<=ceil(Ord/2**(case<3)))} 0 {_A2(5)/_B0(6)}
Ga2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.2*(6<=ceil(Ord/2**(case<3)))} 0 {_A2(6)/_B0(7)}
Ga2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.2*(7<=ceil(Ord/2**(case<3)))} 0 {_A2(7)/_B0(8)}
Ga2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.2*(8<=ceil(Ord/2**(case<3)))} 0 {_A2(8)/_B0(9)}
Ga2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.2*(9<=ceil(Ord/2**(case<3)))} 0 {_A2(9)/_B0(10)}
Ga2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.2*(10<=ceil(Ord/2**(case<3)))} 0 {_A2(10)/_B0(11)}
Ga2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.2*(11<=ceil(Ord/2**(case<3)))} 0 {_A2(11)/_B0(12)}
Ga2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.2*(12<=ceil(Ord/2**(case<3)))} 0 {_A2(12)/_B0(13)}
Ga2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.2*(13<=ceil(Ord/2**(case<3)))} 0 {_A2(13)/_B0(14)}
Ga2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.2*(14<=ceil(Ord/2**(case<3)))} 0 {_A2(14)/_B0(15)}
Ga2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.2*(15<=ceil(Ord/2**(case<3)))} 0 {_A2(15)/_B0(16)}
Ga2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.2*(16<=ceil(Ord/2**(case<3)))} 0 {_A2(16)/_B0(17)}
Ga1_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {_A1(1)/_B0(2)}
Ga1_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {_A1(2)/_B0(3)}
Ga1_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {_A1(3)/_B0(4)}
Ga1_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {_A1(4)/_B0(5)}
Ga1_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {_A1(5)/_B0(6)}
Ga1_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {_A1(6)/_B0(7)}
Ga1_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {_A1(7)/_B0(8)}
Ga1_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {_A1(8)/_B0(9)}
Ga1_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {_A1(9)/_B0(10)}
Ga1_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {_A1(10)/_B0(11)}
Ga1_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {_A1(11)/_B0(12)}
Ga1_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {_A1(12)/_B0(13)}
Ga1_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {_A1(13)/_B0(14)}
Ga1_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {_A1(14)/_B0(15)}
Ga1_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {_A1(15)/_B0(16)}
Ga1_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {_A1(16)/_B0(17)}
Ga0_1 0 {1*(1<=ceil(Ord/2**(case<3)))} 667 0 {_A0(1)/_B0(2)}
Ga0_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {_A0(2)/_B0(3)}
Ga0_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {_A0(3)/_B0(4)}
Ga0_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {_A0(4)/_B0(5)}
Ga0_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {_A0(5)/_B0(6)}
Ga0_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {_A0(6)/_B0(7)}
Ga0_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {_A0(7)/_B0(8)}
Ga0_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {_A0(8)/_B0(9)}
Ga0_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {_A0(9)/_B0(10)}
Ga0_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {_A0(10)/_B0(11)}
Ga0_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {_A0(11)/_B0(12)}
Ga0_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {_A0(12)/_B0(13)}
Ga0_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {_A0(13)/_B0(14)}
Ga0_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {_A0(14)/_B0(15)}
Ga0_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {_A0(15)/_B0(16)}
Ga0_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {_A0(16)/_B0(17)}
Tz1_1 0 667 0 {1.1*(1<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.1*(2<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.1*(3<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.1*(4<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.1*(5<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.1*(6<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.1*(7<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.1*(8<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.1*(9<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.1*(10<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.1*(11<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.1*(12<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.1*(13<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.1*(14<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.1*(15<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.1*(16<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {1.2*(1<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {2.2*(2<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {3.2*(3<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {4.2*(4<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {5.2*(5<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {6.2*(6<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {7.2*(7<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {8.2*(8<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {9.2*(9<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {10.2*(10<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {11.2*(11<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {12.2*(12<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {13.2*(13<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {14.2*(14<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {15.2*(15<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {16.2*(16<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
R1 {1.2*(1<=ceil(Ord/2**(case<3)))} 0 1
R2 {2.2*(2<=ceil(Ord/2**(case<3)))} 0 1
R3 {3.2*(3<=ceil(Ord/2**(case<3)))} 0 1
R4 {4.2*(4<=ceil(Ord/2**(case<3)))} 0 1
R5 {5.2*(5<=ceil(Ord/2**(case<3)))} 0 1
R6 {6.2*(6<=ceil(Ord/2**(case<3)))} 0 1
R7 {7.2*(7<=ceil(Ord/2**(case<3)))} 0 1
R8 {8.2*(8<=ceil(Ord/2**(case<3)))} 0 1
R9 {9.2*(9<=ceil(Ord/2**(case<3)))} 0 1
R10 {10.2*(10<=ceil(Ord/2**(case<3)))} 0 1
R11 {11.2*(11<=ceil(Ord/2**(case<3)))} 0 1
R12 {12.2*(12<=ceil(Ord/2**(case<3)))} 0 1
R13 {13.2*(13<=ceil(Ord/2**(case<3)))} 0 1
R14 {14.2*(14<=ceil(Ord/2**(case<3)))} 0 1
R15 {15.2*(15<=ceil(Ord/2**(case<3)))} 0 1
R16 {16.2*(16<=ceil(Ord/2**(case<3)))} 0 1
Rx 0 {ceil(Ord/2**(case<3))} 1
.param Gain=((sgn(fp2-fp1)*BP/wsc)**Ord/(2**(Ord-1)/ep)*sqrt(1+ep**(-2)*
+ (par(Ord))))**(case==3&par(case+1))
Gout 0 out {if(case>2,2,1)*ceil(Ord/2)-(par(Ord+1)&case>2)} 0 {G*Gain}
Rout 0 out 1
VN 0.1 0 {Ord} AC {10**(Ord/20)} {Ord}
Vc 0.2 0 {case} AC {10**(case/20)} {case}
.ends Chebyshev_IIR
****************************************
*
*	Chebyshev, type II, IIR
*
****************************************
*
* Parameters: N, f0, fp1, fs1, fp2, fs2, Asc, As, G, quant (, Cpar, tr, td)
* Supports: LP/HP/BP/BS
* Pins used: IN, OUT, 0.1, 0.2 (, 0.3)
*
* Notes:
* - If Asc>=As when N=0, "As" will be considered.
*
********************************
.subckt InvChebyshev_IIR in out 0.1 0.2 0.3
.param N=0
.param fp1=1k
.param fs1=800
.param fp2=2k
.param fs2=2.5k
.param f0=10k
.param As=60
.param Asc=3
.param G=1
.param quant=0  Cpar=10p tr=.1/f0 td=10m*tr
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fs1>0, 2,
+ if( fp1>fs1 & fp2<fs2 & fp1<fp2 & fs1>0, 3,
+ if( fp1<fs1 & fp2>fs2 & fp1<fp2 & fp1>0, 4, 0 ))))
.param esc=if(Asc>0,sqrt(10**(Asc/10)-1),sqrt(10**(As/10)-1)/cosh(N*acosh(ratio)) )
.param es=if(As>0,sqrt(10**(As/10)-1),cosh(N*acosh(ratio))*esc )
.param fpz1=tan(pi*fp1/f0) fpz2=tan(pi*fp2/f0) fsz1=tan(pi*fs1/f0)
.param wc=fpz1*if(case>2,fpz2,fpz1)  wsc=cosh(acosh(es/esc)/Ord)
.param BP=fpz2-fpz1 ratio=if(case<3,fpz1/fsz1,BP*fsz1/(wc-fsz1**2))**sgn(par(case)-.5)
.param Ord=if(N==0,ceil( acosh(es/esc**inv(Asc>=As))/acosh( ratio )),N)
.func par(x)=1-ceil(x/2)+floor(x/2)
.func den(x)=wsc*((cos((2*x-1)*pi/Ord)+cosh((2*asinh(es))/Ord))/wsc**2/2)**par(case+1)
.func rebp1(x)=(BP*sin((2*x-1)*pi/2/Ord)*sinh(asinh(es)/Ord)/den(x)-
+ sqrt(hypot(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc))*
+ cos(atan2(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc)/2))/2
.func imbp1(x)=(sqrt(hypot(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc))*
+ sin(atan2(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc)/2)-
+ BP*cos((2*x-1)*pi/2/Ord)*cosh(asinh(es)/Ord)/den(x))/2
.func rebp2(x)=(BP*sin((2*x-1)*pi/2/Ord)*sinh(asinh(es)/Ord)/den(x)+
+ sqrt(hypot(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc))*
+ cos(atan2(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc)/2))/2
.func imbp2(x)=(sqrt(hypot(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc))*
+ sin(atan2(BP**2*(sinh((2*asinh(es))/Ord)*sin((2*x-1)*pi/Ord))/2/den(x)**2,
+ BP**2*(-(cosh((2*asinh(es))/Ord)*cos((2*x-1)*pi/Ord))/2-.5)/den(x)**2-4*wc)/2)+
+ BP*cos((2*x-1)*pi/2/Ord)*cosh(asinh(es)/Ord)/den(x))/2
.func zebp1(x)=(sqrt(BP**2*(cos((2*x-1)*pi/2/Ord)/wsc)**(2*sgn(par(case)-.5))+4*wc)-
+ BP*(cos((2*x-1)*pi/2/Ord)/wsc)**sgn(par(case)-.5))/2
.func zebp2(x)=(sqrt(BP**2*(cos((2*x-1)*pi/2/Ord)/wsc)**(2*sgn(par(case)-.5))+4*wc)+
+ BP*(cos((2*x-1)*pi/2/Ord)/wsc)**sgn(par(case)-.5))/2
.func real(x)=if( case<3, sin((2*x-1)*pi/2/Ord)*sinh(asinh(es)/Ord)/den(x)*wc**.5,
+ if( x<=ceil(Ord/2), rebp1(x), rebp2(x-ceil(Ord/2)) ) )
.func imag(x)=if( case<3, cos((2*x-1)*pi/2/Ord)*cosh(asinh(es)/Ord)/den(x)*wc**.5,
+ if( x<=ceil(Ord/2), imbp1(x), imbp2(x-ceil(Ord/2)) ) )
.func zero(x)=if( case<3, (cos((2*x-1)*pi/2/Ord)/wsc)**sgn(par(case)-.5)*wc**.5,
+ if( x<=ceil(Ord/2), zebp1(x), zebp2(x-ceil(Ord/2)) ) )
.func a2(x)=inv(x==Ord/2+.5&par(case+1))
.func a1(x)=(x==Ord/2+.5&case<4)*real(x)**inv(case==3)
.func a0(x)=if( x==Ord/2+.5, (real(x)**2+imag(x)**2)*(case==1)+(case==4)*wc, zero(x)**2 )
.func b1(x)=real(x)+real(x+(x==Ord/2+.5&case>2)*x)
.func b0(x)=(real(x)**2+imag(x)**2)**inv(x==Ord/2+.5&case>2)*wc**(x==Ord/2+.5&case>2)
.func _A2(x)=(a2(x)-a1(x)+a0(x))*(x<=ceil(Ord/2**(case<3)))
.func _A1(x)=(2*( a0(x)-a2(x) ))*(x<=ceil(Ord/2**(case<3)))
.func _A0(x)=(a2(x)+a1(x)+a0(x))*(x<=ceil(Ord/2**(case<3)))
.func _B2(x)=(1-b1(x)+b0(x))*(x<=ceil(Ord/2**(case<3)))
.func _B1(x)=(2*( b0(x)-1 ))*(x<=ceil(Ord/2**(case<3)))
.func _B0(x)=(1+b1(x)+b0(x))**(x<=ceil(Ord/2**(case<3)))
Rin in 666 1G
Rsh in 999 1
Ash {quant*999} 0 {quant*0.3} 0 0 0 {quant*666} 0 SAMPLEHOLD td={td}
Iclk 0 {quant*.3} pulse 1 0 {.5/f0} {tr} {tr} {.5/f0} {1/f0}
Cclk 0 0.3 {Cpar} Rpar=1
Gb0_1 0 667 666 0 {1/_B0(1)}
Gb2_1 0 667 0 {1.2*(1<=ceil(Ord/2**(case<3)))} {_B2(1)/_B0(1)}
Gb2_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {_B2(2)/_B0(2)}
Gb2_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {_B2(3)/_B0(3)}
Gb2_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {_B2(4)/_B0(4)}
Gb2_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {_B2(5)/_B0(5)}
Gb2_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {_B2(6)/_B0(6)}
Gb2_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {_B2(7)/_B0(7)}
Gb2_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {_B2(8)/_B0(8)}
Gb2_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {_B2(9)/_B0(9)}
Gb2_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {_B2(10)/_B0(10)}
Gb2_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {_B2(11)/_B0(11)}
Gb2_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {_B2(12)/_B0(12)}
Gb2_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {_B2(13)/_B0(13)}
Gb2_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {_B2(14)/_B0(14)}
Gb2_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {_B2(15)/_B0(15)}
Gb2_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {_B2(16)/_B0(16)}
Gb1_1 0 667 0 {1.1*(1<=ceil(Ord/2**(case<3)))} {_B1(1)/_B0(1)}
Gb1_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.1*(2<=ceil(Ord/2**(case<3)))} {_B1(2)/_B0(2)}
Gb1_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.1*(3<=ceil(Ord/2**(case<3)))} {_B1(3)/_B0(3)}
Gb1_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.1*(4<=ceil(Ord/2**(case<3)))} {_B1(4)/_B0(4)}
Gb1_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.1*(5<=ceil(Ord/2**(case<3)))} {_B1(5)/_B0(5)}
Gb1_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.1*(6<=ceil(Ord/2**(case<3)))} {_B1(6)/_B0(6)}
Gb1_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.1*(7<=ceil(Ord/2**(case<3)))} {_B1(7)/_B0(7)}
Gb1_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.1*(8<=ceil(Ord/2**(case<3)))} {_B1(8)/_B0(8)}
Gb1_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.1*(9<=ceil(Ord/2**(case<3)))} {_B1(9)/_B0(9)}
Gb1_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.1*(10<=ceil(Ord/2**(case<3)))} {_B1(10)/_B0(10)}
Gb1_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.1*(11<=ceil(Ord/2**(case<3)))} {_B1(11)/_B0(11)}
Gb1_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.1*(12<=ceil(Ord/2**(case<3)))} {_B1(12)/_B0(12)}
Gb1_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.1*(13<=ceil(Ord/2**(case<3)))} {_B1(13)/_B0(13)}
Gb1_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.1*(14<=ceil(Ord/2**(case<3)))} {_B1(14)/_B0(14)}
Gb1_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.1*(15<=ceil(Ord/2**(case<3)))} {_B1(15)/_B0(15)}
Gb1_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.1*(16<=ceil(Ord/2**(case<3)))} {_B1(16)/_B0(16)}
Ga2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.2*(1<=ceil(Ord/2**(case<3)))} 0 {_A2(1)/_B0(2)}
Ga2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.2*(2<=ceil(Ord/2**(case<3)))} 0 {_A2(2)/_B0(3)}
Ga2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.2*(3<=ceil(Ord/2**(case<3)))} 0 {_A2(3)/_B0(4)}
Ga2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.2*(4<=ceil(Ord/2**(case<3)))} 0 {_A2(4)/_B0(5)}
Ga2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.2*(5<=ceil(Ord/2**(case<3)))} 0 {_A2(5)/_B0(6)}
Ga2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.2*(6<=ceil(Ord/2**(case<3)))} 0 {_A2(6)/_B0(7)}
Ga2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.2*(7<=ceil(Ord/2**(case<3)))} 0 {_A2(7)/_B0(8)}
Ga2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.2*(8<=ceil(Ord/2**(case<3)))} 0 {_A2(8)/_B0(9)}
Ga2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.2*(9<=ceil(Ord/2**(case<3)))} 0 {_A2(9)/_B0(10)}
Ga2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.2*(10<=ceil(Ord/2**(case<3)))} 0 {_A2(10)/_B0(11)}
Ga2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.2*(11<=ceil(Ord/2**(case<3)))} 0 {_A2(11)/_B0(12)}
Ga2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.2*(12<=ceil(Ord/2**(case<3)))} 0 {_A2(12)/_B0(13)}
Ga2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.2*(13<=ceil(Ord/2**(case<3)))} 0 {_A2(13)/_B0(14)}
Ga2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.2*(14<=ceil(Ord/2**(case<3)))} 0 {_A2(14)/_B0(15)}
Ga2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.2*(15<=ceil(Ord/2**(case<3)))} 0 {_A2(15)/_B0(16)}
Ga2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.2*(16<=ceil(Ord/2**(case<3)))} 0 {_A2(16)/_B0(17)}
Ga1_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {_A1(1)/_B0(2)}
Ga1_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {_A1(2)/_B0(3)}
Ga1_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {_A1(3)/_B0(4)}
Ga1_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {_A1(4)/_B0(5)}
Ga1_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {_A1(5)/_B0(6)}
Ga1_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {_A1(6)/_B0(7)}
Ga1_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {_A1(7)/_B0(8)}
Ga1_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {_A1(8)/_B0(9)}
Ga1_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {_A1(9)/_B0(10)}
Ga1_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {_A1(10)/_B0(11)}
Ga1_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {_A1(11)/_B0(12)}
Ga1_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {_A1(12)/_B0(13)}
Ga1_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {_A1(13)/_B0(14)}
Ga1_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {_A1(14)/_B0(15)}
Ga1_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {_A1(15)/_B0(16)}
Ga1_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {_A1(16)/_B0(17)}
Ga0_1 0 {1*(1<=ceil(Ord/2**(case<3)))} 667 0 {_A0(1)/_B0(2)}
Ga0_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {_A0(2)/_B0(3)}
Ga0_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {_A0(3)/_B0(4)}
Ga0_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {_A0(4)/_B0(5)}
Ga0_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {_A0(5)/_B0(6)}
Ga0_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {_A0(6)/_B0(7)}
Ga0_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {_A0(7)/_B0(8)}
Ga0_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {_A0(8)/_B0(9)}
Ga0_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {_A0(9)/_B0(10)}
Ga0_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {_A0(10)/_B0(11)}
Ga0_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {_A0(11)/_B0(12)}
Ga0_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {_A0(12)/_B0(13)}
Ga0_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {_A0(13)/_B0(14)}
Ga0_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {_A0(14)/_B0(15)}
Ga0_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {_A0(15)/_B0(16)}
Ga0_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {_A0(16)/_B0(17)}
Tz1_1 0 667 0 {1.1*(1<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.1*(2<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.1*(3<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.1*(4<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.1*(5<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.1*(6<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.1*(7<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.1*(8<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.1*(9<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.1*(10<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.1*(11<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.1*(12<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.1*(13<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.1*(14<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.1*(15<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.1*(16<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {1.2*(1<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {2.2*(2<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {3.2*(3<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {4.2*(4<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {5.2*(5<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {6.2*(6<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {7.2*(7<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {8.2*(8<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {9.2*(9<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {10.2*(10<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {11.2*(11<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {12.2*(12<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {13.2*(13<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {14.2*(14<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {15.2*(15<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {16.2*(16<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
R1 {1.2*(1<=ceil(Ord/2**(case<3)))} 0 1
R2 {2.2*(2<=ceil(Ord/2**(case<3)))} 0 1
R3 {3.2*(3<=ceil(Ord/2**(case<3)))} 0 1
R4 {4.2*(4<=ceil(Ord/2**(case<3)))} 0 1
R5 {5.2*(5<=ceil(Ord/2**(case<3)))} 0 1
R6 {6.2*(6<=ceil(Ord/2**(case<3)))} 0 1
R7 {7.2*(7<=ceil(Ord/2**(case<3)))} 0 1
R8 {8.2*(8<=ceil(Ord/2**(case<3)))} 0 1
R9 {9.2*(9<=ceil(Ord/2**(case<3)))} 0 1
R10 {10.2*(10<=ceil(Ord/2**(case<3)))} 0 1
R11 {11.2*(11<=ceil(Ord/2**(case<3)))} 0 1
R12 {12.2*(12<=ceil(Ord/2**(case<3)))} 0 1
R13 {13.2*(13<=ceil(Ord/2**(case<3)))} 0 1
R14 {14.2*(14<=ceil(Ord/2**(case<3)))} 0 1
R15 {15.2*(15<=ceil(Ord/2**(case<3)))} 0 1
R16 {16.2*(16<=ceil(Ord/2**(case<3)))} 0 1
Rx 0 {ceil(Ord/2**(case<3))} 1
.param Gain=(es**(-(par(case+1)&par(Ord)))*(sgn(fp2-fp1)*BP*Ord*wsc/
+ real(ceil(Ord/2))**(case==1&par(Ord+1))/sqrt(1+es**2))**par(Ord+1))**par(case+1)
Gout 0 out {if(case>2,2,1)*ceil(Ord/2)-(par(Ord+1)&case>2)} 0 {G*Gain}
Rout 0 out 1
VN 0.1 0 {Ord} AC {10**(Ord/20)} {Ord}
Vc 0.2 0 {case} AC {10**(case/20)} {case}
.ends InvChebyshev_IIR
****************************************
*
*	Cauer (Elliptic), IIR
*
****************************************
*
* Parameters: N, f0, fp1, fs1, fp2, fs2, Ap, As, G, quant (, Cpar, tr, td)
* Supports: LP/HP/BP/BS
* Pins used: IN, OUT, 0.1, 0.2 (, 0.3)
*
* Notes:
* - It's derived from Cauer so it inherits the same properties, but it takes
* even longer to start because of the additional bilinear transform.
*
********************************
.subckt Cauer_IIR in out 0.1 0.2 0.3
.param N=0
.param fp1=1k
.param fs1=800
.param fp2=2k
.param fs2=2.5k
.param f0=10k
.param Ap=1
.param As=60
.param G=1
.param quant=0  Cpar=10p tr=.1/f0 td=10m*tr
.param ep=if(Ap>0,(10**(Ap*.1)-1)**.5,4*(10**(As*.1)-1)**.5*exp(log(nomeqq)*N/2) )
.param es=if(As>0,(10**(As*.1)-1)**.5,(10**(Ap*.1)-1)**.5/4*exp(-log(nomeqq)*N/2) )
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fs1>0, 2,
+ if( fp1>fs1 & fp2<fs2 & fp1<fp2 & fs1>0, 3,
+ if( fp1<fs1 & fp2>fs2 & fp1<fp2 & fp1>0, 4, 0 ))))
.param fpz1=tan(pi*fp1/f0) fpz2=tan(pi*fp2/f0) fsz1=tan(pi*fs1/f0) ;fsz2=tan(pi*fs2/f0)
.param wc=fpz1*((fpz2-fpz1)*(case>2)+fpz1)
.param BP=fpz2-fpz1 modkk=if(case<3,fpz1/fsz1,BP*fsz1/(wc-fsz1**2))**sgn(par(case+1)-.5)
.param modk1=ep/es  ; modkk=(BS/BP)**sgn(par(case)-.5)
.param modk2=4*nomeq2**.5*(1+4*nomeq2**2)**.5/(1+2*nomeq2)**2
.param h0=.5*(1-(1-modkk**2)**.25)/(1+(1-modkk**2)**.25)
.param nomeq2=nomeq1**(1/N**u(N))  nomeqq=h0*(1+2*h0**4)
.param nomeq1=exp(-pi*ellK((1-modk1**2))/ellK(modk1**2))
.param nomeq=if(N==0,nomeqq,nomeq2)  modk=if(N==0,modkk,modk2)
.param Ord=if( N==0, ceil(2*log(4*es/ep)/log(1/nomeq)), N )
.param Lambda=.5/Ord*log((sqrt(ep**2+1)+1)/(sqrt(ep**2+1)-1))
.func par(x)=1-ceil(x/2)+floor(x/2)
.func ellK(x)=(2**4.875*pi)/(2**.875*sqrt(1-x)+2**1.875*(1-x)**.25+2**2.375* 
+ sqrt(sqrt(1-x)+1)*(1-x)**.125+2**2.625*(sqrt(1-x)+1)**.25*sqrt(sqrt(1-x)+ 
+ 2*(1-x)**.25+1)*(1-x)**.0625+2**2.5*(sqrt(1-x)+1)**.125* 
+ (sqrt(1-x)+2*(1-x)**.25+1)**.25*sqrt(sqrt(2)*sqrt(1-x)+2**1.5*(1-x)**.25+ 
+ 4*sqrt(sqrt(1-x)+1)*(1-x)**.125+sqrt(2))*(1-x)**.03125+2**.875)
.func ze_(x)=(nomeq**.25*(nomeq**6*sin(5*pi*((x-0.5)/Ord+0.5))-
+ nomeq**2*sin(3*pi*((x-0.5)/Ord+0.5))+sin(pi*((x-0.5)/Ord+0.5))))/
+ (nomeq**4*cos(4*pi*((x-0.5)/Ord+0.5))-nomeq*cos(2*pi*((x-0.5)/Ord+0.5))+0.5)/sqrt(modk)
.param real0=(nomeq**.25*(nomeq**6*sinh(5*Lambda)-nomeq**2*sinh(3*Lambda)+
+ sinh(Lambda)))/(nomeq**4*cosh(4*Lambda)-nomeq*cosh(2*Lambda)+0.5)
.func Q0(x)=ze_(x)/(2*real0)*sqrt((real0**2+ze_(x)**2*modk)*(real0**2*modk+ze_(x)**(-2))/
+ ((1-(ze_(x)*modk)**2)*(1-ze_(x)**2)))
.func bi0(x)=(real0**2/modk+ze_(x)**2)/(1+(real0*ze_(x))**2*modk)
.func Iarg(x)=BP**2*(bi0(x)*sqrt(1-.25/Q0(x)**2)/Q0(x))/bi0(x)**(2*par(case))
.func Rarg(x)=BP**2*bi0(x)*(.5/Q0(x)**2-1)/bi0(x)**(2*par(case))-4*wc
.func rebp1(x)=(BP*bi0(x)**.5/2/Q0(x)/bi0(x)**par(case)-
+ sqrt(hypot(Iarg(x),Rarg(x)))*cos(atan2(Iarg(x),Rarg(x))/2))/2
.func imbp1(x)=(sqrt(hypot(Iarg(x),Rarg(x)))*sin(atan2(Iarg(x),Rarg(x))/2)-
+ BP*sqrt(bi0(x)*(1-.25/Q0(x)**2))/bi0(x)**par(case))/2
.func rebp2(x)=(BP*bi0(x)**.5/2/Q0(x)/bi0(x)**par(case)+
+ sqrt(hypot(Iarg(x),Rarg(x)))*cos(atan2(Iarg(x),Rarg(x))/2))/2
.func imbp2(x)=(sqrt(hypot(Iarg(x),Rarg(x)))*sin(atan2(Iarg(x),Rarg(x))/2)+
+ BP*sqrt(bi0(x)*(1-.25/Q0(x)**2))/bi0(x)**par(case))/2
.func zebp1(x)=(sqrt(BP**2*(modk*ze_(x))**(2*sgn(par(case)-.5))+4*wc)-
+ BP*(modk*ze_(x))**sgn(par(case)-.5))/2
.func zebp2(x)=(sqrt(BP**2*(modk*ze_(x))**(2*sgn(par(case)-.5))+4*wc)+
+ BP*(modk*ze_(x))**sgn(par(case)-.5))/2
.func real(x)=if( case<3, bi0(x)**.5/2/Q0(x)/bi0(x)**par(case)*wc**.5,
+ if( x<=ceil(Ord/2), rebp1(x), rebp2(x-ceil(Ord/2)) ) )
.func imag(x)=if( case<3, sqrt(bi0(x)*(1-.25/Q0(x)**2))/bi0(x)**par(case)*wc**.5,
+ if( x<=ceil(Ord/2), imbp1(x), imbp2(x-ceil(Ord/2)) ) )
.func zero(x)=if( case<3, (modk*ze_(x))**sgn(par(case)-.5)*wc**.5,
+ if( x<=ceil(Ord/2), zebp1(x), zebp2(x-ceil(Ord/2)) ) )
.func a2(x)=inv(x==Ord/2+.5&par(case+1))
.func a1(x)=if( x==Ord/2+.5, (case<3)*real(x)+(case==3), 0 )
.func a0(x)=if( x==Ord/2+.5, (case==1)*real(x)**2+(case==4)*wc, zero(x)**2 )
.func b1(x)=(real(x)+real(x*(x==Ord/2+.5&case>2)+x))
.func b0(x)=(real(x)**2+imag(x)**2)**inv(x==Ord/2+.5&case>2)*wc**(x==Ord/2+.5&case>2)
.func _A2(x)=(a2(x)-a1(x)+a0(x))*(x<=Ord/2**(case<3)+.5)
.func _A1(x)=(2*( a0(x)-a2(x) ))*(x<=Ord/2**(case<3)+.5)
.func _A0(x)=(a2(x)+a1(x)+a0(x))*(x<=Ord/2**(case<3)+.5)
.func _B2(x)=(1-b1(x)+b0(x))*(x<=Ord/2**(case<3)+.5)
.func _B1(x)=(2*( b0(x)-1 ))*(x<=Ord/2**(case<3)+.5)
.func _B0(x)=(1+b1(x)+b0(x))**(x<=Ord/2**(case<3)+.5)
Rin in 666 1G
Rsh in 999 1
Ash {quant*999} 0 {quant*0.3} 0 0 0 {quant*666} 0 SAMPLEHOLD td={td}
Iclk 0 {quant*.3} pulse 0 1 0 {tr} {tr} {.5/f0} {1/f0}
Cclk 0 0.3 {Cpar} Rpar=1
Gb0_1 0 667 666 0 {1/_B0(1)}
Gb2_1 0 667 0 {1.2*(1<=ceil(Ord/2**(case<3)))} {_B2(1)/_B0(1)}
Gb2_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.2*(2<=ceil(Ord/2**(case<3)))} {_B2(2)/_B0(2)}
Gb2_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.2*(3<=ceil(Ord/2**(case<3)))} {_B2(3)/_B0(3)}
Gb2_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.2*(4<=ceil(Ord/2**(case<3)))} {_B2(4)/_B0(4)}
Gb2_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.2*(5<=ceil(Ord/2**(case<3)))} {_B2(5)/_B0(5)}
Gb2_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.2*(6<=ceil(Ord/2**(case<3)))} {_B2(6)/_B0(6)}
Gb2_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.2*(7<=ceil(Ord/2**(case<3)))} {_B2(7)/_B0(7)}
Gb2_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.2*(8<=ceil(Ord/2**(case<3)))} {_B2(8)/_B0(8)}
Gb2_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.2*(9<=ceil(Ord/2**(case<3)))} {_B2(9)/_B0(9)}
Gb2_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.2*(10<=ceil(Ord/2**(case<3)))} {_B2(10)/_B0(10)}
Gb2_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.2*(11<=ceil(Ord/2**(case<3)))} {_B2(11)/_B0(11)}
Gb2_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.2*(12<=ceil(Ord/2**(case<3)))} {_B2(12)/_B0(12)}
Gb2_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.2*(13<=ceil(Ord/2**(case<3)))} {_B2(13)/_B0(13)}
Gb2_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.2*(14<=ceil(Ord/2**(case<3)))} {_B2(14)/_B0(14)}
Gb2_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.2*(15<=ceil(Ord/2**(case<3)))} {_B2(15)/_B0(15)}
Gb2_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.2*(16<=ceil(Ord/2**(case<3)))} {_B2(16)/_B0(16)}
Gb1_1 0 667 0 {1.1*(1<=ceil(Ord/2**(case<3)))} {_B1(1)/_B0(1)}
Gb1_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.1*(2<=ceil(Ord/2**(case<3)))} {_B1(2)/_B0(2)}
Gb1_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.1*(3<=ceil(Ord/2**(case<3)))} {_B1(3)/_B0(3)}
Gb1_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.1*(4<=ceil(Ord/2**(case<3)))} {_B1(4)/_B0(4)}
Gb1_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.1*(5<=ceil(Ord/2**(case<3)))} {_B1(5)/_B0(5)}
Gb1_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.1*(6<=ceil(Ord/2**(case<3)))} {_B1(6)/_B0(6)}
Gb1_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.1*(7<=ceil(Ord/2**(case<3)))} {_B1(7)/_B0(7)}
Gb1_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.1*(8<=ceil(Ord/2**(case<3)))} {_B1(8)/_B0(8)}
Gb1_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.1*(9<=ceil(Ord/2**(case<3)))} {_B1(9)/_B0(9)}
Gb1_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.1*(10<=ceil(Ord/2**(case<3)))} {_B1(10)/_B0(10)}
Gb1_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.1*(11<=ceil(Ord/2**(case<3)))} {_B1(11)/_B0(11)}
Gb1_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.1*(12<=ceil(Ord/2**(case<3)))} {_B1(12)/_B0(12)}
Gb1_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.1*(13<=ceil(Ord/2**(case<3)))} {_B1(13)/_B0(13)}
Gb1_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.1*(14<=ceil(Ord/2**(case<3)))} {_B1(14)/_B0(14)}
Gb1_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.1*(15<=ceil(Ord/2**(case<3)))} {_B1(15)/_B0(15)}
Gb1_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.1*(16<=ceil(Ord/2**(case<3)))} {_B1(16)/_B0(16)}
Ga2_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.2*(1<=ceil(Ord/2**(case<3)))} 0 {_A2(1)/_B0(2)}
Ga2_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.2*(2<=ceil(Ord/2**(case<3)))} 0 {_A2(2)/_B0(3)}
Ga2_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.2*(3<=ceil(Ord/2**(case<3)))} 0 {_A2(3)/_B0(4)}
Ga2_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.2*(4<=ceil(Ord/2**(case<3)))} 0 {_A2(4)/_B0(5)}
Ga2_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.2*(5<=ceil(Ord/2**(case<3)))} 0 {_A2(5)/_B0(6)}
Ga2_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.2*(6<=ceil(Ord/2**(case<3)))} 0 {_A2(6)/_B0(7)}
Ga2_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.2*(7<=ceil(Ord/2**(case<3)))} 0 {_A2(7)/_B0(8)}
Ga2_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.2*(8<=ceil(Ord/2**(case<3)))} 0 {_A2(8)/_B0(9)}
Ga2_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.2*(9<=ceil(Ord/2**(case<3)))} 0 {_A2(9)/_B0(10)}
Ga2_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.2*(10<=ceil(Ord/2**(case<3)))} 0 {_A2(10)/_B0(11)}
Ga2_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.2*(11<=ceil(Ord/2**(case<3)))} 0 {_A2(11)/_B0(12)}
Ga2_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.2*(12<=ceil(Ord/2**(case<3)))} 0 {_A2(12)/_B0(13)}
Ga2_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.2*(13<=ceil(Ord/2**(case<3)))} 0 {_A2(13)/_B0(14)}
Ga2_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.2*(14<=ceil(Ord/2**(case<3)))} 0 {_A2(14)/_B0(15)}
Ga2_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.2*(15<=ceil(Ord/2**(case<3)))} 0 {_A2(15)/_B0(16)}
Ga2_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.2*(16<=ceil(Ord/2**(case<3)))} 0 {_A2(16)/_B0(17)}
Ga1_1 0 {1*(1<=ceil(Ord/2**(case<3)))} {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {_A1(1)/_B0(2)}
Ga1_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {_A1(2)/_B0(3)}
Ga1_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {_A1(3)/_B0(4)}
Ga1_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {_A1(4)/_B0(5)}
Ga1_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {_A1(5)/_B0(6)}
Ga1_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {_A1(6)/_B0(7)}
Ga1_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {_A1(7)/_B0(8)}
Ga1_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {_A1(8)/_B0(9)}
Ga1_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {_A1(9)/_B0(10)}
Ga1_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {_A1(10)/_B0(11)}
Ga1_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {_A1(11)/_B0(12)}
Ga1_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {_A1(12)/_B0(13)}
Ga1_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {_A1(13)/_B0(14)}
Ga1_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {_A1(14)/_B0(15)}
Ga1_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {_A1(15)/_B0(16)}
Ga1_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {_A1(16)/_B0(17)}
Ga0_1 0 {1*(1<=ceil(Ord/2**(case<3)))} 667 0 {_A0(1)/_B0(2)}
Ga0_2 0 {2*(2<=ceil(Ord/2**(case<3)))} {1*(2<=ceil(Ord/2**(case<3)))} 0 {_A0(2)/_B0(3)}
Ga0_3 0 {3*(3<=ceil(Ord/2**(case<3)))} {2*(3<=ceil(Ord/2**(case<3)))} 0 {_A0(3)/_B0(4)}
Ga0_4 0 {4*(4<=ceil(Ord/2**(case<3)))} {3*(4<=ceil(Ord/2**(case<3)))} 0 {_A0(4)/_B0(5)}
Ga0_5 0 {5*(5<=ceil(Ord/2**(case<3)))} {4*(5<=ceil(Ord/2**(case<3)))} 0 {_A0(5)/_B0(6)}
Ga0_6 0 {6*(6<=ceil(Ord/2**(case<3)))} {5*(6<=ceil(Ord/2**(case<3)))} 0 {_A0(6)/_B0(7)}
Ga0_7 0 {7*(7<=ceil(Ord/2**(case<3)))} {6*(7<=ceil(Ord/2**(case<3)))} 0 {_A0(7)/_B0(8)}
Ga0_8 0 {8*(8<=ceil(Ord/2**(case<3)))} {7*(8<=ceil(Ord/2**(case<3)))} 0 {_A0(8)/_B0(9)}
Ga0_9 0 {9*(9<=ceil(Ord/2**(case<3)))} {8*(9<=ceil(Ord/2**(case<3)))} 0 {_A0(9)/_B0(10)}
Ga0_10 0 {10*(10<=ceil(Ord/2**(case<3)))} {9*(10<=ceil(Ord/2**(case<3)))} 0 {_A0(10)/_B0(11)}
Ga0_11 0 {11*(11<=ceil(Ord/2**(case<3)))} {10*(11<=ceil(Ord/2**(case<3)))} 0 {_A0(11)/_B0(12)}
Ga0_12 0 {12*(12<=ceil(Ord/2**(case<3)))} {11*(12<=ceil(Ord/2**(case<3)))} 0 {_A0(12)/_B0(13)}
Ga0_13 0 {13*(13<=ceil(Ord/2**(case<3)))} {12*(13<=ceil(Ord/2**(case<3)))} 0 {_A0(13)/_B0(14)}
Ga0_14 0 {14*(14<=ceil(Ord/2**(case<3)))} {13*(14<=ceil(Ord/2**(case<3)))} 0 {_A0(14)/_B0(15)}
Ga0_15 0 {15*(15<=ceil(Ord/2**(case<3)))} {14*(15<=ceil(Ord/2**(case<3)))} 0 {_A0(15)/_B0(16)}
Ga0_16 0 {16*(16<=ceil(Ord/2**(case<3)))} {15*(16<=ceil(Ord/2**(case<3)))} 0 {_A0(16)/_B0(17)}
Tz1_1 0 667 0 {1.1*(1<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_2 0 {1*(2<=ceil(Ord/2**(case<3)))} 0 {2.1*(2<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_3 0 {2*(3<=ceil(Ord/2**(case<3)))} 0 {3.1*(3<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_4 0 {3*(4<=ceil(Ord/2**(case<3)))} 0 {4.1*(4<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_5 0 {4*(5<=ceil(Ord/2**(case<3)))} 0 {5.1*(5<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_6 0 {5*(6<=ceil(Ord/2**(case<3)))} 0 {6.1*(6<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_7 0 {6*(7<=ceil(Ord/2**(case<3)))} 0 {7.1*(7<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_8 0 {7*(8<=ceil(Ord/2**(case<3)))} 0 {8.1*(8<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_9 0 {8*(9<=ceil(Ord/2**(case<3)))} 0 {9.1*(9<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_10 0 {9*(10<=ceil(Ord/2**(case<3)))} 0 {10.1*(10<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_11 0 {10*(11<=ceil(Ord/2**(case<3)))} 0 {11.1*(11<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_12 0 {11*(12<=ceil(Ord/2**(case<3)))} 0 {12.1*(12<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_13 0 {12*(13<=ceil(Ord/2**(case<3)))} 0 {13.1*(13<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_14 0 {13*(14<=ceil(Ord/2**(case<3)))} 0 {14.1*(14<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_15 0 {14*(15<=ceil(Ord/2**(case<3)))} 0 {15.1*(15<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz1_16 0 {15*(16<=ceil(Ord/2**(case<3)))} 0 {16.1*(16<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_1 0 {1.1*(1<=ceil(Ord/2**(case<3)))} 0 {1.2*(1<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_2 0 {2.1*(2<=ceil(Ord/2**(case<3)))} 0 {2.2*(2<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_3 0 {3.1*(3<=ceil(Ord/2**(case<3)))} 0 {3.2*(3<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_4 0 {4.1*(4<=ceil(Ord/2**(case<3)))} 0 {4.2*(4<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_5 0 {5.1*(5<=ceil(Ord/2**(case<3)))} 0 {5.2*(5<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_6 0 {6.1*(6<=ceil(Ord/2**(case<3)))} 0 {6.2*(6<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_7 0 {7.1*(7<=ceil(Ord/2**(case<3)))} 0 {7.2*(7<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_8 0 {8.1*(8<=ceil(Ord/2**(case<3)))} 0 {8.2*(8<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_9 0 {9.1*(9<=ceil(Ord/2**(case<3)))} 0 {9.2*(9<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_10 0 {10.1*(10<=ceil(Ord/2**(case<3)))} 0 {10.2*(10<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_11 0 {11.1*(11<=ceil(Ord/2**(case<3)))} 0 {11.2*(11<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_12 0 {12.1*(12<=ceil(Ord/2**(case<3)))} 0 {12.2*(12<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_13 0 {13.1*(13<=ceil(Ord/2**(case<3)))} 0 {13.2*(13<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_14 0 {14.1*(14<=ceil(Ord/2**(case<3)))} 0 {14.2*(14<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_15 0 {15.1*(15<=ceil(Ord/2**(case<3)))} 0 {15.2*(15<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
Tz2_16 0 {16.1*(16<=ceil(Ord/2**(case<3)))} 0 {16.2*(16<=ceil(Ord/2**(case<3)))} Td={1/f0} Z0=1
R1 {1.2*(1<=ceil(Ord/2**(case<3)))} 0 1
R2 {2.2*(2<=ceil(Ord/2**(case<3)))} 0 1
R3 {3.2*(3<=ceil(Ord/2**(case<3)))} 0 1
R4 {4.2*(4<=ceil(Ord/2**(case<3)))} 0 1
R5 {5.2*(5<=ceil(Ord/2**(case<3)))} 0 1
R6 {6.2*(6<=ceil(Ord/2**(case<3)))} 0 1
R7 {7.2*(7<=ceil(Ord/2**(case<3)))} 0 1
R8 {8.2*(8<=ceil(Ord/2**(case<3)))} 0 1
R9 {9.2*(9<=ceil(Ord/2**(case<3)))} 0 1
R10 {10.2*(10<=ceil(Ord/2**(case<3)))} 0 1
R11 {11.2*(11<=ceil(Ord/2**(case<3)))} 0 1
R12 {12.2*(12<=ceil(Ord/2**(case<3)))} 0 1
R13 {13.2*(13<=ceil(Ord/2**(case<3)))} 0 1
R14 {14.2*(14<=ceil(Ord/2**(case<3)))} 0 1
R15 {15.2*(15<=ceil(Ord/2**(case<3)))} 0 1
R16 {16.2*(16<=ceil(Ord/2**(case<3)))} 0 1
Rx 0 {ceil(Ord/2**(case<3))} 1
.func Ampl(x)=if( par(case) | x>Ord/2, 1, bi0(x)*ze_(x)**2 )
.param Gain=modk**( (Ord-par(Ord+1))*(par(case+1)) )*
+ (rebp1(Ord/2+.5)+rebp2(Ord/2+.5))**(case==3&par(Ord+1))*
+ Ampl(1)*Ampl(2)*Ampl(3)*Ampl(4)*Ampl(5)*Ampl(6)*Ampl(7)*Ampl(8)*Ampl(9)*Ampl(10)*
+ Ampl(11)*Ampl(12)*Ampl(13)*Ampl(14)*Ampl(15)*Ampl(16)
Gout 0 out {if(case>2,2,1)*ceil(Ord/2)-(par(Ord+1)&case>2)} 0 {G*Gain}
Rout out 0 1
VN 0.1 0 {Ord} AC {10**(Ord/20)} {Ord}
Vc 0.2 0 {case} AC {10**(case/20)} {case}
.ends Cauer_IIR
********************************************************************************
********************************************************************************
*
*			~~ FINITE IMPULSE RESPONSE ~~
*
********************************************************************************
********************************************************************************
*
* [GENERAL]
*
* - A 255/256 tap FIR with different windowing functions. It uses 256xT + 128xG
* to do the job done; it may not make the modularity too easy but the speed-up
* is great: try a 1GV step input, it should be a good enough proof.
*
*
* [SYMBOL]
*
*  0.1	= order of filter, "M" (not length, "N"), can be viewed in .AC;
*  0.2	= weights, w[n], if test=1;
*  0.3	= coefficients, h[n], if test=1;
*
* - '0.1' displays the values in dB and deg, e.g. N=65 => M=64 => 64dB,64deg.
*
*
* [PARAMETERS]
*
* N=<1:256>	= length of the filter, 255 (odd type) or 256 (even type);
* f0	[Hz]	= sampling frequency;
* fp1	[Hz]	= lower pass-band frequency;
* fs1	[Hz]	= lower stop-band frequency;
* fp2	[Hz]	= higher pass-band frequency;
* fs2	[Hz]	= higher stop-band frequency;
* As	[dB]	= attenuation in the stop-band (Kaiser only);
* sigma=<0:inf>= 1. factor for the parametric windows (except Kaiser);
*		= 2. factor for the pulse shaping Gaussian (the BT product),
*		default 0.5;
* nT=<0,1:inf>	= 1. number of symbol periods for the pulse-shaping windows, it
*		is automatically determined if N>0, integer, <1:inf>;
*		= 2. adjustment to avoid zero valued mutipliers at the end of
*		the window (think "null-tap" as a mnemonic), for the windows
*		derived from the general cosine, integer, <0,1>;
* a[0:4]	= general cosine window's terms for manual input;
* Win=<0:25>	= windowing functions (see below);
* Choice=<1:6>= the possible additional functions/combinations (see below);
* sim	[s]	= total .TRAN simulation time, only if test=1 (optional);
* test=<0,1>	= enables pins '0.2' and '0.3' but disables S&H (opt.);
* quant=<0,1>	= 1. if test=1, it makes the outputs at pins '0.2' and '0.3'
*		appear sampled (opt.);
*		= 2. if test=0, it enables the S&H behaviour (opt.);
*
* - Hidden:
*
* Cpar	[F]	= capacitance across the clock source, default 10p (opt.);
* tr	[s]	= the sampling clock's rising/falling time, if quant&!test;
*		together with "Cpar" affect the output's erratic spikes, default
*		0.1/f0 (opt.);
* td	[s]	= LTspice's A-device parameter, for the sample & hold, default
*		0.01*tr (opt.).
*	(all three have the same explanation as in the IIR's notes)
*
* - Supported windows (Win=<0:25>), the marked* ones are parametric:
*
*  0 = rectangular
*  1 = triangular
*  2 = Bartlett
*  3 = Tukey*
*  4 = Lanczos
*  5 = Bohman
*  6 = Welch*
*  7 = Connes*
*  8 = Cauchy*
*  9 = Parzen
* 10 = general cosine*
* 11 = von Hann
* 12 = Bartlett-Hann
* 13 = Poisson*
* 14 = Hann-Poisson*
* 15 = Hamming
* 16 = power of cosine*
* 17 = Blackman
* 18 = Exact Blackman
* 19 = Blackman-Nuttall
* 20 = Blackman-Harris, 3 terms
* 21 = Blackman-Harris, 4 terms
* 22 = flat top
* 23 = Gaussian, generic*

* 24 = Kaiser*
* 25 = Kaiser-Bessel
*
*  The following are derived from the general cosine formula and make use of the
* term "nT": von Hann, Hann-Poisson, Hamming, power of cosine, all 4 Blackmans,
* flat top, Kaiser-Bessel. "nT" is internally limited.
*
* - Choice=<1:6> means:
*
*  1 = LP/HP/BP/BS for any of the windows above
*  2 = Gaussian, pulse shaping
*  3 = raised cosine
*  4 = (square) root raised cosine
*  5 = differentiator
*  6 = Hilbert transformer
*
*  This allows for windowing with functions from Choice=<2:6>.
*
* - The type is determined by "Choice" and "N" (plotting "M" at pin '0.1' will
* show which type is, useful if N=0):
*
*	 Choice	|  N	| Type
*	--------+-------+------
*	 1,2,3	| odd	|  I
*		| even	|  II
*	--------+-------+------
*	  3,4	| odd	|  III
*		| even	|  IV
*
* - "test" and "quant" form the following combinations:
*
*	    test | quant
*	   ------+-------
*	[0]  0	 |  0	- normal simulation
*	[3]  0	 |  1	- forces S&H output
*	[1]  1	 |  0	- enables pins '0.2' and '0.3'
*	[2]  1	 |  1	- quantizes the outputs at '0.2' and '0.3'
*
*  The numbers in square brackets represent the slowing-down scale, with "0" at
* the lowest (no slow-down) and 3 at its maximum. Only quant=1 will enable the
* S&H, test&quant will not, even if it may have an effect on the output. Even if
* test&quant may be a whim, it's useful if the coefficients/weights are needed
* to be known.
*
* - The following windows are parametric, f(sigma):
*
*	   Window	|  sigma
*	----------------+----------
*	Tuckey		| <0:1>
*	Welch		| <1:inf>
*	Connes		| <1:inf>
*	Cauchy		| <0:inf>
*	general cosine	| <0:inf>
*	Poisson		| <0:inf>
*	Hann-Poisson	| <0:inf>
*	power of cosine | int(sigma)
*	Gaussian (both)	| <0:inf>
*
*  The maximum value is shown here as infinity, but the common sense should be
* the limit. Also, <0:inf> doesn't mean that this is the range "sigma" should
* be, it just tells about the possible limits. The default value of 0.5, even if
* it is not in the range of Welch and Connes windows, will let them simulate,
* obviously wrong, but without LTspice complaining. Kaiser, though parametric,
* has beta=f(As).
*
*
* [CHARACTERISTICS]
*
* - The four frequencies decide one of the four configurations, LP/HP/BP/BS, and
* share the same explanations (and graphs) as in the analog section.
* - When N=0 the order will be calculated according to Kaiser's formula for all
* except for the pulse shaping windows (Choice=<2,3,4>), then it's according to
* the following formulas:
*	N = nT*SPS+1
*	SPS = 2*f0/(fp1+fs1)
*	beta = (fs1-fp1)/(fs1+fp1)	for raised and root raised cosine, or,
* if you need the inverse:
*	fp1 = f0/SPS*(1-beta)
*	fs1 = f0/SPS*(1+beta)
* All the pulse-shaping windows should only be LP (fp2=0, fs2=0) with "N" odd if
* manually specified, for a correct response. They will simulate otherwise but
* with wrong results. Do note that SPS needs to be at least 2 and, for example,
* nT=12 for a +/-6 symbols value.
* - The input is floating unless [quant&!test], then Rin=1G. It will also have
* the same effect on .AC simulation as it does for IIR.
* - The output resistance equals the sum of the coefficients if the FIR acts as
* a low-pass and Choice<=4. If it is a differentiator, it will be 2*pi*fp1/f0,
* because it's normalized for 0dB@fp1; else, it's 1 Ohm.
* - If [quant&!test], the output will always start from zero, same explanation
* as in the IIR case.
*
*
* [NOTES]
*
* - The gain, as for the other filters, is normalized for DC=0dB and so are the
* pulse-shaping windows. However, I found out that that is not the case for the
* raised and root raised cosine windows. Because of that, if the current DC gain
* is not as desired, search for ".param Gain=" at the end of the .subckt, there
* will be two statements: one of them active and the other commented out; simply
* reverse them.
* - Don't forget that the type is automatically determined so, for example, if
* a high-pass is desired, "N" may turn out to be even => type II => low-pass.
* - If test=1, "sim" should be supplied, representing the total .TRAN time; for
* example if the command is ".tran 25m" then sim=25m.
* - Decreasing N will mean increasing speed because the tlines are internally
* disabled (or enabled) depending on the need. In other words, it will only get
* slow if N is increased.
* - It is possible to have N>256, but the tweakers will have to use their own
* spreadsheets (hint...). This is actually valid for every filter that uses this
* sort of behaviour.
* - Because of the above, for N<256 the error log will fill up with messages
* like "u1:tz125: all pins shorted together -- ignoring", or similar. Simply
* ignore them.
* - Kaiser's Bessel function is truncated to n=20, which is 5 decimals accurate
* for As=120dB. It should be enough but, if it needs to be even lower, here are
* some numbers for comparison: @As=200dB => beta=21.08126 =>
*  I0[20]=125043315.59586107 , current value, compared to
*  I0[30]=125047823.50339583 ,
* which is a 0.0036% difference...
* - If the input is a step (steep transients), or the order and the sampling
* frequency are not too high, "quant" may not need to be set in order to see a
* sampled output (albeit distorted), but for a sine input, the transitions will
* be smooth and the output will be the same (more or less, there still are
* tlines at work).
*
************************
*
*	FIR
*
************************
.subckt FIR in out 0.1 0.2 0.3
.param f0=10k
.param As=60
.param N=65
.param fp1=1k2
.param fs1=0k8
.param fp2=1k8
.param fs2=2k2
.param sigma=0.5
.param nT=1
.param a0=1 a1=1 a2=1 a3=1 a4=1
.param Win=0 Choice=1
.param test=0 quant=0 sim=1 Cpar=10p tr=.1/f0 td=10m*tr
.param wtw1=pi*abs(fs1-fp1)/f0 wtw2=if( case<3, 7, pi*abs(fs2-fp2)/f0 )
.param wc1=pi*(fs1+fp1)/f0  wc2=pi*(fs2+fp2)/f0
.param Ord=if(As>=21, ceil((As-8)/2.285/min(wtw1,wtw2)), ceil(5.79/min(wtw1,wtw2)) )
.param Type=1+par(M+1)+2*(Choice>4)
.param  M=if( N>0, N-1, if( Choice>1 & Choice<5, nT*SPS, Ord ) )
.param b=if( As<21,0, if( As<50,0.5842*(As-21)**0.4+0.07886*(As-21),0.1102*(As-8.7) ) )
.param case=if( fp1<fs1 & fp2==0 & fs2==0 & fp1>0, 1,
+ if( fp1>fs1 & fp2==0 & fs2==0 & fs1>0, 2,
+ if( fp1<fs1 & fp2>fs2 & fs2>fs1 & fp1>0, 3,
+ if( fp1>fs1 & fp2<fs2 & fp2>fp1 & fs1>0, 4, 0 ))))
.param hi0=table( case, 0, 0, 1, wc1/pi, 2, 1-wc1/pi, 3, 1-(wc2-wc1)/pi, 4, (wc2-wc1)/pi )
.param SPS=2*f0/(fp1+fs1) beta=(fs1-fp1)/(fp1+fs1)
.func par(x)=1-ceil(x/2)+floor(x/2)
.func hi(x)=if( x==M/2, hi0, (-1)**case*( sin(wc2*(x-M/2))-sin(wc1*(x-M/2)) )/( pi*(x-M/2) ) )
.func trng(x)=1-2*abs(x-M/2)/(M+1+par(M+1))
.func bart(x)=if( x<=M/2, 2*x/M, 2-2*x/M )
.func tuk(x)=if( (x>=M/2*sigma & x<=M-M/2*sigma) | sigma==0, 1,
+ .5+cos(2*pi/sigma*(x/M-(x>M/2)+sgn(x-M/2)*sigma/2))/2 )
.func lanc(x)=if( x==M/2, 1, sin(2*pi*(x-M/2)/M)/(2*pi*(x-M/2)/M) )
.func boh(x)=(1-abs(x-M/2)*2/M)*cos(2*pi*abs(x-M/2)/M)+sin(2*pi*abs(x-M/2)/M)/pi
.func wel(x)=1-4*((x-M/2)/M/sigma)**2
.func con(x)=wel(x)**2
.func cau(x)=1/(4*sigma**2*((x-M/2)/M)**2+1)
.func parz(x)=if( x<=(M-1)/4 | x>=(M-1)*.75, 16*(.5-abs(x-M/2)/M)**3,
+ 1-24*((x-M/2)/M)**2+48*(abs(x-M/2)/M)**3 )
.func gcos(x,y0,y1,y2,y3,y4)=y4*cos((8*(x+u(nT))*pi)/(M+2*u(nT)))-y3*cos((6*(x+u(nT))*pi)/
+ (M+2*u(nT)))+y2*cos((4*(x+u(nT))*pi)/(M+2*u(nT)))-y1*cos((2*(x+u(nT))*pi)/(M+2*u(nT)))+y0
.func han(x)=gcos(x,0.5,0.5,0,0,0)
.func bhan(x)=0.62-0.48*abs(x/M-.5)+0.38*cos(2*pi*(x/M-.5))
.func pois(x)=exp(-2*sigma*abs(x-M/2)/M)
.func phan(x)=han(x)*pois(x)
.func ham(x)=gcos(x,0.54,0.46,0,0,0)
.func pcos(x)=gcos((x+M/2)/2,0,1,0,0,0)**int(sigma)
.func ebla(x)=gcos(x,0.426591,0.496561,0.076848667,0,0)
.func bla(x)=gcos(x,0.42,0.5,0.08,0,0)
.func blan(x)=gcos(x,0.3635819,0.4891775,0.1365995,0.0106411,0)
.func blah3(x)=gcos(x,0.422323,0.49755,0.07922,0,0)
.func blah4(x)=gcos(x,0.35875,0.48829,0.14128,0.01168,0)
.func ftop(x)=gcos(x,0.21557895,0.41663158,0.277263158,0.083578947,0.006947368)
.func gau(x)=exp(-2*( (x-M/2)/sigma/M )**2)
.func kai(x)=if( b==0, 1, I0( b*sqrt(1-((x-M/2)/(M/2))**2) )/I0(b) )
.func kaib(x)=gcos(x,0.402,0.498,0.099,1m,0)
.func diff(x)=if( x==0 | x==M/2, 0, wc1*cos((x-M/2)*wc1)/pi/(x-M/2)-sin(wc1*(x-M/2))/
+ pi/(x-M/2)**2 )
.func hilb(x)=if( par(M+1), -1/pi/(x-M/2), if( x==M/2, 0, (1-cos(pi*(x-M/2)))/pi/(x-M/2) ) )
.func rc(x)=if( x==M/2 | beta==0, 1, sin(pi*(x-M/2)/SPS)/(pi*(x-M/2)/SPS) )*
+ if( x==.5*(M+sgn(x-M/2+1m)*SPS/beta), pi/4,
+ cos(pi*beta*(x-M/2)/SPS)/(1-4*(beta*(x-M/2)/SPS)**2) )
.func rrc(x)=if( beta==0, 1, if( x==M/2, 1-beta+4*beta/pi,
+ if( x==M/2+sgn(x-M/2+1m)*SPS/4/beta, beta/sqrt(2)*((1+2/pi)*sin(pi/4/beta)+
+ (1-2/pi)*cos(pi/4/beta)),(sin(pi*(x-M/2)/SPS*(1-beta))+4*beta*(x-M/2)/SPS*
+ cos(pi*(x-M/2)/SPS*(1+beta)))/(pi*(x-M/2)/SPS*(1-(4*beta*(x-M/2)/SPS)**2)) )))
.func gaup(x)=sqrt(2*pi/ln(2))*sigma*exp(-2/ln(2)*(pi*(x-M/2)/SPS*sigma)**2)
.func I0(x)=(x**2*(x**2*(x**2*(x**2*(x**2*(x**2*(x**2*(x**2*(x**2*(x**2*
+ (x**2*(x**2*(x**2*(x**2*(x**2*(x**2*(x**2*(x**2*(x**2*(x**2+1600)+2310400)+
+ 2994278400)+3461385830400)+3544459090329600)+3190013181296640000)+
+ 2500970334136565760000)+1690655945876318453760000)+
+ 973817824824759429365760000)+471327827215183563813027840000)+
+ 188531130886073425525211136000000)+
+ 61084086407087789870168408064000000)+
+ 15637526120214474206763112464384000000)+
+ 3064955119562036944525570043019264000000)+
+ 441353537216933320011682086194774016000000)+
+ 44135353721693332001168208619477401600000000)+
+ 2824662638188373248074765351646553702400000000)+
+ 101687854974781436930691552659275933286400000000)+
+ 1627005679596502990891064842548414932582400000000)+
+ 6508022718386011963564259370193659730329600000000)/
+ 6508022718386011963564259370193659730329600000000
.func w(x)=table(Win, 0, 1, 1, trng(x), 2, bart(x), 3, tuk(x), 4, lanc(x), 5, boh(x),
+ 6, wel(x), 7, con(x), 8, cau(x), 9, parz(x), 10, gcos(x,a0,a1,a2,a3,a4), 11, han(x),
+ 12, bhan(x), 13, pois(x), 14, phan(x), 15, ham(x), 16, pcos(x), 17, bla(x), 18, ebla(x),
+ 19, blan(x), 20, blah3(x), 21, blah4(x), 22, ftop(x), 23, gau(x), 24, kai(x), 25, kaib(x))
.func h(x)=if(x<=M/2,w(x)*term(x),0)
.func term(x)=table(Choice,1,hi(x),2,gaup(x),3,rc(x),4,rrc(x),5,diff(x),6,hilb(x))
Rin in 666 1G
Rsh in 999 1
Ash {quant*inv(test)*999} 0 {quant*inv(test)*0.5} 0 0 0 {quant*inv(test)*666} 0 SAMPLEHOLD td={td}
Ish 0 {quant*inv(test)*.5} pulse 0 1 0 {tr} {tr} {.5/f0} {1/f0}
Csh 0 0.5 {Cpar} Rpar=1
Gx 0 667 666 0 1
Rx {M} 0 1
Tz1 667 0 {M>1} 0 Td={1/f0} Z0=1
Tz2 {1*(M>3)} 0 {2*(M>3)} 0 Td={1/f0} Z0=1
Tz3 {2*(M>5)} 0 {3*(M>5)} 0 Td={1/f0} Z0=1
Tz4 {3*(M>7)} 0 {4*(M>7)} 0 Td={1/f0} Z0=1
Tz5 {4*(M>9)} 0 {5*(M>9)} 0 Td={1/f0} Z0=1
Tz6 {5*(M>11)} 0 {6*(M>11)} 0 Td={1/f0} Z0=1
Tz7 {6*(M>13)} 0 {7*(M>13)} 0 Td={1/f0} Z0=1
Tz8 {7*(M>15)} 0 {8*(M>15)} 0 Td={1/f0} Z0=1
Tz9 {8*(M>17)} 0 {9*(M>17)} 0 Td={1/f0} Z0=1
Tz10 {9*(M>19)} 0 {10*(M>19)} 0 Td={1/f0} Z0=1
Tz11 {10*(M>21)} 0 {11*(M>21)} 0 Td={1/f0} Z0=1
Tz12 {11*(M>23)} 0 {12*(M>23)} 0 Td={1/f0} Z0=1
Tz13 {12*(M>25)} 0 {13*(M>25)} 0 Td={1/f0} Z0=1
Tz14 {13*(M>27)} 0 {14*(M>27)} 0 Td={1/f0} Z0=1
Tz15 {14*(M>29)} 0 {15*(M>29)} 0 Td={1/f0} Z0=1
Tz16 {15*(M>31)} 0 {16*(M>31)} 0 Td={1/f0} Z0=1
Tz17 {16*(M>33)} 0 {17*(M>33)} 0 Td={1/f0} Z0=1
Tz18 {17*(M>35)} 0 {18*(M>35)} 0 Td={1/f0} Z0=1
Tz19 {18*(M>37)} 0 {19*(M>37)} 0 Td={1/f0} Z0=1
Tz20 {19*(M>39)} 0 {20*(M>39)} 0 Td={1/f0} Z0=1
Tz21 {20*(M>41)} 0 {21*(M>41)} 0 Td={1/f0} Z0=1
Tz22 {21*(M>43)} 0 {22*(M>43)} 0 Td={1/f0} Z0=1
Tz23 {22*(M>45)} 0 {23*(M>45)} 0 Td={1/f0} Z0=1
Tz24 {23*(M>47)} 0 {24*(M>47)} 0 Td={1/f0} Z0=1
Tz25 {24*(M>49)} 0 {25*(M>49)} 0 Td={1/f0} Z0=1
Tz26 {25*(M>51)} 0 {26*(M>51)} 0 Td={1/f0} Z0=1
Tz27 {26*(M>53)} 0 {27*(M>53)} 0 Td={1/f0} Z0=1
Tz28 {27*(M>55)} 0 {28*(M>55)} 0 Td={1/f0} Z0=1
Tz29 {28*(M>57)} 0 {29*(M>57)} 0 Td={1/f0} Z0=1
Tz30 {29*(M>59)} 0 {30*(M>59)} 0 Td={1/f0} Z0=1
Tz31 {30*(M>61)} 0 {31*(M>61)} 0 Td={1/f0} Z0=1
Tz32 {31*(M>63)} 0 {32*(M>63)} 0 Td={1/f0} Z0=1
Tz33 {32*(M>65)} 0 {33*(M>65)} 0 Td={1/f0} Z0=1
Tz34 {33*(M>67)} 0 {34*(M>67)} 0 Td={1/f0} Z0=1
Tz35 {34*(M>69)} 0 {35*(M>69)} 0 Td={1/f0} Z0=1
Tz36 {35*(M>71)} 0 {36*(M>71)} 0 Td={1/f0} Z0=1
Tz37 {36*(M>73)} 0 {37*(M>73)} 0 Td={1/f0} Z0=1
Tz38 {37*(M>75)} 0 {38*(M>75)} 0 Td={1/f0} Z0=1
Tz39 {38*(M>77)} 0 {39*(M>77)} 0 Td={1/f0} Z0=1
Tz40 {39*(M>79)} 0 {40*(M>79)} 0 Td={1/f0} Z0=1
Tz41 {40*(M>81)} 0 {41*(M>81)} 0 Td={1/f0} Z0=1
Tz42 {41*(M>83)} 0 {42*(M>83)} 0 Td={1/f0} Z0=1
Tz43 {42*(M>85)} 0 {43*(M>85)} 0 Td={1/f0} Z0=1
Tz44 {43*(M>87)} 0 {44*(M>87)} 0 Td={1/f0} Z0=1
Tz45 {44*(M>89)} 0 {45*(M>89)} 0 Td={1/f0} Z0=1
Tz46 {45*(M>91)} 0 {46*(M>91)} 0 Td={1/f0} Z0=1
Tz47 {46*(M>93)} 0 {47*(M>93)} 0 Td={1/f0} Z0=1
Tz48 {47*(M>95)} 0 {48*(M>95)} 0 Td={1/f0} Z0=1
Tz49 {48*(M>97)} 0 {49*(M>97)} 0 Td={1/f0} Z0=1
Tz50 {49*(M>99)} 0 {50*(M>99)} 0 Td={1/f0} Z0=1
Tz51 {50*(M>101)} 0 {51*(M>101)} 0 Td={1/f0} Z0=1
Tz52 {51*(M>103)} 0 {52*(M>103)} 0 Td={1/f0} Z0=1
Tz53 {52*(M>105)} 0 {53*(M>105)} 0 Td={1/f0} Z0=1
Tz54 {53*(M>107)} 0 {54*(M>107)} 0 Td={1/f0} Z0=1
Tz55 {54*(M>109)} 0 {55*(M>109)} 0 Td={1/f0} Z0=1
Tz56 {55*(M>111)} 0 {56*(M>111)} 0 Td={1/f0} Z0=1
Tz57 {56*(M>113)} 0 {57*(M>113)} 0 Td={1/f0} Z0=1
Tz58 {57*(M>115)} 0 {58*(M>115)} 0 Td={1/f0} Z0=1
Tz59 {58*(M>117)} 0 {59*(M>117)} 0 Td={1/f0} Z0=1
Tz60 {59*(M>119)} 0 {60*(M>119)} 0 Td={1/f0} Z0=1
Tz61 {60*(M>121)} 0 {61*(M>121)} 0 Td={1/f0} Z0=1
Tz62 {61*(M>123)} 0 {62*(M>123)} 0 Td={1/f0} Z0=1
Tz63 {62*(M>125)} 0 {63*(M>125)} 0 Td={1/f0} Z0=1
Tz64 {63*(M>127)} 0 {64*(M>127)} 0 Td={1/f0} Z0=1
Tz65 {64*(M>129)} 0 {65*(M>129)} 0 Td={1/f0} Z0=1
Tz66 {65*(M>131)} 0 {66*(M>131)} 0 Td={1/f0} Z0=1
Tz67 {66*(M>133)} 0 {67*(M>133)} 0 Td={1/f0} Z0=1
Tz68 {67*(M>135)} 0 {68*(M>135)} 0 Td={1/f0} Z0=1
Tz69 {68*(M>137)} 0 {69*(M>137)} 0 Td={1/f0} Z0=1
Tz70 {69*(M>139)} 0 {70*(M>139)} 0 Td={1/f0} Z0=1
Tz71 {70*(M>141)} 0 {71*(M>141)} 0 Td={1/f0} Z0=1
Tz72 {71*(M>143)} 0 {72*(M>143)} 0 Td={1/f0} Z0=1
Tz73 {72*(M>145)} 0 {73*(M>145)} 0 Td={1/f0} Z0=1
Tz74 {73*(M>147)} 0 {74*(M>147)} 0 Td={1/f0} Z0=1
Tz75 {74*(M>149)} 0 {75*(M>149)} 0 Td={1/f0} Z0=1
Tz76 {75*(M>151)} 0 {76*(M>151)} 0 Td={1/f0} Z0=1
Tz77 {76*(M>153)} 0 {77*(M>153)} 0 Td={1/f0} Z0=1
Tz78 {77*(M>155)} 0 {78*(M>155)} 0 Td={1/f0} Z0=1
Tz79 {78*(M>157)} 0 {79*(M>157)} 0 Td={1/f0} Z0=1
Tz80 {79*(M>159)} 0 {80*(M>159)} 0 Td={1/f0} Z0=1
Tz81 {80*(M>161)} 0 {81*(M>161)} 0 Td={1/f0} Z0=1
Tz82 {81*(M>163)} 0 {82*(M>163)} 0 Td={1/f0} Z0=1
Tz83 {82*(M>165)} 0 {83*(M>165)} 0 Td={1/f0} Z0=1
Tz84 {83*(M>167)} 0 {84*(M>167)} 0 Td={1/f0} Z0=1
Tz85 {84*(M>169)} 0 {85*(M>169)} 0 Td={1/f0} Z0=1
Tz86 {85*(M>171)} 0 {86*(M>171)} 0 Td={1/f0} Z0=1
Tz87 {86*(M>173)} 0 {87*(M>173)} 0 Td={1/f0} Z0=1
Tz88 {87*(M>175)} 0 {88*(M>175)} 0 Td={1/f0} Z0=1

Tz89 {88*(M>177)} 0 {89*(M>177)} 0 Td={1/f0} Z0=1
Tz90 {89*(M>179)} 0 {90*(M>179)} 0 Td={1/f0} Z0=1
Tz91 {90*(M>181)} 0 {91*(M>181)} 0 Td={1/f0} Z0=1
Tz92 {91*(M>183)} 0 {92*(M>183)} 0 Td={1/f0} Z0=1
Tz93 {92*(M>185)} 0 {93*(M>185)} 0 Td={1/f0} Z0=1
Tz94 {93*(M>187)} 0 {94*(M>187)} 0 Td={1/f0} Z0=1
Tz95 {94*(M>189)} 0 {95*(M>189)} 0 Td={1/f0} Z0=1
Tz96 {95*(M>191)} 0 {96*(M>191)} 0 Td={1/f0} Z0=1
Tz97 {96*(M>193)} 0 {97*(M>193)} 0 Td={1/f0} Z0=1
Tz98 {97*(M>195)} 0 {98*(M>195)} 0 Td={1/f0} Z0=1
Tz99 {98*(M>197)} 0 {99*(M>197)} 0 Td={1/f0} Z0=1
Tz100 {99*(M>199)} 0 {100*(M>199)} 0 Td={1/f0} Z0=1
Tz101 {100*(M>201)} 0 {101*(M>201)} 0 Td={1/f0} Z0=1
Tz102 {101*(M>203)} 0 {102*(M>203)} 0 Td={1/f0} Z0=1
Tz103 {102*(M>205)} 0 {103*(M>205)} 0 Td={1/f0} Z0=1
Tz104 {103*(M>207)} 0 {104*(M>207)} 0 Td={1/f0} Z0=1
Tz105 {104*(M>209)} 0 {105*(M>209)} 0 Td={1/f0} Z0=1
Tz106 {105*(M>211)} 0 {106*(M>211)} 0 Td={1/f0} Z0=1
Tz107 {106*(M>213)} 0 {107*(M>213)} 0 Td={1/f0} Z0=1
Tz108 {107*(M>215)} 0 {108*(M>215)} 0 Td={1/f0} Z0=1
Tz109 {108*(M>217)} 0 {109*(M>217)} 0 Td={1/f0} Z0=1
Tz110 {109*(M>219)} 0 {110*(M>219)} 0 Td={1/f0} Z0=1
Tz111 {110*(M>221)} 0 {111*(M>221)} 0 Td={1/f0} Z0=1
Tz112 {111*(M>223)} 0 {112*(M>223)} 0 Td={1/f0} Z0=1
Tz113 {112*(M>225)} 0 {113*(M>225)} 0 Td={1/f0} Z0=1
Tz114 {113*(M>227)} 0 {114*(M>227)} 0 Td={1/f0} Z0=1
Tz115 {114*(M>229)} 0 {115*(M>229)} 0 Td={1/f0} Z0=1
Tz116 {115*(M>231)} 0 {116*(M>231)} 0 Td={1/f0} Z0=1
Tz117 {116*(M>233)} 0 {117*(M>233)} 0 Td={1/f0} Z0=1
Tz118 {117*(M>235)} 0 {118*(M>235)} 0 Td={1/f0} Z0=1
Tz119 {118*(M>237)} 0 {119*(M>237)} 0 Td={1/f0} Z0=1
Tz120 {119*(M>239)} 0 {120*(M>239)} 0 Td={1/f0} Z0=1
Tz121 {120*(M>241)} 0 {121*(M>241)} 0 Td={1/f0} Z0=1
Tz122 {121*(M>243)} 0 {122*(M>243)} 0 Td={1/f0} Z0=1
Tz123 {122*(M>245)} 0 {123*(M>245)} 0 Td={1/f0} Z0=1
Tz124 {123*(M>247)} 0 {124*(M>247)} 0 Td={1/f0} Z0=1
Tz125 {124*(M>249)} 0 {125*(M>249)} 0 Td={1/f0} Z0=1
Tz126 {125*(M>251)} 0 {126*(M>251)} 0 Td={1/f0} Z0=1
Tz127 {126*(M>253)} 0 {127*(M>253)} 0 Td={1/f0} Z0=1
Tz255 {M-1} 0 {M} 0 Td={1/f0} Z0=1
Tz254 {(M-2)*(M>2)} 0 {(M-1)*(M>2)*inv(nc(1))} {(M-1)*(M>2)*nc(1)} Td={1/f0} Z0=1
Tz253 {(M-3)*(M>4)} 0 {(M-2)*(M>4)*inv(nc(2))} {(M-2)*(M>4)*nc(2)} Td={1/f0} Z0=1
Tz252 {(M-4)*(M>6)} 0 {(M-3)*(M>6)*inv(nc(3))} {(M-3)*(M>6)*nc(3)} Td={1/f0} Z0=1
Tz251 {(M-5)*(M>8)} 0 {(M-4)*(M>8)*inv(nc(4))} {(M-4)*(M>8)*nc(4)} Td={1/f0} Z0=1
Tz250 {(M-6)*(M>10)} 0 {(M-5)*(M>10)*inv(nc(5))} {(M-5)*(M>10)*nc(5)} Td={1/f0} Z0=1
Tz249 {(M-7)*(M>12)} 0 {(M-6)*(M>12)*inv(nc(6))} {(M-6)*(M>12)*nc(6)} Td={1/f0} Z0=1
Tz248 {(M-8)*(M>14)} 0 {(M-7)*(M>14)*inv(nc(7))} {(M-7)*(M>14)*nc(7)} Td={1/f0} Z0=1
Tz247 {(M-9)*(M>16)} 0 {(M-8)*(M>16)*inv(nc(8))} {(M-8)*(M>16)*nc(8)} Td={1/f0} Z0=1
Tz246 {(M-10)*(M>18)} 0 {(M-9)*(M>18)*inv(nc(9))} {(M-9)*(M>18)*nc(9)} Td={1/f0} Z0=1
Tz245 {(M-11)*(M>20)} 0 {(M-10)*(M>20)*inv(nc(10))} {(M-10)*(M>20)*nc(10)} Td={1/f0} Z0=1
Tz244 {(M-12)*(M>22)} 0 {(M-11)*(M>22)*inv(nc(11))} {(M-11)*(M>22)*nc(11)} Td={1/f0} Z0=1
Tz243 {(M-13)*(M>24)} 0 {(M-12)*(M>24)*inv(nc(12))} {(M-12)*(M>24)*nc(12)} Td={1/f0} Z0=1
Tz242 {(M-14)*(M>26)} 0 {(M-13)*(M>26)*inv(nc(13))} {(M-13)*(M>26)*nc(13)} Td={1/f0} Z0=1
Tz241 {(M-15)*(M>28)} 0 {(M-14)*(M>28)*inv(nc(14))} {(M-14)*(M>28)*nc(14)} Td={1/f0} Z0=1
Tz240 {(M-16)*(M>30)} 0 {(M-15)*(M>30)*inv(nc(15))} {(M-15)*(M>30)*nc(15)} Td={1/f0} Z0=1
Tz239 {(M-17)*(M>32)} 0 {(M-16)*(M>32)*inv(nc(16))} {(M-16)*(M>32)*nc(16)} Td={1/f0} Z0=1
Tz238 {(M-18)*(M>34)} 0 {(M-17)*(M>34)*inv(nc(17))} {(M-17)*(M>34)*nc(17)} Td={1/f0} Z0=1
Tz237 {(M-19)*(M>36)} 0 {(M-18)*(M>36)*inv(nc(18))} {(M-18)*(M>36)*nc(18)} Td={1/f0} Z0=1
Tz236 {(M-20)*(M>38)} 0 {(M-19)*(M>38)*inv(nc(19))} {(M-19)*(M>38)*nc(19)} Td={1/f0} Z0=1
Tz235 {(M-21)*(M>40)} 0 {(M-20)*(M>40)*inv(nc(20))} {(M-20)*(M>40)*nc(20)} Td={1/f0} Z0=1
Tz234 {(M-22)*(M>42)} 0 {(M-21)*(M>42)*inv(nc(21))} {(M-21)*(M>42)*nc(21)} Td={1/f0} Z0=1
Tz233 {(M-23)*(M>44)} 0 {(M-22)*(M>44)*inv(nc(22))} {(M-22)*(M>44)*nc(22)} Td={1/f0} Z0=1
Tz232 {(M-24)*(M>46)} 0 {(M-23)*(M>46)*inv(nc(23))} {(M-23)*(M>46)*nc(23)} Td={1/f0} Z0=1
Tz231 {(M-25)*(M>48)} 0 {(M-24)*(M>48)*inv(nc(24))} {(M-24)*(M>48)*nc(24)} Td={1/f0} Z0=1
Tz230 {(M-26)*(M>50)} 0 {(M-25)*(M>50)*inv(nc(25))} {(M-25)*(M>50)*nc(25)} Td={1/f0} Z0=1
Tz229 {(M-27)*(M>52)} 0 {(M-26)*(M>52)*inv(nc(26))} {(M-26)*(M>52)*nc(26)} Td={1/f0} Z0=1
Tz228 {(M-28)*(M>54)} 0 {(M-27)*(M>54)*inv(nc(27))} {(M-27)*(M>54)*nc(27)} Td={1/f0} Z0=1
Tz227 {(M-29)*(M>56)} 0 {(M-28)*(M>56)*inv(nc(28))} {(M-28)*(M>56)*nc(28)} Td={1/f0} Z0=1
Tz226 {(M-30)*(M>58)} 0 {(M-29)*(M>58)*inv(nc(29))} {(M-29)*(M>58)*nc(29)} Td={1/f0} Z0=1
Tz225 {(M-31)*(M>60)} 0 {(M-30)*(M>60)*inv(nc(30))} {(M-30)*(M>60)*nc(30)} Td={1/f0} Z0=1
Tz224 {(M-32)*(M>62)} 0 {(M-31)*(M>62)*inv(nc(31))} {(M-31)*(M>62)*nc(31)} Td={1/f0} Z0=1
Tz223 {(M-33)*(M>64)} 0 {(M-32)*(M>64)*inv(nc(32))} {(M-32)*(M>64)*nc(32)} Td={1/f0} Z0=1
Tz222 {(M-34)*(M>66)} 0 {(M-33)*(M>66)*inv(nc(33))} {(M-33)*(M>66)*nc(33)} Td={1/f0} Z0=1
Tz221 {(M-35)*(M>68)} 0 {(M-34)*(M>68)*inv(nc(34))} {(M-34)*(M>68)*nc(34)} Td={1/f0} Z0=1
Tz220 {(M-36)*(M>70)} 0 {(M-35)*(M>70)*inv(nc(35))} {(M-35)*(M>70)*nc(35)} Td={1/f0} Z0=1
Tz219 {(M-37)*(M>72)} 0 {(M-36)*(M>72)*inv(nc(36))} {(M-36)*(M>72)*nc(36)} Td={1/f0} Z0=1
Tz218 {(M-38)*(M>74)} 0 {(M-37)*(M>74)*inv(nc(37))} {(M-37)*(M>74)*nc(37)} Td={1/f0} Z0=1
Tz217 {(M-39)*(M>76)} 0 {(M-38)*(M>76)*inv(nc(38))} {(M-38)*(M>76)*nc(38)} Td={1/f0} Z0=1
Tz216 {(M-40)*(M>78)} 0 {(M-39)*(M>78)*inv(nc(39))} {(M-39)*(M>78)*nc(39)} Td={1/f0} Z0=1
Tz215 {(M-41)*(M>80)} 0 {(M-40)*(M>80)*inv(nc(40))} {(M-40)*(M>80)*nc(40)} Td={1/f0} Z0=1
Tz214 {(M-42)*(M>82)} 0 {(M-41)*(M>82)*inv(nc(41))} {(M-41)*(M>82)*nc(41)} Td={1/f0} Z0=1
Tz213 {(M-43)*(M>84)} 0 {(M-42)*(M>84)*inv(nc(42))} {(M-42)*(M>84)*nc(42)} Td={1/f0} Z0=1
Tz212 {(M-44)*(M>86)} 0 {(M-43)*(M>86)*inv(nc(43))} {(M-43)*(M>86)*nc(43)} Td={1/f0} Z0=1
Tz211 {(M-45)*(M>88)} 0 {(M-44)*(M>88)*inv(nc(44))} {(M-44)*(M>88)*nc(44)} Td={1/f0} Z0=1
Tz210 {(M-46)*(M>90)} 0 {(M-45)*(M>90)*inv(nc(45))} {(M-45)*(M>90)*nc(45)} Td={1/f0} Z0=1
Tz209 {(M-47)*(M>92)} 0 {(M-46)*(M>92)*inv(nc(46))} {(M-46)*(M>92)*nc(46)} Td={1/f0} Z0=1
Tz208 {(M-48)*(M>94)} 0 {(M-47)*(M>94)*inv(nc(47))} {(M-47)*(M>94)*nc(47)} Td={1/f0} Z0=1
Tz207 {(M-49)*(M>96)} 0 {(M-48)*(M>96)*inv(nc(48))} {(M-48)*(M>96)*nc(48)} Td={1/f0} Z0=1
Tz206 {(M-50)*(M>98)} 0 {(M-49)*(M>98)*inv(nc(49))} {(M-49)*(M>98)*nc(49)} Td={1/f0} Z0=1
Tz205 {(M-51)*(M>100)} 0 {(M-50)*(M>100)*inv(nc(50))} {(M-50)*(M>100)*nc(50)} Td={1/f0} Z0=1
Tz204 {(M-52)*(M>102)} 0 {(M-51)*(M>102)*inv(nc(51))} {(M-51)*(M>102)*nc(51)} Td={1/f0} Z0=1
Tz203 {(M-53)*(M>104)} 0 {(M-52)*(M>104)*inv(nc(52))} {(M-52)*(M>104)*nc(52)} Td={1/f0} Z0=1
Tz202 {(M-54)*(M>106)} 0 {(M-53)*(M>106)*inv(nc(53))} {(M-53)*(M>106)*nc(53)} Td={1/f0} Z0=1
Tz201 {(M-55)*(M>108)} 0 {(M-54)*(M>108)*inv(nc(54))} {(M-54)*(M>108)*nc(54)} Td={1/f0} Z0=1
Tz200 {(M-56)*(M>110)} 0 {(M-55)*(M>110)*inv(nc(55))} {(M-55)*(M>110)*nc(55)} Td={1/f0} Z0=1
Tz199 {(M-57)*(M>112)} 0 {(M-56)*(M>112)*inv(nc(56))} {(M-56)*(M>112)*nc(56)} Td={1/f0} Z0=1
Tz198 {(M-58)*(M>114)} 0 {(M-57)*(M>114)*inv(nc(57))} {(M-57)*(M>114)*nc(57)} Td={1/f0} Z0=1
Tz197 {(M-59)*(M>116)} 0 {(M-58)*(M>116)*inv(nc(58))} {(M-58)*(M>116)*nc(58)} Td={1/f0} Z0=1
Tz196 {(M-60)*(M>118)} 0 {(M-59)*(M>118)*inv(nc(59))} {(M-59)*(M>118)*nc(59)} Td={1/f0} Z0=1
Tz195 {(M-61)*(M>120)} 0 {(M-60)*(M>120)*inv(nc(60))} {(M-60)*(M>120)*nc(60)} Td={1/f0} Z0=1
Tz194 {(M-62)*(M>122)} 0 {(M-61)*(M>122)*inv(nc(61))} {(M-61)*(M>122)*nc(61)} Td={1/f0} Z0=1
Tz193 {(M-63)*(M>124)} 0 {(M-62)*(M>124)*inv(nc(62))} {(M-62)*(M>124)*nc(62)} Td={1/f0} Z0=1
Tz192 {(M-64)*(M>126)} 0 {(M-63)*(M>126)*inv(nc(63))} {(M-63)*(M>126)*nc(63)} Td={1/f0} Z0=1
Tz191 {(M-65)*(M>128)} 0 {(M-64)*(M>128)*inv(nc(64))} {(M-64)*(M>128)*nc(64)} Td={1/f0} Z0=1
Tz190 {(M-66)*(M>130)} 0 {(M-65)*(M>130)*inv(nc(65))} {(M-65)*(M>130)*nc(65)} Td={1/f0} Z0=1
Tz189 {(M-67)*(M>132)} 0 {(M-66)*(M>132)*inv(nc(66))} {(M-66)*(M>132)*nc(66)} Td={1/f0} Z0=1
Tz188 {(M-68)*(M>134)} 0 {(M-67)*(M>134)*inv(nc(67))} {(M-67)*(M>134)*nc(67)} Td={1/f0} Z0=1
Tz187 {(M-69)*(M>136)} 0 {(M-68)*(M>136)*inv(nc(68))} {(M-68)*(M>136)*nc(68)} Td={1/f0} Z0=1
Tz186 {(M-70)*(M>138)} 0 {(M-69)*(M>138)*inv(nc(69))} {(M-69)*(M>138)*nc(69)} Td={1/f0} Z0=1
Tz185 {(M-71)*(M>140)} 0 {(M-70)*(M>140)*inv(nc(70))} {(M-70)*(M>140)*nc(70)} Td={1/f0} Z0=1
Tz184 {(M-72)*(M>142)} 0 {(M-71)*(M>142)*inv(nc(71))} {(M-71)*(M>142)*nc(71)} Td={1/f0} Z0=1
Tz183 {(M-73)*(M>144)} 0 {(M-72)*(M>144)*inv(nc(72))} {(M-72)*(M>144)*nc(72)} Td={1/f0} Z0=1
Tz182 {(M-74)*(M>146)} 0 {(M-73)*(M>146)*inv(nc(73))} {(M-73)*(M>146)*nc(73)} Td={1/f0} Z0=1
Tz181 {(M-75)*(M>148)} 0 {(M-74)*(M>148)*inv(nc(74))} {(M-74)*(M>148)*nc(74)} Td={1/f0} Z0=1
Tz180 {(M-76)*(M>150)} 0 {(M-75)*(M>150)*inv(nc(75))} {(M-75)*(M>150)*nc(75)} Td={1/f0} Z0=1
Tz179 {(M-77)*(M>152)} 0 {(M-76)*(M>152)*inv(nc(76))} {(M-76)*(M>152)*nc(76)} Td={1/f0} Z0=1
Tz178 {(M-78)*(M>154)} 0 {(M-77)*(M>154)*inv(nc(77))} {(M-77)*(M>154)*nc(77)} Td={1/f0} Z0=1
Tz177 {(M-79)*(M>156)} 0 {(M-78)*(M>156)*inv(nc(78))} {(M-78)*(M>156)*nc(78)} Td={1/f0} Z0=1
Tz176 {(M-80)*(M>158)} 0 {(M-79)*(M>158)*inv(nc(79))} {(M-79)*(M>158)*nc(79)} Td={1/f0} Z0=1
Tz175 {(M-81)*(M>160)} 0 {(M-80)*(M>160)*inv(nc(80))} {(M-80)*(M>160)*nc(80)} Td={1/f0} Z0=1
Tz174 {(M-82)*(M>162)} 0 {(M-81)*(M>162)*inv(nc(81))} {(M-81)*(M>162)*nc(81)} Td={1/f0} Z0=1
Tz173 {(M-83)*(M>164)} 0 {(M-82)*(M>164)*inv(nc(82))} {(M-82)*(M>164)*nc(82)} Td={1/f0} Z0=1
Tz172 {(M-84)*(M>166)} 0 {(M-83)*(M>166)*inv(nc(83))} {(M-83)*(M>166)*nc(83)} Td={1/f0} Z0=1
Tz171 {(M-85)*(M>168)} 0 {(M-84)*(M>168)*inv(nc(84))} {(M-84)*(M>168)*nc(84)} Td={1/f0} Z0=1
Tz170 {(M-86)*(M>170)} 0 {(M-85)*(M>170)*inv(nc(85))} {(M-85)*(M>170)*nc(85)} Td={1/f0} Z0=1
Tz169 {(M-87)*(M>172)} 0 {(M-86)*(M>172)*inv(nc(86))} {(M-86)*(M>172)*nc(86)} Td={1/f0} Z0=1
Tz168 {(M-88)*(M>174)} 0 {(M-87)*(M>174)*inv(nc(87))} {(M-87)*(M>174)*nc(87)} Td={1/f0} Z0=1
Tz167 {(M-89)*(M>176)} 0 {(M-88)*(M>176)*inv(nc(88))} {(M-88)*(M>176)*nc(88)} Td={1/f0} Z0=1
Tz166 {(M-90)*(M>178)} 0 {(M-89)*(M>178)*inv(nc(89))} {(M-89)*(M>178)*nc(89)} Td={1/f0} Z0=1
Tz165 {(M-91)*(M>180)} 0 {(M-90)*(M>180)*inv(nc(90))} {(M-90)*(M>180)*nc(90)} Td={1/f0} Z0=1
Tz164 {(M-92)*(M>182)} 0 {(M-91)*(M>182)*inv(nc(91))} {(M-91)*(M>182)*nc(91)} Td={1/f0} Z0=1
Tz163 {(M-93)*(M>184)} 0 {(M-92)*(M>184)*inv(nc(92))} {(M-92)*(M>184)*nc(92)} Td={1/f0} Z0=1
Tz162 {(M-94)*(M>186)} 0 {(M-93)*(M>186)*inv(nc(93))} {(M-93)*(M>186)*nc(93)} Td={1/f0} Z0=1
Tz161 {(M-95)*(M>188)} 0 {(M-94)*(M>188)*inv(nc(94))} {(M-94)*(M>188)*nc(94)} Td={1/f0} Z0=1
Tz160 {(M-96)*(M>190)} 0 {(M-95)*(M>190)*inv(nc(95))} {(M-95)*(M>190)*nc(95)} Td={1/f0} Z0=1
Tz159 {(M-97)*(M>192)} 0 {(M-96)*(M>192)*inv(nc(96))} {(M-96)*(M>192)*nc(96)} Td={1/f0} Z0=1
Tz158 {(M-98)*(M>194)} 0 {(M-97)*(M>194)*inv(nc(97))} {(M-97)*(M>194)*nc(97)} Td={1/f0} Z0=1
Tz157 {(M-99)*(M>196)} 0 {(M-98)*(M>196)*inv(nc(98))} {(M-98)*(M>196)*nc(98)} Td={1/f0} Z0=1
Tz156 {(M-100)*(M>198)} 0 {(M-99)*(M>198)*inv(nc(99))} {(M-99)*(M>198)*nc(99)} Td={1/f0} Z0=1
Tz155 {(M-101)*(M>200)} 0 {(M-100)*(M>200)*inv(nc(100))} {(M-100)*(M>200)*nc(100)} Td={1/f0} Z0=1
Tz154 {(M-102)*(M>202)} 0 {(M-101)*(M>202)*inv(nc(101))} {(M-101)*(M>202)*nc(101)} Td={1/f0} Z0=1
Tz153 {(M-103)*(M>204)} 0 {(M-102)*(M>204)*inv(nc(102))} {(M-102)*(M>204)*nc(102)} Td={1/f0} Z0=1
Tz152 {(M-104)*(M>206)} 0 {(M-103)*(M>206)*inv(nc(103))} {(M-103)*(M>206)*nc(103)} Td={1/f0} Z0=1
Tz151 {(M-105)*(M>208)} 0 {(M-104)*(M>208)*inv(nc(104))} {(M-104)*(M>208)*nc(104)} Td={1/f0} Z0=1
Tz150 {(M-106)*(M>210)} 0 {(M-105)*(M>210)*inv(nc(105))} {(M-105)*(M>210)*nc(105)} Td={1/f0} Z0=1
Tz149 {(M-107)*(M>212)} 0 {(M-106)*(M>212)*inv(nc(106))} {(M-106)*(M>212)*nc(106)} Td={1/f0} Z0=1
Tz148 {(M-108)*(M>214)} 0 {(M-107)*(M>214)*inv(nc(107))} {(M-107)*(M>214)*nc(107)} Td={1/f0} Z0=1
Tz147 {(M-109)*(M>216)} 0 {(M-108)*(M>216)*inv(nc(108))} {(M-108)*(M>216)*nc(108)} Td={1/f0} Z0=1
Tz146 {(M-110)*(M>218)} 0 {(M-109)*(M>218)*inv(nc(109))} {(M-109)*(M>218)*nc(109)} Td={1/f0} Z0=1
Tz145 {(M-111)*(M>220)} 0 {(M-110)*(M>220)*inv(nc(110))} {(M-110)*(M>220)*nc(110)} Td={1/f0} Z0=1
Tz144 {(M-112)*(M>222)} 0 {(M-111)*(M>222)*inv(nc(111))} {(M-111)*(M>222)*nc(111)} Td={1/f0} Z0=1
Tz143 {(M-113)*(M>224)} 0 {(M-112)*(M>224)*inv(nc(112))} {(M-112)*(M>224)*nc(112)} Td={1/f0} Z0=1
Tz142 {(M-114)*(M>226)} 0 {(M-113)*(M>226)*inv(nc(113))} {(M-113)*(M>226)*nc(113)} Td={1/f0} Z0=1
Tz141 {(M-115)*(M>228)} 0 {(M-114)*(M>228)*inv(nc(114))} {(M-114)*(M>228)*nc(114)} Td={1/f0} Z0=1
Tz140 {(M-116)*(M>230)} 0 {(M-115)*(M>230)*inv(nc(115))} {(M-115)*(M>230)*nc(115)} Td={1/f0} Z0=1
Tz139 {(M-117)*(M>232)} 0 {(M-116)*(M>232)*inv(nc(116))} {(M-116)*(M>232)*nc(116)} Td={1/f0} Z0=1
Tz138 {(M-118)*(M>234)} 0 {(M-117)*(M>234)*inv(nc(117))} {(M-117)*(M>234)*nc(117)} Td={1/f0} Z0=1
Tz137 {(M-119)*(M>236)} 0 {(M-118)*(M>236)*inv(nc(118))} {(M-118)*(M>236)*nc(118)} Td={1/f0} Z0=1
Tz136 {(M-120)*(M>238)} 0 {(M-119)*(M>238)*inv(nc(119))} {(M-119)*(M>238)*nc(119)} Td={1/f0} Z0=1
Tz135 {(M-121)*(M>240)} 0 {(M-120)*(M>240)*inv(nc(120))} {(M-120)*(M>240)*nc(120)} Td={1/f0} Z0=1
Tz134 {(M-122)*(M>242)} 0 {(M-121)*(M>242)*inv(nc(121))} {(M-121)*(M>242)*nc(121)} Td={1/f0} Z0=1
Tz133 {(M-123)*(M>244)} 0 {(M-122)*(M>244)*inv(nc(122))} {(M-122)*(M>244)*nc(122)} Td={1/f0} Z0=1
Tz132 {(M-124)*(M>246)} 0 {(M-123)*(M>246)*inv(nc(123))} {(M-123)*(M>246)*nc(123)} Td={1/f0} Z0=1
Tz131 {(M-125)*(M>248)} 0 {(M-124)*(M>248)*inv(nc(124))} {(M-124)*(M>248)*nc(124)} Td={1/f0} Z0=1
Tz130 {(M-126)*(M>250)} 0 {(M-125)*(M>250)*inv(nc(125))} {(M-125)*(M>250)*nc(125)} Td={1/f0} Z0=1
Tz129 {(M-127)*(M>252)} 0 {(M-126)*(M>252)*inv(nc(126))} {(M-126)*(M>252)*nc(126)} Td={1/f0} Z0=1
Tz128 {(M-128)*(M>254)} 0 {(M-127)*(M>254)*inv(nc(127))} {(M-127)*(M>254)*nc(127)} Td={1/f0} Z0=1
Gz0 0 out 667 {M} {h(0)}
Gz1 0 out {1*(M>1)} {(M-1)*(M>2)} {h(1)}
Gz2 0 out {2*(M>3)} {(M-2)*(M>4)} {h(2)}
Gz3 0 out {3*(M>5)} {(M-3)*(M>6)} {h(3)}
Gz4 0 out {4*(M>7)} {(M-4)*(M>8)} {h(4)}
Gz5 0 out {5*(M>9)} {(M-5)*(M>10)} {h(5)}
Gz6 0 out {6*(M>11)} {(M-6)*(M>12)} {h(6)}
Gz7 0 out {7*(M>13)} {(M-7)*(M>14)} {h(7)}
Gz8 0 out {8*(M>15)} {(M-8)*(M>16)} {h(8)}
Gz9 0 out {9*(M>17)} {(M-9)*(M>18)} {h(9)}
Gz10 0 out {10*(M>19)} {(M-10)*(M>20)} {h(10)}
Gz11 0 out {11*(M>21)} {(M-11)*(M>22)} {h(11)}
Gz12 0 out {12*(M>23)} {(M-12)*(M>24)} {h(12)}
Gz13 0 out {13*(M>25)} {(M-13)*(M>26)} {h(13)}
Gz14 0 out {14*(M>27)} {(M-14)*(M>28)} {h(14)}
Gz15 0 out {15*(M>29)} {(M-15)*(M>30)} {h(15)}
Gz16 0 out {16*(M>31)} {(M-16)*(M>32)} {h(16)}
Gz17 0 out {17*(M>33)} {(M-17)*(M>34)} {h(17)}
Gz18 0 out {18*(M>35)} {(M-18)*(M>36)} {h(18)}
Gz19 0 out {19*(M>37)} {(M-19)*(M>38)} {h(19)}
Gz20 0 out {20*(M>39)} {(M-20)*(M>40)} {h(20)}
Gz21 0 out {21*(M>41)} {(M-21)*(M>42)} {h(21)}
Gz22 0 out {22*(M>43)} {(M-22)*(M>44)} {h(22)}
Gz23 0 out {23*(M>45)} {(M-23)*(M>46)} {h(23)}
Gz24 0 out {24*(M>47)} {(M-24)*(M>48)} {h(24)}
Gz25 0 out {25*(M>49)} {(M-25)*(M>50)} {h(25)}
Gz26 0 out {26*(M>51)} {(M-26)*(M>52)} {h(26)}
Gz27 0 out {27*(M>53)} {(M-27)*(M>54)} {h(27)}
Gz28 0 out {28*(M>55)} {(M-28)*(M>56)} {h(28)}
Gz29 0 out {29*(M>57)} {(M-29)*(M>58)} {h(29)}
Gz30 0 out {30*(M>59)} {(M-30)*(M>60)} {h(30)}
Gz31 0 out {31*(M>61)} {(M-31)*(M>62)} {h(31)}
Gz32 0 out {32*(M>63)} {(M-32)*(M>64)} {h(32)}
Gz33 0 out {33*(M>65)} {(M-33)*(M>66)} {h(33)}
Gz34 0 out {34*(M>67)} {(M-34)*(M>68)} {h(34)}
Gz35 0 out {35*(M>69)} {(M-35)*(M>70)} {h(35)}
Gz36 0 out {36*(M>71)} {(M-36)*(M>72)} {h(36)}
Gz37 0 out {37*(M>73)} {(M-37)*(M>74)} {h(37)}
Gz38 0 out {38*(M>75)} {(M-38)*(M>76)} {h(38)}
Gz39 0 out {39*(M>77)} {(M-39)*(M>78)} {h(39)}
Gz40 0 out {40*(M>79)} {(M-40)*(M>80)} {h(40)}
Gz41 0 out {41*(M>81)} {(M-41)*(M>82)} {h(41)}
Gz42 0 out {42*(M>83)} {(M-42)*(M>84)} {h(42)}
Gz43 0 out {43*(M>85)} {(M-43)*(M>86)} {h(43)}
Gz44 0 out {44*(M>87)} {(M-44)*(M>88)} {h(44)}
Gz45 0 out {45*(M>89)} {(M-45)*(M>90)} {h(45)}
Gz46 0 out {46*(M>91)} {(M-46)*(M>92)} {h(46)}
Gz47 0 out {47*(M>93)} {(M-47)*(M>94)} {h(47)}
Gz48 0 out {48*(M>95)} {(M-48)*(M>96)} {h(48)}
Gz49 0 out {49*(M>97)} {(M-49)*(M>98)} {h(49)}
Gz50 0 out {50*(M>99)} {(M-50)*(M>100)} {h(50)}
Gz51 0 out {51*(M>101)} {(M-51)*(M>102)} {h(51)}
Gz52 0 out {52*(M>103)} {(M-52)*(M>104)} {h(52)}
Gz53 0 out {53*(M>105)} {(M-53)*(M>106)} {h(53)}
Gz54 0 out {54*(M>107)} {(M-54)*(M>108)} {h(54)}
Gz55 0 out {55*(M>109)} {(M-55)*(M>110)} {h(55)}
Gz56 0 out {56*(M>111)} {(M-56)*(M>112)} {h(56)}
Gz57 0 out {57*(M>113)} {(M-57)*(M>114)} {h(57)}
Gz58 0 out {58*(M>115)} {(M-58)*(M>116)} {h(58)}
Gz59 0 out {59*(M>117)} {(M-59)*(M>118)} {h(59)}
Gz60 0 out {60*(M>119)} {(M-60)*(M>120)} {h(60)}
Gz61 0 out {61*(M>121)} {(M-61)*(M>122)} {h(61)}
Gz62 0 out {62*(M>123)} {(M-62)*(M>124)} {h(62)}
Gz63 0 out {63*(M>125)} {(M-63)*(M>126)} {h(63)}
Gz64 0 out {64*(M>127)} {(M-64)*(M>128)} {h(64)}
Gz65 0 out {65*(M>129)} {(M-65)*(M>130)} {h(65)}
Gz66 0 out {66*(M>131)} {(M-66)*(M>132)} {h(66)}
Gz67 0 out {67*(M>133)} {(M-67)*(M>134)} {h(67)}
Gz68 0 out {68*(M>135)} {(M-68)*(M>136)} {h(68)}
Gz69 0 out {69*(M>137)} {(M-69)*(M>138)} {h(69)}
Gz70 0 out {70*(M>139)} {(M-70)*(M>140)} {h(70)}
Gz71 0 out {71*(M>141)} {(M-71)*(M>142)} {h(71)}
Gz72 0 out {72*(M>143)} {(M-72)*(M>144)} {h(72)}
Gz73 0 out {73*(M>145)} {(M-73)*(M>146)} {h(73)}
Gz74 0 out {74*(M>147)} {(M-74)*(M>148)} {h(74)}
Gz75 0 out {75*(M>149)} {(M-75)*(M>150)} {h(75)}
Gz76 0 out {76*(M>151)} {(M-76)*(M>152)} {h(76)}
Gz77 0 out {77*(M>153)} {(M-77)*(M>154)} {h(77)}
Gz78 0 out {78*(M>155)} {(M-78)*(M>156)} {h(78)}
Gz79 0 out {79*(M>157)} {(M-79)*(M>158)} {h(79)}
Gz80 0 out {80*(M>159)} {(M-80)*(M>160)} {h(80)}
Gz81 0 out {81*(M>161)} {(M-81)*(M>162)} {h(81)}
Gz82 0 out {82*(M>163)} {(M-82)*(M>164)} {h(82)}
Gz83 0 out {83*(M>165)} {(M-83)*(M>166)} {h(83)}
Gz84 0 out {84*(M>167)} {(M-84)*(M>168)} {h(84)}
Gz85 0 out {85*(M>169)} {(M-85)*(M>170)} {h(85)}
Gz86 0 out {86*(M>171)} {(M-86)*(M>172)} {h(86)}
Gz87 0 out {87*(M>173)} {(M-87)*(M>174)} {h(87)}
Gz88 0 out {88*(M>175)} {(M-88)*(M>176)} {h(88)}
Gz89 0 out {89*(M>177)} {(M-89)*(M>178)} {h(89)}
Gz90 0 out {90*(M>179)} {(M-90)*(M>180)} {h(90)}
Gz91 0 out {91*(M>181)} {(M-91)*(M>182)} {h(91)}
Gz92 0 out {92*(M>183)} {(M-92)*(M>184)} {h(92)}
Gz93 0 out {93*(M>185)} {(M-93)*(M>186)} {h(93)}
Gz94 0 out {94*(M>187)} {(M-94)*(M>188)} {h(94)}
Gz95 0 out {95*(M>189)} {(M-95)*(M>190)} {h(95)}
Gz96 0 out {96*(M>191)} {(M-96)*(M>192)} {h(96)}
Gz97 0 out {97*(M>193)} {(M-97)*(M>194)} {h(97)}
Gz98 0 out {98*(M>195)} {(M-98)*(M>196)} {h(98)}
Gz99 0 out {99*(M>197)} {(M-99)*(M>198)} {h(99)}
Gz100 0 out {100*(M>199)} {(M-100)*(M>200)} {h(100)}
Gz101 0 out {101*(M>201)} {(M-101)*(M>202)} {h(101)}
Gz102 0 out {102*(M>203)} {(M-102)*(M>204)} {h(102)}
Gz103 0 out {103*(M>205)} {(M-103)*(M>206)} {h(103)}
Gz104 0 out {104*(M>207)} {(M-104)*(M>208)} {h(104)}
Gz105 0 out {105*(M>209)} {(M-105)*(M>210)} {h(105)}
Gz106 0 out {106*(M>211)} {(M-106)*(M>212)} {h(106)}
Gz107 0 out {107*(M>213)} {(M-107)*(M>214)} {h(107)}
Gz108 0 out {108*(M>215)} {(M-108)*(M>216)} {h(108)}
Gz109 0 out {109*(M>217)} {(M-109)*(M>218)} {h(109)}
Gz110 0 out {110*(M>219)} {(M-110)*(M>220)} {h(110)}
Gz111 0 out {111*(M>221)} {(M-111)*(M>222)} {h(111)}
Gz112 0 out {112*(M>223)} {(M-112)*(M>224)} {h(112)}
Gz113 0 out {113*(M>225)} {(M-113)*(M>226)} {h(113)}
Gz114 0 out {114*(M>227)} {(M-114)*(M>228)} {h(114)}
Gz115 0 out {115*(M>229)} {(M-115)*(M>230)} {h(115)}
Gz116 0 out {116*(M>231)} {(M-116)*(M>232)} {h(116)}
Gz117 0 out {117*(M>233)} {(M-117)*(M>234)} {h(117)}
Gz118 0 out {118*(M>235)} {(M-118)*(M>236)} {h(118)}
Gz119 0 out {119*(M>237)} {(M-119)*(M>238)} {h(119)}
Gz120 0 out {120*(M>239)} {(M-120)*(M>240)} {h(120)}
Gz121 0 out {121*(M>241)} {(M-121)*(M>242)} {h(121)}
Gz122 0 out {122*(M>243)} {(M-122)*(M>244)} {h(122)}
Gz123 0 out {123*(M>245)} {(M-123)*(M>246)} {h(123)}
Gz124 0 out {124*(M>247)} {(M-124)*(M>248)} {h(124)}
Gz125 0 out {125*(M>249)} {(M-125)*(M>250)} {h(125)}
Gz126 0 out {126*(M>251)} {(M-126)*(M>252)} {h(126)}
Gz127 0 out {127*(M>253)} {(M-127)*(M>254)} {h(127)}
;.param Gain=table( Choice, 1, (case==1)*2*Sum-h(M/2)*par(M), 2, SPS, 3, SPS, 4, SPS,
;+ 5, 2*pi*fp1/f0, 6, 1 )
.param Gain=if( Choice<5 & case==1, 2*Sum-h(M/2)*par(M), if( Choice==5, 2*pi*fp1/f0, 1 ))
.func nc(x)=(M-x==(M-par(M+1))/2+1)&Type<3
.param Sum=h(0)+h(1)+h(2)+h(3)+h(4)+h(5)+h(6)+h(7)+h(8)+h(9)+
+ h(10)+h(11)+h(12)+h(13)+h(14)+h(15)+h(16)+h(17)+h(18)+h(19)+
+ h(20)+h(21)+h(22)+h(23)+h(24)+h(25)+h(26)+h(27)+h(28)+h(29)+
+ h(30)+h(31)+h(32)+h(33)+h(34)+h(35)+h(36)+h(37)+h(38)+h(39)+
+ h(40)+h(41)+h(42)+h(43)+h(44)+h(45)+h(46)+h(47)+h(48)+h(49)+
+ h(50)+h(51)+h(52)+h(53)+h(54)+h(55)+h(56)+h(57)+h(58)+h(59)+
+ h(60)+h(61)+h(62)+h(63)+h(64)+h(65)+h(66)+h(67)+h(68)+h(69)+
+ h(70)+h(71)+h(72)+h(73)+h(74)+h(75)+h(76)+h(77)+h(78)+h(79)+
+ h(80)+h(81)+h(82)+h(83)+h(84)+h(85)+h(86)+h(87)+h(88)+h(89)+
+ h(90)+h(91)+h(92)+h(93)+h(94)+h(95)+h(96)+h(97)+h(98)+h(99)+
+ h(100)+h(101)+h(102)+h(103)+h(104)+h(105)+h(106)+h(107)+h(108)+h(109)+
+ h(110)+h(111)+h(112)+h(113)+h(114)+h(115)+h(116)+h(117)+h(118)+h(119)+
+ h(120)+h(121)+h(122)+h(123)+h(124)+h(125)+h(126)+h(127)+h(128)
Rout 0 out {1/Gain}
VM 0.1 0 {M} AC {10**(M/20)} {M}
Bw {0.2*test} 0 v=if(quant,w(round(time/sim*M)),w(time/sim*M))*v(0.4)**quant
Bcoef {0.3*test} 0 v=limit(-10,10, if(quant,w(round(time/sim*M))*term(round(time/sim*M)),
+ w(time/sim*M)*term(time/sim*M) ))*v(0.4)**quant
Iclk 0 {0.4*quant} pulse(1 0 {0.05*sim/M} 0 0 {0.9*sim/M*test} {sim/M*test})
Cclk 0 0.4 {Cpar} Rpar=1
.ends FIR
********************************************************************************
********************************************************************************
*
*			-- MOVING AVERAGE FILTERS --
*
********************************************************************************
********************************************************************************
*
* [GENERAL]
*
*  Moving Average Filters with fixed and variable period.
*
*
* [SYMBOL]
*
*  0.1	= used by MAFv for the external frequency;
*  0.2	= not used;
*  0.3	= only used by MAF and outputs the sampling clock; just like in the IIR
* case, it's useless, therefore safe to ignore.
*
*
* [PARAMETERS]
*
* N=<1:128>	= the number of samples (MAF only);
* f0	[Hz]	= reciprocal of the period for MAFv or the sampling frequency
*		for MAF;
* quant=<0,1>	= disables/enables a real sample & hold output at the cost of a
*		slower simulation, MAF only (optional).
*
* - Hidden:
*
* Rpar	[Ohm]	= dummy parallel resistor across the output capacitor, defaults
*		to 1G (opt.);
* Cpar	[F]	= capacitance across the clock source, default 10p, MAF only
*		(opt.);
* tr	[s]	= the sampling clock's rising/falling time, it needs quant=1;
*		together with "Cpar" affect the output's erratic spikes, default
*		1us; MAF only (opt.);
* td	[s]	= LTspice's A-device parameter, for the S&H, default 10n, MAF
*		only (opt.).
*	("Cpar", "tr" and "td" have the same explanation as in IIR's notes)
*
*
* [CHARACTERISTICS]
*
* - Input and output impedances are:
*
* MAF  : Ri = 1G (if quant=1)
*	 Zo = f0/jw (capacitive, if quant=1)
* MAFv : Ro = frequency
*
* - MAF has a split personality: if quant=0, its response will be given by a G,
* a C and a tline, it's the most stable and fast. If quant=1, it will actually
* use a S&H and tlines which will give a quantized output at the cost of speed.
* - MAFv first integrates v(in), then subtracts the variable-delayed response
* and then multiplies it by the variable-frequency, thus having the possibility
* of controlling the averaging period externally at pin '0.1'.
*
*
* [NOTES]
*
* - quant=1 will not disable the possibility of .AC analysis but there may be
* some distortions due to the redirecting through the S&H. It will also have the
* same effect as for IIR and FIR: output starts from zero no matter the input.
* - In general, quant=0 means a continuous-time approach, but the responses are
* the same for all, given identical conditions, so if time is precious, use it.
* All can be viewed in .AC.
*
********************************
*
*	MAF, CT or z^-1
*
********************************
*
* Parameters: N, f0, quant (, Rpar, Cpar, tr, td)
* Supports: LP
* Pins used: IN, OUT (, 0.3)
*
* Notes:
* - If the 1G Ohm input or the f0/jw output are not wanted (when quant=0), then
* buffers may be needed.
* - If speed is a concern, use quant=0, it's the same thing only in continuous
* time.
*
********************************
.subckt MAF in out 0.1 0.2 0.3
.param f0=12800  N=128  quant=0 Rpar=1G Cpar=10p tr=.1/f0 td=10m*tr
Rin in 666 1G
Rsh in 999 1
Ash {quant*999} 0 {quant*0.3} 0 0 0 {quant*666} 0 SAMPLEHOLD td={td}
Iclk 0 {quant*.3} pulse 0 1 0 {tr} {tr} {.5/f0} {1/f0}
Cclk 0 0.3 {Cpar} Rpar=1
T1   667 0 1  0 Td={N**inv(quant)/f0} Z0=1
T2 {(2<=N)*1*quant} 0 {(2<=N)*2*quant} 0 Td={1/f0} Z0=1
T3 {(3<=N)*2*quant} 0 {(3<=N)*3*quant} 0 Td={1/f0} Z0=1
T4 {(4<=N)*3*quant} 0 {(4<=N)*4*quant} 0 Td={1/f0} Z0=1
T5 {(5<=N)*4*quant} 0 {(5<=N)*5*quant} 0 Td={1/f0} Z0=1
T6 {(6<=N)*5*quant} 0 {(6<=N)*6*quant} 0 Td={1/f0} Z0=1
T7 {(7<=N)*6*quant} 0 {(7<=N)*7*quant} 0 Td={1/f0} Z0=1
T8 {(8<=N)*7*quant} 0 {(8<=N)*8*quant} 0 Td={1/f0} Z0=1
T9 {(9<=N)*8*quant} 0 {(9<=N)*9*quant} 0 Td={1/f0} Z0=1
T10 {(10<=N)*9*quant} 0 {(10<=N)*10*quant} 0 Td={1/f0} Z0=1
T11 {(11<=N)*10*quant} 0 {(11<=N)*11*quant} 0 Td={1/f0} Z0=1
T12 {(12<=N)*11*quant} 0 {(12<=N)*12*quant} 0 Td={1/f0} Z0=1
T13 {(13<=N)*12*quant} 0 {(13<=N)*13*quant} 0 Td={1/f0} Z0=1
T14 {(14<=N)*13*quant} 0 {(14<=N)*14*quant} 0 Td={1/f0} Z0=1
T15 {(15<=N)*14*quant} 0 {(15<=N)*15*quant} 0 Td={1/f0} Z0=1
T16 {(16<=N)*15*quant} 0 {(16<=N)*16*quant} 0 Td={1/f0} Z0=1
T17 {(17<=N)*16*quant} 0 {(17<=N)*17*quant} 0 Td={1/f0} Z0=1
T18 {(18<=N)*17*quant} 0 {(18<=N)*18*quant} 0 Td={1/f0} Z0=1
T19 {(19<=N)*18*quant} 0 {(19<=N)*19*quant} 0 Td={1/f0} Z0=1
T20 {(20<=N)*19*quant} 0 {(20<=N)*20*quant} 0 Td={1/f0} Z0=1
T21 {(21<=N)*20*quant} 0 {(21<=N)*21*quant} 0 Td={1/f0} Z0=1
T22 {(22<=N)*21*quant} 0 {(22<=N)*22*quant} 0 Td={1/f0} Z0=1
T23 {(23<=N)*22*quant} 0 {(23<=N)*23*quant} 0 Td={1/f0} Z0=1
T24 {(24<=N)*23*quant} 0 {(24<=N)*24*quant} 0 Td={1/f0} Z0=1
T25 {(25<=N)*24*quant} 0 {(25<=N)*25*quant} 0 Td={1/f0} Z0=1
T26 {(26<=N)*25*quant} 0 {(26<=N)*26*quant} 0 Td={1/f0} Z0=1
T27 {(27<=N)*26*quant} 0 {(27<=N)*27*quant} 0 Td={1/f0} Z0=1
T28 {(28<=N)*27*quant} 0 {(28<=N)*28*quant} 0 Td={1/f0} Z0=1
T29 {(29<=N)*28*quant} 0 {(29<=N)*29*quant} 0 Td={1/f0} Z0=1
T30 {(30<=N)*29*quant} 0 {(30<=N)*30*quant} 0 Td={1/f0} Z0=1
T31 {(31<=N)*30*quant} 0 {(31<=N)*31*quant} 0 Td={1/f0} Z0=1
T32 {(32<=N)*31*quant} 0 {(32<=N)*32*quant} 0 Td={1/f0} Z0=1
T33 {(33<=N)*32*quant} 0 {(33<=N)*33*quant} 0 Td={1/f0} Z0=1
T34 {(34<=N)*33*quant} 0 {(34<=N)*34*quant} 0 Td={1/f0} Z0=1
T35 {(35<=N)*34*quant} 0 {(35<=N)*35*quant} 0 Td={1/f0} Z0=1
T36 {(36<=N)*35*quant} 0 {(36<=N)*36*quant} 0 Td={1/f0} Z0=1
T37 {(37<=N)*36*quant} 0 {(37<=N)*37*quant} 0 Td={1/f0} Z0=1
T38 {(38<=N)*37*quant} 0 {(38<=N)*38*quant} 0 Td={1/f0} Z0=1
T39 {(39<=N)*38*quant} 0 {(39<=N)*39*quant} 0 Td={1/f0} Z0=1
T40 {(40<=N)*39*quant} 0 {(40<=N)*40*quant} 0 Td={1/f0} Z0=1
T41 {(41<=N)*40*quant} 0 {(41<=N)*41*quant} 0 Td={1/f0} Z0=1
T42 {(42<=N)*41*quant} 0 {(42<=N)*42*quant} 0 Td={1/f0} Z0=1
T43 {(43<=N)*42*quant} 0 {(43<=N)*43*quant} 0 Td={1/f0} Z0=1
T44 {(44<=N)*43*quant} 0 {(44<=N)*44*quant} 0 Td={1/f0} Z0=1
T45 {(45<=N)*44*quant} 0 {(45<=N)*45*quant} 0 Td={1/f0} Z0=1
T46 {(46<=N)*45*quant} 0 {(46<=N)*46*quant} 0 Td={1/f0} Z0=1
T47 {(47<=N)*46*quant} 0 {(47<=N)*47*quant} 0 Td={1/f0} Z0=1
T48 {(48<=N)*47*quant} 0 {(48<=N)*48*quant} 0 Td={1/f0} Z0=1
T49 {(49<=N)*48*quant} 0 {(49<=N)*49*quant} 0 Td={1/f0} Z0=1
T50 {(50<=N)*49*quant} 0 {(50<=N)*50*quant} 0 Td={1/f0} Z0=1
T51 {(51<=N)*50*quant} 0 {(51<=N)*51*quant} 0 Td={1/f0} Z0=1
T52 {(52<=N)*51*quant} 0 {(52<=N)*52*quant} 0 Td={1/f0} Z0=1
T53 {(53<=N)*52*quant} 0 {(53<=N)*53*quant} 0 Td={1/f0} Z0=1
T54 {(54<=N)*53*quant} 0 {(54<=N)*54*quant} 0 Td={1/f0} Z0=1
T55 {(55<=N)*54*quant} 0 {(55<=N)*55*quant} 0 Td={1/f0} Z0=1
T56 {(56<=N)*55*quant} 0 {(56<=N)*56*quant} 0 Td={1/f0} Z0=1
T57 {(57<=N)*56*quant} 0 {(57<=N)*57*quant} 0 Td={1/f0} Z0=1
T58 {(58<=N)*57*quant} 0 {(58<=N)*58*quant} 0 Td={1/f0} Z0=1
T59 {(59<=N)*58*quant} 0 {(59<=N)*59*quant} 0 Td={1/f0} Z0=1
T60 {(60<=N)*59*quant} 0 {(60<=N)*60*quant} 0 Td={1/f0} Z0=1
T61 {(61<=N)*60*quant} 0 {(61<=N)*61*quant} 0 Td={1/f0} Z0=1
T62 {(62<=N)*61*quant} 0 {(62<=N)*62*quant} 0 Td={1/f0} Z0=1
T63 {(63<=N)*62*quant} 0 {(63<=N)*63*quant} 0 Td={1/f0} Z0=1
T64 {(64<=N)*63*quant} 0 {(64<=N)*64*quant} 0 Td={1/f0} Z0=1
T65 {(65<=N)*64*quant} 0 {(65<=N)*65*quant} 0 Td={1/f0} Z0=1
T66 {(66<=N)*65*quant} 0 {(66<=N)*66*quant} 0 Td={1/f0} Z0=1
T67 {(67<=N)*66*quant} 0 {(67<=N)*67*quant} 0 Td={1/f0} Z0=1
T68 {(68<=N)*67*quant} 0 {(68<=N)*68*quant} 0 Td={1/f0} Z0=1
T69 {(69<=N)*68*quant} 0 {(69<=N)*69*quant} 0 Td={1/f0} Z0=1
T70 {(70<=N)*69*quant} 0 {(70<=N)*70*quant} 0 Td={1/f0} Z0=1
T71 {(71<=N)*70*quant} 0 {(71<=N)*71*quant} 0 Td={1/f0} Z0=1
T72 {(72<=N)*71*quant} 0 {(72<=N)*72*quant} 0 Td={1/f0} Z0=1
T73 {(73<=N)*72*quant} 0 {(73<=N)*73*quant} 0 Td={1/f0} Z0=1
T74 {(74<=N)*73*quant} 0 {(74<=N)*74*quant} 0 Td={1/f0} Z0=1
T75 {(75<=N)*74*quant} 0 {(75<=N)*75*quant} 0 Td={1/f0} Z0=1
T76 {(76<=N)*75*quant} 0 {(76<=N)*76*quant} 0 Td={1/f0} Z0=1
T77 {(77<=N)*76*quant} 0 {(77<=N)*77*quant} 0 Td={1/f0} Z0=1
T78 {(78<=N)*77*quant} 0 {(78<=N)*78*quant} 0 Td={1/f0} Z0=1
T79 {(79<=N)*78*quant} 0 {(79<=N)*79*quant} 0 Td={1/f0} Z0=1
T80 {(80<=N)*79*quant} 0 {(80<=N)*80*quant} 0 Td={1/f0} Z0=1
T81 {(81<=N)*80*quant} 0 {(81<=N)*81*quant} 0 Td={1/f0} Z0=1
T82 {(82<=N)*81*quant} 0 {(82<=N)*82*quant} 0 Td={1/f0} Z0=1
T83 {(83<=N)*82*quant} 0 {(83<=N)*83*quant} 0 Td={1/f0} Z0=1
T84 {(84<=N)*83*quant} 0 {(84<=N)*84*quant} 0 Td={1/f0} Z0=1
T85 {(85<=N)*84*quant} 0 {(85<=N)*85*quant} 0 Td={1/f0} Z0=1
T86 {(86<=N)*85*quant} 0 {(86<=N)*86*quant} 0 Td={1/f0} Z0=1
T87 {(87<=N)*86*quant} 0 {(87<=N)*87*quant} 0 Td={1/f0} Z0=1
T88 {(88<=N)*87*quant} 0 {(88<=N)*88*quant} 0 Td={1/f0} Z0=1
T89 {(89<=N)*88*quant} 0 {(89<=N)*89*quant} 0 Td={1/f0} Z0=1
T90 {(90<=N)*89*quant} 0 {(90<=N)*90*quant} 0 Td={1/f0} Z0=1
T91 {(91<=N)*90*quant} 0 {(91<=N)*91*quant} 0 Td={1/f0} Z0=1
T92 {(92<=N)*91*quant} 0 {(92<=N)*92*quant} 0 Td={1/f0} Z0=1
T93 {(93<=N)*92*quant} 0 {(93<=N)*93*quant} 0 Td={1/f0} Z0=1
T94 {(94<=N)*93*quant} 0 {(94<=N)*94*quant} 0 Td={1/f0} Z0=1
T95 {(95<=N)*94*quant} 0 {(95<=N)*95*quant} 0 Td={1/f0} Z0=1
T96 {(96<=N)*95*quant} 0 {(96<=N)*96*quant} 0 Td={1/f0} Z0=1
T97 {(97<=N)*96*quant} 0 {(97<=N)*97*quant} 0 Td={1/f0} Z0=1
T98 {(98<=N)*97*quant} 0 {(98<=N)*98*quant} 0 Td={1/f0} Z0=1
T99 {(99<=N)*98*quant} 0 {(99<=N)*99*quant} 0 Td={1/f0} Z0=1
T100 {(100<=N)*99*quant} 0 {(100<=N)*100*quant} 0 Td={1/f0} Z0=1
T101 {(101<=N)*100*quant} 0 {(101<=N)*101*quant} 0 Td={1/f0} Z0=1
T102 {(102<=N)*101*quant} 0 {(102<=N)*102*quant} 0 Td={1/f0} Z0=1
T103 {(103<=N)*102*quant} 0 {(103<=N)*103*quant} 0 Td={1/f0} Z0=1
T104 {(104<=N)*103*quant} 0 {(104<=N)*104*quant} 0 Td={1/f0} Z0=1
T105 {(105<=N)*104*quant} 0 {(105<=N)*105*quant} 0 Td={1/f0} Z0=1
T106 {(106<=N)*105*quant} 0 {(106<=N)*106*quant} 0 Td={1/f0} Z0=1
T107 {(107<=N)*106*quant} 0 {(107<=N)*107*quant} 0 Td={1/f0} Z0=1
T108 {(108<=N)*107*quant} 0 {(108<=N)*108*quant} 0 Td={1/f0} Z0=1
T109 {(109<=N)*108*quant} 0 {(109<=N)*109*quant} 0 Td={1/f0} Z0=1
T110 {(110<=N)*109*quant} 0 {(110<=N)*110*quant} 0 Td={1/f0} Z0=1
T111 {(111<=N)*110*quant} 0 {(111<=N)*111*quant} 0 Td={1/f0} Z0=1
T112 {(112<=N)*111*quant} 0 {(112<=N)*112*quant} 0 Td={1/f0} Z0=1
T113 {(113<=N)*112*quant} 0 {(113<=N)*113*quant} 0 Td={1/f0} Z0=1
T114 {(114<=N)*113*quant} 0 {(114<=N)*114*quant} 0 Td={1/f0} Z0=1
T115 {(115<=N)*114*quant} 0 {(115<=N)*115*quant} 0 Td={1/f0} Z0=1
T116 {(116<=N)*115*quant} 0 {(116<=N)*116*quant} 0 Td={1/f0} Z0=1
T117 {(117<=N)*116*quant} 0 {(117<=N)*117*quant} 0 Td={1/f0} Z0=1
T118 {(118<=N)*117*quant} 0 {(118<=N)*118*quant} 0 Td={1/f0} Z0=1
T119 {(119<=N)*118*quant} 0 {(119<=N)*119*quant} 0 Td={1/f0} Z0=1
T120 {(120<=N)*119*quant} 0 {(120<=N)*120*quant} 0 Td={1/f0} Z0=1
T121 {(121<=N)*120*quant} 0 {(121<=N)*121*quant} 0 Td={1/f0} Z0=1
T122 {(122<=N)*121*quant} 0 {(122<=N)*122*quant} 0 Td={1/f0} Z0=1
T123 {(123<=N)*122*quant} 0 {(123<=N)*123*quant} 0 Td={1/f0} Z0=1
T124 {(124<=N)*123*quant} 0 {(124<=N)*124*quant} 0 Td={1/f0} Z0=1
T125 {(125<=N)*124*quant} 0 {(125<=N)*125*quant} 0 Td={1/f0} Z0=1
T126 {(126<=N)*125*quant} 0 {(126<=N)*126*quant} 0 Td={1/f0} Z0=1
T127 {(127<=N)*126*quant} 0 {(127<=N)*127*quant} 0 Td={1/f0} Z0=1
T128 {(128<=N)*127*quant} 0 {(128<=N)*128*quant} 0 Td={1/f0} Z0=1
Rx {N**quant} 0 1
Gin 0 667 666 0 1
G1 0 out {(1<=N)*1*quant} 0 {1/N}
G2 0 out {(2<=N)*2*quant} 0 {1/N}
G3 0 out {(3<=N)*3*quant} 0 {1/N}
G4 0 out {(4<=N)*4*quant} 0 {1/N}
G5 0 out {(5<=N)*5*quant} 0 {1/N}
G6 0 out {(6<=N)*6*quant} 0 {1/N}
G7 0 out {(7<=N)*7*quant} 0 {1/N}
G8 0 out {(8<=N)*8*quant} 0 {1/N}
G9 0 out {(9<=N)*9*quant} 0 {1/N}
G10 0 out {(10<=N)*10*quant} 0 {1/N}
G11 0 out {(11<=N)*11*quant} 0 {1/N}
G12 0 out {(12<=N)*12*quant} 0 {1/N}
G13 0 out {(13<=N)*13*quant} 0 {1/N}
G14 0 out {(14<=N)*14*quant} 0 {1/N}
G15 0 out {(15<=N)*15*quant} 0 {1/N}
G16 0 out {(16<=N)*16*quant} 0 {1/N}
G17 0 out {(17<=N)*17*quant} 0 {1/N}
G18 0 out {(18<=N)*18*quant} 0 {1/N}
G19 0 out {(19<=N)*19*quant} 0 {1/N}
G20 0 out {(20<=N)*20*quant} 0 {1/N}
G21 0 out {(21<=N)*21*quant} 0 {1/N}
G22 0 out {(22<=N)*22*quant} 0 {1/N}
G23 0 out {(23<=N)*23*quant} 0 {1/N}
G24 0 out {(24<=N)*24*quant} 0 {1/N}
G25 0 out {(25<=N)*25*quant} 0 {1/N}
G26 0 out {(26<=N)*26*quant} 0 {1/N}
G27 0 out {(27<=N)*27*quant} 0 {1/N}
G28 0 out {(28<=N)*28*quant} 0 {1/N}
G29 0 out {(29<=N)*29*quant} 0 {1/N}
G30 0 out {(30<=N)*30*quant} 0 {1/N}
G31 0 out {(31<=N)*31*quant} 0 {1/N}
G32 0 out {(32<=N)*32*quant} 0 {1/N}
G33 0 out {(33<=N)*33*quant} 0 {1/N}
G34 0 out {(34<=N)*34*quant} 0 {1/N}
G35 0 out {(35<=N)*35*quant} 0 {1/N}
G36 0 out {(36<=N)*36*quant} 0 {1/N}
G37 0 out {(37<=N)*37*quant} 0 {1/N}
G38 0 out {(38<=N)*38*quant} 0 {1/N}
G39 0 out {(39<=N)*39*quant} 0 {1/N}
G40 0 out {(40<=N)*40*quant} 0 {1/N}
G41 0 out {(41<=N)*41*quant} 0 {1/N}
G42 0 out {(42<=N)*42*quant} 0 {1/N}
G43 0 out {(43<=N)*43*quant} 0 {1/N}
G44 0 out {(44<=N)*44*quant} 0 {1/N}
G45 0 out {(45<=N)*45*quant} 0 {1/N}
G46 0 out {(46<=N)*46*quant} 0 {1/N}
G47 0 out {(47<=N)*47*quant} 0 {1/N}
G48 0 out {(48<=N)*48*quant} 0 {1/N}
G49 0 out {(49<=N)*49*quant} 0 {1/N}
G50 0 out {(50<=N)*50*quant} 0 {1/N}
G51 0 out {(51<=N)*51*quant} 0 {1/N}
G52 0 out {(52<=N)*52*quant} 0 {1/N}
G53 0 out {(53<=N)*53*quant} 0 {1/N}
G54 0 out {(54<=N)*54*quant} 0 {1/N}
G55 0 out {(55<=N)*55*quant} 0 {1/N}
G56 0 out {(56<=N)*56*quant} 0 {1/N}
G57 0 out {(57<=N)*57*quant} 0 {1/N}
G58 0 out {(58<=N)*58*quant} 0 {1/N}
G59 0 out {(59<=N)*59*quant} 0 {1/N}
G60 0 out {(60<=N)*60*quant} 0 {1/N}
G61 0 out {(61<=N)*61*quant} 0 {1/N}
G62 0 out {(62<=N)*62*quant} 0 {1/N}
G63 0 out {(63<=N)*63*quant} 0 {1/N}
G64 0 out {(64<=N)*64*quant} 0 {1/N}
G65 0 out {(65<=N)*65*quant} 0 {1/N}
G66 0 out {(66<=N)*66*quant} 0 {1/N}
G67 0 out {(67<=N)*67*quant} 0 {1/N}
G68 0 out {(68<=N)*68*quant} 0 {1/N}
G69 0 out {(69<=N)*69*quant} 0 {1/N}
G70 0 out {(70<=N)*70*quant} 0 {1/N}
G71 0 out {(71<=N)*71*quant} 0 {1/N}
G72 0 out {(72<=N)*72*quant} 0 {1/N}
G73 0 out {(73<=N)*73*quant} 0 {1/N}
G74 0 out {(74<=N)*74*quant} 0 {1/N}
G75 0 out {(75<=N)*75*quant} 0 {1/N}
G76 0 out {(76<=N)*76*quant} 0 {1/N}
G77 0 out {(77<=N)*77*quant} 0 {1/N}
G78 0 out {(78<=N)*78*quant} 0 {1/N}
G79 0 out {(79<=N)*79*quant} 0 {1/N}
G80 0 out {(80<=N)*80*quant} 0 {1/N}
G81 0 out {(81<=N)*81*quant} 0 {1/N}
G82 0 out {(82<=N)*82*quant} 0 {1/N}
G83 0 out {(83<=N)*83*quant} 0 {1/N}
G84 0 out {(84<=N)*84*quant} 0 {1/N}
G85 0 out {(85<=N)*85*quant} 0 {1/N}
G86 0 out {(86<=N)*86*quant} 0 {1/N}
G87 0 out {(87<=N)*87*quant} 0 {1/N}
G88 0 out {(88<=N)*88*quant} 0 {1/N}
G89 0 out {(89<=N)*89*quant} 0 {1/N}
G90 0 out {(90<=N)*90*quant} 0 {1/N}
G91 0 out {(91<=N)*91*quant} 0 {1/N}
G92 0 out {(92<=N)*92*quant} 0 {1/N}
G93 0 out {(93<=N)*93*quant} 0 {1/N}
G94 0 out {(94<=N)*94*quant} 0 {1/N}
G95 0 out {(95<=N)*95*quant} 0 {1/N}
G96 0 out {(96<=N)*96*quant} 0 {1/N}
G97 0 out {(97<=N)*97*quant} 0 {1/N}
G98 0 out {(98<=N)*98*quant} 0 {1/N}
G99 0 out {(99<=N)*99*quant} 0 {1/N}
G100 0 out {(100<=N)*100*quant} 0 {1/N}
G101 0 out {(101<=N)*101*quant} 0 {1/N}
G102 0 out {(102<=N)*102*quant} 0 {1/N}
G103 0 out {(103<=N)*103*quant} 0 {1/N}
G104 0 out {(104<=N)*104*quant} 0 {1/N}
G105 0 out {(105<=N)*105*quant} 0 {1/N}
G106 0 out {(106<=N)*106*quant} 0 {1/N}
G107 0 out {(107<=N)*107*quant} 0 {1/N}
G108 0 out {(108<=N)*108*quant} 0 {1/N}
G109 0 out {(109<=N)*109*quant} 0 {1/N}
G110 0 out {(110<=N)*110*quant} 0 {1/N}
G111 0 out {(111<=N)*111*quant} 0 {1/N}
G112 0 out {(112<=N)*112*quant} 0 {1/N}
G113 0 out {(113<=N)*113*quant} 0 {1/N}
G114 0 out {(114<=N)*114*quant} 0 {1/N}
G115 0 out {(115<=N)*115*quant} 0 {1/N}
G116 0 out {(116<=N)*116*quant} 0 {1/N}
G117 0 out {(117<=N)*117*quant} 0 {1/N}
G118 0 out {(118<=N)*118*quant} 0 {1/N}
G119 0 out {(119<=N)*119*quant} 0 {1/N}
G120 0 out {(120<=N)*120*quant} 0 {1/N}
G121 0 out {(121<=N)*121*quant} 0 {1/N}
G122 0 out {(122<=N)*122*quant} 0 {1/N}
G123 0 out {(123<=N)*123*quant} 0 {1/N}
G124 0 out {(124<=N)*124*quant} 0 {1/N}
G125 0 out {(125<=N)*125*quant} 0 {1/N}
G126 0 out {(126<=N)*126*quant} 0 {1/N}
G127 0 out {(127<=N)*127*quant} 0 {1/N}
G128 0 out {(128<=N)*128*quant} 0 {1/N}
Vsw cmd 0 {quant}
.model Rout SW Ron=1 Roff={Rpar} vt=.5
Gout 0 out {667*inv(quant)} {inv(quant)} {inv(quant)/N}
Sout 0 out cmd 0 Rout
Cout 0 out Q={inv(quant)/f0}*x
.ends MAF
****************************************
*
*	MAF, variable period
*
****************************************
*
* Parameters: f0 (, Rpar)
* Supports: LP
* Pins used: IN, OUT, 0.1
*
* Notes:
* - Output resistance is proportional to the frequency.
* - Pin '0.1' needs grounding if not used.
*
********************************
.subckt MAFv in out 0.1 0.2 0.3
.param f0=1k Rpar=1G
Gin 0 _in in 0 1
Cin _in 0 1 Rser=0 Lser=0 Rpar={Rpar} Cpar=0 RLshunt=0 ic=0
Gout 0 out _in 2 1
Bd 0 2 I=delay( v(_in), if( f0==0,1/v(0.1),1/f0 ) ) rpar=1
Rout out 0 R=if( f0==0,v(0.1),f0 )
.ends MAFv
****************************************
********************************************************************************
********************************************************************************
************************************************
*
*	Updates sorted by YYYY/MM/DD
*
************************************************
*
* 2013.01.03	- Added a temporary Bessel2, same as Bessel, but which make use
*		of "choice-nodes", it didn't make sense to have all the internal
*		elements active when only N=2 is needed. Two 4th order filters
*		in a schematic would have encumbered the matrix with useless
*		elements.
* 2013.01.04	- Made the same add-ons for the rest of the analog and IIR.
* 2013.01.05	- Made the new versions the default and removed the old ones
*		except Bessel (now Bessel2) which is still here because of the
*		sometimes ugly results of the new one in .AC.
*
********************************************************************************
